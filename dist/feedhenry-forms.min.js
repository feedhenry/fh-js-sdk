!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.feedhenry=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(c){__browserify_shim_require__=a,function(a,b,c,d,e){var f=f||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;e>f;f++){var g=c[f>>>2]>>>24-f%4*8&255;b[d+f>>>2]|=g<<24-(d+f)%4*8}else if(c.length>65535)for(var f=0;e>f;f+=4)b[d+f>>>2]=c[f>>>2];else b.push.apply(b,c);return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=e.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new f.init(c,b)}}),g=c.enc={},h=g.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new f.init(c,b/2)}},i=g.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new f.init(c,b)}},j=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(i.stringify(a)))}catch(b){throw new Error("Malformed UTF-8 data")}},parse:function(a){return i.parse(unescape(encodeURIComponent(a)))}},k=d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=4*g,i=e/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j=i*g,k=a.min(4*j,e);if(j){for(var l=0;j>l;l+=g)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new f.init(m,k)},clone:function(){var a=e.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),l=(d.Hasher=k.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new l.HMAC.init(a,c).finalize(b)}}}),c.algo={});return c}(Math);!function(){{var a=f,b=a.lib,c=b.WordArray,d=a.enc;d.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp();for(var e=[],f=0;c>f;f+=3)for(var g=b[f>>>2]>>>24-f%4*8&255,h=b[f+1>>>2]>>>24-(f+1)%4*8&255,i=b[f+2>>>2]>>>24-(f+2)%4*8&255,j=g<<16|h<<8|i,k=0;4>k&&c>f+.75*k;k++)e.push(d.charAt(j>>>6*(3-k)&63));var l=d.charAt(64);if(l)for(;e.length%4;)e.push(l);return e.join("")},parse:function(a){var b=a.length,d=this._map,e=d.charAt(64);if(e){var f=a.indexOf(e);-1!=f&&(b=f)}for(var g=[],h=0,i=0;b>i;i++)if(i%4){var j=d.indexOf(a.charAt(i-1))<<i%4*2,k=d.indexOf(a.charAt(i))>>>6-i%4*2;g[h>>>2]|=(j|k)<<24-h%4*8,h++}return c.create(g,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}}(),f.lib.Cipher||function(a){var b=f,c=b.lib,d=c.Base,e=c.WordArray,g=c.BufferedBlockAlgorithm,h=b.enc,i=(h.Utf8,h.Base64),j=b.algo,k=j.EvpKDF,l=c.Cipher=g.extend({cfg:d.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c),this._xformMode=a,this._key=b,this.reset()},reset:function(){g.reset.call(this),this._doReset()},process:function(a){return this._append(a),this._process()},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function a(a){return"string"==typeof a?x:u}return function(b){return{encrypt:function(c,d,e){return a(d).encrypt(b,c,d,e)},decrypt:function(c,d,e){return a(d).decrypt(b,c,d,e)}}}}()}),m=(c.StreamCipher=l.extend({_doFinalize:function(){var a=this._process(!0);return a},blockSize:1}),b.mode={}),n=c.BlockCipherMode=d.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a,this._iv=b}}),o=m.CBC=function(){function b(b,c,d){var e=this._iv;if(e){var f=e;this._iv=a}else var f=this._prevBlock;for(var g=0;d>g;g++)b[c+g]^=f[g]}var c=n.extend();return c.Encryptor=c.extend({processBlock:function(a,c){var d=this._cipher,e=d.blockSize;b.call(this,a,c,e),d.encryptBlock(a,c),this._prevBlock=a.slice(c,c+e)}}),c.Decryptor=c.extend({processBlock:function(a,c){var d=this._cipher,e=d.blockSize,f=a.slice(c,c+e);d.decryptBlock(a,c),b.call(this,a,c,e),this._prevBlock=f}}),c}(),p=b.pad={},q=p.Pkcs7={pad:function(a,b){for(var c=4*b,d=c-a.sigBytes%c,f=d<<24|d<<16|d<<8|d,g=[],h=0;d>h;h+=4)g.push(f);var i=e.create(g,d);a.concat(i)},unpad:function(a){var b=255&a.words[a.sigBytes-1>>>2];a.sigBytes-=b}},r=(c.BlockCipher=l.extend({cfg:l.cfg.extend({mode:o,padding:q}),reset:function(){l.reset.call(this);var a=this.cfg,b=a.iv,c=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var d=c.createEncryptor;else{var d=c.createDecryptor;this._minBufferSize=1}this._mode=d.call(c,this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else{var b=this._process(!0);a.unpad(b)}return b},blockSize:4}),c.CipherParams=d.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}})),s=b.format={},t=s.OpenSSL={stringify:function(a){var b=a.ciphertext,c=a.salt;if(c)var d=e.create([1398893684,1701076831]).concat(c).concat(b);else var d=b;return d.toString(i)},parse:function(a){var b=i.parse(a),c=b.words;if(1398893684==c[0]&&1701076831==c[1]){var d=e.create(c.slice(2,4));c.splice(0,4),b.sigBytes-=16}return r.create({ciphertext:b,salt:d})}},u=c.SerializableCipher=d.extend({cfg:d.extend({format:t}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d),f=e.finalize(b),g=e.cfg;return r.create({ciphertext:f,key:c,iv:g.iv,algorithm:a,mode:g.mode,padding:g.padding,blockSize:a.blockSize,formatter:d.format})},decrypt:function(a,b,c,d){d=this.cfg.extend(d),b=this._parse(b,d.format);var e=a.createDecryptor(c,d).finalize(b.ciphertext);return e},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),v=b.kdf={},w=v.OpenSSL={execute:function(a,b,c,d){d||(d=e.random(8));var f=k.create({keySize:b+c}).compute(a,d),g=e.create(f.words.slice(b),4*c);return f.sigBytes=4*b,r.create({key:f,iv:g,salt:d})}},x=c.PasswordBasedCipher=u.extend({cfg:u.cfg.extend({kdf:w}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=d.kdf.execute(c,a.keySize,a.ivSize);d.iv=e.iv;var f=u.encrypt.call(this,a,b,e.key,d);return f.mixIn(e),f},decrypt:function(a,b,c,d){d=this.cfg.extend(d),b=this._parse(b,d.format);var e=d.kdf.execute(c,a.keySize,a.ivSize,b.salt);d.iv=e.iv;var f=u.decrypt.call(this,a,b,e.key,d);return f}})}(),function(){var a=f,b=a.lib,c=b.BlockCipher,d=a.algo,e=[],g=[],h=[],i=[],j=[],k=[],l=[],m=[],n=[],o=[];!function(){for(var a=[],b=0;256>b;b++)a[b]=128>b?b<<1:b<<1^283;for(var c=0,d=0,b=0;256>b;b++){var f=d^d<<1^d<<2^d<<3^d<<4;f=f>>>8^255&f^99,e[c]=f,g[f]=c;var p=a[c],q=a[p],r=a[q],s=257*a[f]^16843008*f;h[c]=s<<24|s>>>8,i[c]=s<<16|s>>>16,j[c]=s<<8|s>>>24,k[c]=s;var s=16843009*r^65537*q^257*p^16843008*c;l[f]=s<<24|s>>>8,m[f]=s<<16|s>>>16,n[f]=s<<8|s>>>24,o[f]=s,c?(c=p^a[a[a[r^p]]],d^=a[a[d]]):c=d=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],q=d.AES=c.extend({_doReset:function(){for(var a=this._key,b=a.words,c=a.sigBytes/4,d=this._nRounds=c+6,f=4*(d+1),g=this._keySchedule=[],h=0;f>h;h++)if(c>h)g[h]=b[h];else{var i=g[h-1];h%c?c>6&&h%c==4&&(i=e[i>>>24]<<24|e[i>>>16&255]<<16|e[i>>>8&255]<<8|e[255&i]):(i=i<<8|i>>>24,i=e[i>>>24]<<24|e[i>>>16&255]<<16|e[i>>>8&255]<<8|e[255&i],i^=p[h/c|0]<<24),g[h]=g[h-c]^i}for(var j=this._invKeySchedule=[],k=0;f>k;k++){var h=f-k;if(k%4)var i=g[h];else var i=g[h-4];j[k]=4>k||4>=h?i:l[e[i>>>24]]^m[e[i>>>16&255]]^n[e[i>>>8&255]]^o[e[255&i]]}},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,h,i,j,k,e)},decryptBlock:function(a,b){var c=a[b+1];a[b+1]=a[b+3],a[b+3]=c,this._doCryptBlock(a,b,this._invKeySchedule,l,m,n,o,g);var c=a[b+1];a[b+1]=a[b+3],a[b+3]=c},_doCryptBlock:function(a,b,c,d,e,f,g,h){for(var i=this._nRounds,j=a[b]^c[0],k=a[b+1]^c[1],l=a[b+2]^c[2],m=a[b+3]^c[3],n=4,o=1;i>o;o++){var p=d[j>>>24]^e[k>>>16&255]^f[l>>>8&255]^g[255&m]^c[n++],q=d[k>>>24]^e[l>>>16&255]^f[m>>>8&255]^g[255&j]^c[n++],r=d[l>>>24]^e[m>>>16&255]^f[j>>>8&255]^g[255&k]^c[n++],s=d[m>>>24]^e[j>>>16&255]^f[k>>>8&255]^g[255&l]^c[n++];j=p,k=q,l=r,m=s}var p=(h[j>>>24]<<24|h[k>>>16&255]<<16|h[l>>>8&255]<<8|h[255&m])^c[n++],q=(h[k>>>24]<<24|h[l>>>16&255]<<16|h[m>>>8&255]<<8|h[255&j])^c[n++],r=(h[l>>>24]<<24|h[m>>>16&255]<<16|h[j>>>8&255]<<8|h[255&k])^c[n++],s=(h[m>>>24]<<24|h[j>>>16&255]<<16|h[k>>>8&255]<<8|h[255&l])^c[n++];a[b]=p,a[b+1]=q,a[b+2]=r,a[b+3]=s},keySize:8});a.AES=c._createHelper(q)}(),function(a){function b(a,b,c,d,e,f,g){var h=a+(b&c|~b&d)+e+g;return(h<<f|h>>>32-f)+b}function c(a,b,c,d,e,f,g){var h=a+(b&d|c&~d)+e+g;return(h<<f|h>>>32-f)+b}function d(a,b,c,d,e,f,g){var h=a+(b^c^d)+e+g;return(h<<f|h>>>32-f)+b}function e(a,b,c,d,e,f,g){var h=a+(c^(b|~d))+e+g;return(h<<f|h>>>32-f)+b}var g=f,h=g.lib,i=h.WordArray,j=h.Hasher,k=g.algo,l=[];!function(){for(var b=0;64>b;b++)l[b]=4294967296*a.abs(a.sin(b+1))|0}();var m=k.MD5=j.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){for(var g=0;16>g;g++){var h=f+g,i=a[h];a[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var j=this._hash.words,k=a[f+0],m=a[f+1],n=a[f+2],o=a[f+3],p=a[f+4],q=a[f+5],r=a[f+6],s=a[f+7],t=a[f+8],u=a[f+9],v=a[f+10],w=a[f+11],x=a[f+12],y=a[f+13],z=a[f+14],A=a[f+15],B=j[0],C=j[1],D=j[2],E=j[3];B=b(B,C,D,E,k,7,l[0]),E=b(E,B,C,D,m,12,l[1]),D=b(D,E,B,C,n,17,l[2]),C=b(C,D,E,B,o,22,l[3]),B=b(B,C,D,E,p,7,l[4]),E=b(E,B,C,D,q,12,l[5]),D=b(D,E,B,C,r,17,l[6]),C=b(C,D,E,B,s,22,l[7]),B=b(B,C,D,E,t,7,l[8]),E=b(E,B,C,D,u,12,l[9]),D=b(D,E,B,C,v,17,l[10]),C=b(C,D,E,B,w,22,l[11]),B=b(B,C,D,E,x,7,l[12]),E=b(E,B,C,D,y,12,l[13]),D=b(D,E,B,C,z,17,l[14]),C=b(C,D,E,B,A,22,l[15]),B=c(B,C,D,E,m,5,l[16]),E=c(E,B,C,D,r,9,l[17]),D=c(D,E,B,C,w,14,l[18]),C=c(C,D,E,B,k,20,l[19]),B=c(B,C,D,E,q,5,l[20]),E=c(E,B,C,D,v,9,l[21]),D=c(D,E,B,C,A,14,l[22]),C=c(C,D,E,B,p,20,l[23]),B=c(B,C,D,E,u,5,l[24]),E=c(E,B,C,D,z,9,l[25]),D=c(D,E,B,C,o,14,l[26]),C=c(C,D,E,B,t,20,l[27]),B=c(B,C,D,E,y,5,l[28]),E=c(E,B,C,D,n,9,l[29]),D=c(D,E,B,C,s,14,l[30]),C=c(C,D,E,B,x,20,l[31]),B=d(B,C,D,E,q,4,l[32]),E=d(E,B,C,D,t,11,l[33]),D=d(D,E,B,C,w,16,l[34]),C=d(C,D,E,B,z,23,l[35]),B=d(B,C,D,E,m,4,l[36]),E=d(E,B,C,D,p,11,l[37]),D=d(D,E,B,C,s,16,l[38]),C=d(C,D,E,B,v,23,l[39]),B=d(B,C,D,E,y,4,l[40]),E=d(E,B,C,D,k,11,l[41]),D=d(D,E,B,C,o,16,l[42]),C=d(C,D,E,B,r,23,l[43]),B=d(B,C,D,E,u,4,l[44]),E=d(E,B,C,D,x,11,l[45]),D=d(D,E,B,C,A,16,l[46]),C=d(C,D,E,B,n,23,l[47]),B=e(B,C,D,E,k,6,l[48]),E=e(E,B,C,D,s,10,l[49]),D=e(D,E,B,C,z,15,l[50]),C=e(C,D,E,B,q,21,l[51]),B=e(B,C,D,E,x,6,l[52]),E=e(E,B,C,D,o,10,l[53]),D=e(D,E,B,C,v,15,l[54]),C=e(C,D,E,B,m,21,l[55]),B=e(B,C,D,E,t,6,l[56]),E=e(E,B,C,D,A,10,l[57]),D=e(D,E,B,C,r,15,l[58]),C=e(C,D,E,B,y,21,l[59]),B=e(B,C,D,E,p,6,l[60]),E=e(E,B,C,D,w,10,l[61]),D=e(D,E,B,C,n,15,l[62]),C=e(C,D,E,B,u,21,l[63]),j[0]=j[0]+B|0,j[1]=j[1]+C|0,j[2]=j[2]+D|0,j[3]=j[3]+E|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f=a.floor(d/4294967296),g=d;c[(e+64>>>9<<4)+15]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),c[(e+64>>>9<<4)+14]=16711935&(g<<8|g>>>24)|4278255360&(g<<24|g>>>8),b.sigBytes=4*(c.length+1),this._process();for(var h=this._hash,i=h.words,j=0;4>j;j++){var k=i[j];i[j]=16711935&(k<<8|k>>>24)|4278255360&(k<<24|k>>>8)}return h},clone:function(){var a=j.clone.call(this);return a._hash=this._hash.clone(),a}});g.MD5=j._createHelper(m),g.HmacMD5=j._createHmacHelper(m)}(Math),function(){var a=f,b=a.lib,c=b.WordArray,d=b.Hasher,e=a.algo,g=[],h=e.SHA1=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=0;80>j;j++){if(16>j)g[j]=0|a[b+j];else{var k=g[j-3]^g[j-8]^g[j-14]^g[j-16];g[j]=k<<1|k>>>31}var l=(d<<5|d>>>27)+i+g[j];l+=20>j?(e&f|~e&h)+1518500249:40>j?(e^f^h)+1859775393:60>j?(e&f|e&h|f&h)-1894007588:(e^f^h)-899497514,i=h,h=f,f=e<<30|e>>>2,e=d,d=l}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+h|0,c[4]=c[4]+i|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;return b[d>>>5]|=128<<24-d%32,b[(d+64>>>9<<4)+14]=Math.floor(c/4294967296),b[(d+64>>>9<<4)+15]=c,a.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var a=d.clone.call(this);return a._hash=this._hash.clone(),a}});a.SHA1=d._createHelper(h),a.HmacSHA1=d._createHmacHelper(h)}(),function(a){{var b=f,c=b.lib,d=c.Base,e=c.WordArray,g=b.x64={};g.Word=d.extend({init:function(a,b){this.high=a,this.low=b}}),g.WordArray=d.extend({init:function(b,c){b=this.words=b||[],this.sigBytes=c!=a?c:8*b.length},toX32:function(){for(var a=this.words,b=a.length,c=[],d=0;b>d;d++){var f=a[d];c.push(f.high),c.push(f.low)}return e.create(c,this.sigBytes)},clone:function(){for(var a=d.clone.call(this),b=a.words=this.words.slice(0),c=b.length,e=0;c>e;e++)b[e]=b[e].clone();return a}})}}(),function(a){var b=f,c=b.lib,d=c.WordArray,e=c.Hasher,g=b.algo,h=[],i=[];!function(){function b(b){for(var c=a.sqrt(b),d=2;c>=d;d++)if(!(b%d))return!1;return!0}function c(a){return 4294967296*(a-(0|a))|0}for(var d=2,e=0;64>e;)b(d)&&(8>e&&(h[e]=c(a.pow(d,.5))),i[e]=c(a.pow(d,1/3)),e++),d++}();var j=[],k=g.SHA256=e.extend({_doReset:function(){this._hash=new d.init(h.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],k=c[5],l=c[6],m=c[7],n=0;64>n;n++){if(16>n)j[n]=0|a[b+n];else{var o=j[n-15],p=(o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3,q=j[n-2],r=(q<<15|q>>>17)^(q<<13|q>>>19)^q>>>10;j[n]=p+j[n-7]+r+j[n-16]}var s=h&k^~h&l,t=d&e^d&f^e&f,u=(d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22),v=(h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25),w=m+v+s+i[n]+j[n],x=u+t;m=l,l=k,k=h,h=g+w|0,g=f,f=e,e=d,d=w+x|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+g|0,c[4]=c[4]+h|0,c[5]=c[5]+k|0,c[6]=c[6]+l|0,c[7]=c[7]+m|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=a.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA256=e._createHelper(k),b.HmacSHA256=e._createHmacHelper(k)}(Math),function(){function a(){return g.create.apply(g,arguments)}var b=f,c=b.lib,d=c.Hasher,e=b.x64,g=e.Word,h=e.WordArray,i=b.algo,j=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],k=[];!function(){for(var b=0;80>b;b++)k[b]=a()}();var l=i.SHA512=d.extend({_doReset:function(){this._hash=new h.init([new g.init(1779033703,4089235720),new g.init(3144134277,2227873595),new g.init(1013904242,4271175723),new g.init(2773480762,1595750129),new g.init(1359893119,2917565137),new g.init(2600822924,725511199),new g.init(528734635,4215389547),new g.init(1541459225,327033209)])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],l=c[6],m=c[7],n=d.high,o=d.low,p=e.high,q=e.low,r=f.high,s=f.low,t=g.high,u=g.low,v=h.high,w=h.low,x=i.high,y=i.low,z=l.high,A=l.low,B=m.high,C=m.low,D=n,E=o,F=p,G=q,H=r,I=s,J=t,K=u,L=v,M=w,N=x,O=y,P=z,Q=A,R=B,S=C,T=0;80>T;T++){var U=k[T];if(16>T)var V=U.high=0|a[b+2*T],W=U.low=0|a[b+2*T+1];else{var X=k[T-15],Y=X.high,Z=X.low,$=(Y>>>1|Z<<31)^(Y>>>8|Z<<24)^Y>>>7,_=(Z>>>1|Y<<31)^(Z>>>8|Y<<24)^(Z>>>7|Y<<25),aa=k[T-2],ba=aa.high,ca=aa.low,da=(ba>>>19|ca<<13)^(ba<<3|ca>>>29)^ba>>>6,ea=(ca>>>19|ba<<13)^(ca<<3|ba>>>29)^(ca>>>6|ba<<26),fa=k[T-7],ga=fa.high,ha=fa.low,ia=k[T-16],ja=ia.high,ka=ia.low,W=_+ha,V=$+ga+(_>>>0>W>>>0?1:0),W=W+ea,V=V+da+(ea>>>0>W>>>0?1:0),W=W+ka,V=V+ja+(ka>>>0>W>>>0?1:0);U.high=V,U.low=W}var la=L&N^~L&P,ma=M&O^~M&Q,na=D&F^D&H^F&H,oa=E&G^E&I^G&I,pa=(D>>>28|E<<4)^(D<<30|E>>>2)^(D<<25|E>>>7),qa=(E>>>28|D<<4)^(E<<30|D>>>2)^(E<<25|D>>>7),ra=(L>>>14|M<<18)^(L>>>18|M<<14)^(L<<23|M>>>9),sa=(M>>>14|L<<18)^(M>>>18|L<<14)^(M<<23|L>>>9),ta=j[T],ua=ta.high,va=ta.low,wa=S+sa,xa=R+ra+(S>>>0>wa>>>0?1:0),wa=wa+ma,xa=xa+la+(ma>>>0>wa>>>0?1:0),wa=wa+va,xa=xa+ua+(va>>>0>wa>>>0?1:0),wa=wa+W,xa=xa+V+(W>>>0>wa>>>0?1:0),ya=qa+oa,za=pa+na+(qa>>>0>ya>>>0?1:0);R=P,S=Q,P=N,Q=O,N=L,O=M,M=K+wa|0,L=J+xa+(K>>>0>M>>>0?1:0)|0,J=H,K=I,H=F,I=G,F=D,G=E,E=wa+ya|0,D=xa+za+(wa>>>0>E>>>0?1:0)|0}o=d.low=o+E,d.high=n+D+(E>>>0>o>>>0?1:0),q=e.low=q+G,e.high=p+F+(G>>>0>q>>>0?1:0),s=f.low=s+I,f.high=r+H+(I>>>0>s>>>0?1:0),u=g.low=u+K,g.high=t+J+(K>>>0>u>>>0?1:0),w=h.low=w+M,h.high=v+L+(M>>>0>w>>>0?1:0),y=i.low=y+O,i.high=x+N+(O>>>0>y>>>0?1:0),A=l.low=A+Q,l.high=z+P+(Q>>>0>A>>>0?1:0),C=m.low=C+S,m.high=B+R+(S>>>0>C>>>0?1:0)},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;b[d>>>5]|=128<<24-d%32,b[(d+128>>>10<<5)+30]=Math.floor(c/4294967296),b[(d+128>>>10<<5)+31]=c,a.sigBytes=4*b.length,this._process();var e=this._hash.toX32();return e},clone:function(){var a=d.clone.call(this);return a._hash=this._hash.clone(),a},blockSize:32});b.SHA512=d._createHelper(l),b.HmacSHA512=d._createHmacHelper(l)}(),function(a){var b=f,c=b.lib,d=c.WordArray,e=c.Hasher,g=b.x64,h=g.Word,i=b.algo,j=[],k=[],l=[];!function(){for(var a=1,b=0,c=0;24>c;c++){j[a+5*b]=(c+1)*(c+2)/2%64;var d=b%5,e=(2*a+3*b)%5;a=d,b=e}for(var a=0;5>a;a++)for(var b=0;5>b;b++)k[a+5*b]=b+(2*a+3*b)%5*5;for(var f=1,g=0;24>g;g++){for(var i=0,m=0,n=0;7>n;n++){if(1&f){var o=(1<<n)-1;32>o?m^=1<<o:i^=1<<o-32}128&f?f=f<<1^113:f<<=1}l[g]=h.create(i,m)}}();var m=[];!function(){for(var a=0;25>a;a++)m[a]=h.create()}();var n=i.SHA3=e.extend({cfg:e.cfg.extend({outputLength:512}),_doReset:function(){for(var a=this._state=[],b=0;25>b;b++)a[b]=new h.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(a,b){for(var c=this._state,d=this.blockSize/2,e=0;d>e;e++){var f=a[b+2*e],g=a[b+2*e+1];f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),g=16711935&(g<<8|g>>>24)|4278255360&(g<<24|g>>>8);var h=c[e];h.high^=g,h.low^=f}for(var i=0;24>i;i++){for(var n=0;5>n;n++){for(var o=0,p=0,q=0;5>q;q++){var h=c[n+5*q];o^=h.high,p^=h.low}var r=m[n];r.high=o,r.low=p}for(var n=0;5>n;n++)for(var s=m[(n+4)%5],t=m[(n+1)%5],u=t.high,v=t.low,o=s.high^(u<<1|v>>>31),p=s.low^(v<<1|u>>>31),q=0;5>q;q++){var h=c[n+5*q];h.high^=o,h.low^=p}for(var w=1;25>w;w++){var h=c[w],x=h.high,y=h.low,z=j[w];if(32>z)var o=x<<z|y>>>32-z,p=y<<z|x>>>32-z;else var o=y<<z-32|x>>>64-z,p=x<<z-32|y>>>64-z;var A=m[k[w]];A.high=o,A.low=p}var B=m[0],C=c[0];B.high=C.high,B.low=C.low;for(var n=0;5>n;n++)for(var q=0;5>q;q++){var w=n+5*q,h=c[w],D=m[w],E=m[(n+1)%5+5*q],F=m[(n+2)%5+5*q];h.high=D.high^~E.high&F.high,h.low=D.low^~E.low&F.low}var h=c[0],G=l[i];h.high^=G.high,h.low^=G.low}},_doFinalize:function(){var b=this._data,c=b.words,e=(8*this._nDataBytes,8*b.sigBytes),f=32*this.blockSize;c[e>>>5]|=1<<24-e%32,c[(a.ceil((e+1)/f)*f>>>5)-1]|=128,b.sigBytes=4*c.length,this._process();for(var g=this._state,h=this.cfg.outputLength/8,i=h/8,j=[],k=0;i>k;k++){var l=g[k],m=l.high,n=l.low;m=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8),n=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),j.push(n),j.push(m)}return new d.init(j,h)},clone:function(){for(var a=e.clone.call(this),b=a._state=this._state.slice(0),c=0;25>c;c++)b[c]=b[c].clone();return a}});b.SHA3=e._createHelper(n),b.HmacSHA3=e._createHmacHelper(n)}(Math),e("undefined"!=typeof f?f:window.CryptoJS)}.call(c,void 0,void 0,void 0,void 0,function(a){b.exports=a})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b,c){(function(c){__browserify_shim_require__=a,function(a,b,c,d,e){var f=function(a,b){if(!(this instanceof f))return new f(a,b);if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";if(!(arguments.length<=2&&arguments.length>0))throw"Incorrect # of ctor args!";if(b="function"==typeof arguments[0]?arguments[0]:arguments[1],a="function"==typeof arguments[0]?{}:arguments[0],"function"!=typeof b)throw"No callback was provided";this.record=a.record||"record",this.name=a.name||"records";var c;if(a.adapter){"string"==typeof a.adapter&&(a.adapter=[a.adapter]);for(var d=0,e=a.adapter.length;e>d;d++){for(var g=f.adapters.length-1;g>=0&&(f.adapters[g].adapter!==a.adapter[d]||!(c=f.adapters[g].valid()?f.adapters[g]:void 0));g--);if(c)break}}else for(var g=0,h=f.adapters.length;h>g&&!(c=f.adapters[g].valid()?f.adapters[g]:void 0);g++);if(!c)throw"No valid adapter.";for(var d in c)this[d]=c[d];for(var g=0,h=f.plugins.length;h>g;g++)f.plugins[g].call(this);this.init(a,b)};f.adapters=[],f.adapter=function(a,b){b.adapter=a;var c="adapter valid init keys save batch get exists all remove nuke".split(" "),d=this.prototype.indexOf;for(var e in b)if(-1===d(c,e))throw"Invalid adapter! Nonstandard method: "+e;f.adapters.splice(0,0,b)},f.plugins=[],f.plugin=function(a){for(var b in a)"init"===b?f.plugins.push(a[b]):this.prototype[b]=a[b]},f.prototype={isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},indexOf:function(a,b,c,d){if(a.indexOf)return a.indexOf(b);for(c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},lambda:function(a){return this.fn(this.record,a)},fn:function(a,b){return"string"==typeof b?new Function(a,b):b},uuid:function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},each:function(a){var b=this.lambda(a);if(this.__results)for(var c=0,d=this.__results.length;d>c;c++)b.call(this,this.__results[c],c);else this.all(function(a){for(var c=0,d=a.length;d>c;c++)b.call(this,a[c],c)});return this}},f.adapter("window-name",function(){"undefined"==typeof window&&(window={top:{}});var a={};try{a=JSON.parse(window.top.name)}catch(b){}return{valid:function(){return"undefined"!=typeof window.top.name},init:function(b,c){return a[this.name]=a[this.name]||{index:[],store:{}},this.index=a[this.name].index,this.store=a[this.name].store,this.fn(this.name,c).call(this,this),this},keys:function(a){return this.fn("keys",a).call(this,this.index),this},save:function(b,c){var d=b.key||this.uuid();return this.exists(d,function(e){e||(b.key&&delete b.key,this.index.push(d)),this.store[d]=b;try{window.top.name=JSON.stringify(a)}catch(f){throw e||(this.index.pop(),delete this.store[d]),f}c&&(b.key=d,this.lambda(c).call(this,b))}),this},batch:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)this.save(a[d],function(a){c.push(a)});return b&&this.lambda(b).call(this,c),this},get:function(a,b){var c;if(this.isArray(a)){c=[];for(var d=0,e=a.length;e>d;d++)c.push(this.store[a[d]])}else c=this.store[a],c&&(c.key=a);return b&&this.lambda(b).call(this,c),this},exists:function(a,b){return this.lambda(b).call(this,!!this.store[a]),this},all:function(a){for(var b=[],c=0,d=this.index.length;d>c;c++){var e=this.store[this.index[c]];e.key=this.index[c],b.push(e)}return this.fn(this.name,a).call(this,b),this},remove:function(b,c){for(var d=this.isArray(b)?b:[b],e=0,f=d.length;f>e;e++){var g=d[e].key?d[e].key:d[e],h=this.indexOf(this.index,g);0>h||(delete this.store[g],this.index.splice(h,1))}return window.top.name=JSON.stringify(a),c&&this.lambda(c).call(this),this},nuke:function(b){return this.store=a[this.name].store={},this.index=a[this.name].index=[],window.top.name=JSON.stringify(a),b&&this.lambda(b).call(this),this}}}()),f.adapter("dom",function(){var a=null;try{a=window.localStorage}catch(b){}var c=function(b){return{key:b+"._index_",all:function(){var b=a.getItem(this.key);return b&&(b=JSON.parse(b)),null===b&&a.setItem(this.key,JSON.stringify([])),JSON.parse(a.getItem(this.key))},add:function(b){var c=this.all();c.push(b),a.setItem(this.key,JSON.stringify(c))},del:function(b){for(var c=this.all(),d=[],e=0,f=c.length;f>e;e++)c[e]!=b&&d.push(c[e]);a.setItem(this.key,JSON.stringify(d))},find:function(a){for(var b=this.all(),c=0,d=b.length;d>c;c++)if(a===b[c])return c;return!1}}};return{valid:function(){return!!a&&function(){var b=!0,c=Math.random();try{a.setItem(c,c)}catch(d){b=!1}return a.removeItem(c),b}()},init:function(a,b){this.indexer=c(this.name),b&&this.fn(this.name,b).call(this,this)},save:function(b,c){var d=b.key?this.name+"."+b.key:this.name+"."+this.uuid();return delete b.key,a.setItem(d,JSON.stringify(b)),this.indexer.find(d)===!1&&this.indexer.add(d),b.key=d.slice(this.name.length+1),c&&this.lambda(c).call(this,b),this},batch:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)this.save(a[d],function(a){c.push(a)});return b&&this.lambda(b).call(this,c),this},keys:function(a){if(a){var b=this.name,c=this.indexer.all(),d=[];if(Array.prototype.map)d=c.map(function(a){return a.replace(b+".","")});else for(var e in c)d.push(e.replace(b+".",""));this.fn("keys",a).call(this,d)}return this},get:function(b,c){if(this.isArray(b)){for(var d=[],e=0,f=b.length;f>e;e++){var g=this.name+"."+b[e],h=a.getItem(g);h&&(h=JSON.parse(h),h.key=b[e]),d.push(h)}c&&this.lambda(c).call(this,d)}else{var g=this.name+"."+b,h=a.getItem(g);h&&(h=JSON.parse(h),h.key=b),c&&this.lambda(c).call(this,h)}return this},exists:function(a,b){var c=this.indexer.find(this.name+"."+a)===!1?!1:!0;return this.lambda(b).call(this,c),this},all:function(b){for(var c,d,e=this.indexer.all(),f=[],g=0,h=e.length;h>g;g++)d=e[g],c=JSON.parse(a.getItem(d)),c.key=d.replace(this.name+".",""),f.push(c);return b&&this.fn(this.name,b).call(this,f),this},remove:function(b,c){var d=this;if(this.isArray(b)){var e,f=b.length,g=function(a){d.remove(b[a],function(){--f>0||c&&d.lambda(c).call(d)})};for(e=0;e<b.length;e++)g(e);return this}var h=this.name+"."+(b.key?b.key:b);return this.indexer.del(h),a.removeItem(h),c&&this.lambda(c).call(this),this},nuke:function(a){return this.all(function(b){for(var c=0,d=b.length;d>c;c++)this.remove(b[c]);a&&this.lambda(a).call(this)}),this}}}()),f.adapter("webkit-sqlite",function(){var a=function(a,b){console&&console.log("error in sqlite adaptor!",a,b)},b=function(){return new Date};return{valid:function(){return!!window.openDatabase},init:function(b,c){var d=this,e=d.fn(d.name,c),f="CREATE TABLE IF NOT EXISTS "+this.record+" (id NVARCHAR(32) UNIQUE PRIMARY KEY, value TEXT, timestamp REAL)",g=function(){return e.call(d,d)};b&&"function"==typeof b.fail&&(a=b.fail),this.db=openDatabase(this.name,"1.0.0",this.name,65536),this.db.transaction(function(b){b.executeSql(f,[],g,a)})},keys:function(b){var c=this.lambda(b),d=this,e="SELECT id FROM "+this.record+" ORDER BY timestamp DESC";return this.db.readTransaction(function(b){var f=function(a,b){if(0==b.rows.length)c.call(d,[]);else{for(var e=[],f=0,g=b.rows.length;g>f;f++)e.push(b.rows.item(f).id);c.call(d,e)}};b.executeSql(e,[],f,a)}),this},save:function(c,d,e){var f=this;objs=(this.isArray(c)?c:[c]).map(function(a){return a.key||(a.key=f.uuid()),a}),ins="INSERT OR REPLACE INTO "+this.record+" (value, timestamp, id) VALUES (?,?,?)",win=function(){d&&f.lambda(d).call(f,f.isArray(c)?objs:objs[0])},e=e||function(){},insvals=[],ts=b();try{for(var g=0,h=objs.length;h>g;g++)insvals[g]=[JSON.stringify(objs[g]),ts,objs[g].key]}catch(i){throw a(i),i}return f.db.transaction(function(a){for(var b=0,c=objs.length;c>b;b++)a.executeSql(ins,insvals[b])},function(b,c){a(b,c)},win),this},batch:function(a,b){return this.save(a,b)},get:function(b,c){var d=this,e="",f=this.isArray(b)?b:[b];e="SELECT id, value FROM "+this.record+" WHERE id IN ("+f.map(function(){return"?"}).join(",")+")";var g=function(a,e){for(var g,h,i={},j=0,k=e.rows.length;k>j;j++)g=JSON.parse(e.rows.item(j).value),g.key=e.rows.item(j).id,i[g.key]=g;h=f.map(function(a){return i[a]}),d.isArray(b)||(h=h.length?h[0]:null),c&&d.lambda(c).call(d,h)};return this.db.readTransaction(function(b){b.executeSql(e,f,g,a)}),this},exists:function(b,c){var d="SELECT * FROM "+this.record+" WHERE id = ?",e=this,f=function(a,b){c&&e.fn("exists",c).call(e,b.rows.length>0)};return this.db.readTransaction(function(c){c.executeSql(d,[b],f,a)}),
this},all:function(b){var c=this,d="SELECT * FROM "+this.record,e=[],f=this.fn(this.name,b)||void 0,g=function(a,b){if(0!=b.rows.length)for(var d=0,g=b.rows.length;g>d;d++){var h=JSON.parse(b.rows.item(d).value);h.key=b.rows.item(d).id,e.push(h)}f&&f.call(c,e)};return this.db.readTransaction(function(b){b.executeSql(d,[],g,a)}),this},remove:function(b,c){var d,e=this,f="DELETE FROM "+this.record+" WHERE id ",g=function(){c&&e.lambda(c).call(e)};return this.isArray(b)?(d=b,f+="IN ("+d.map(function(){return"?"}).join(",")+")"):(f+="= ?",d=[b]),d=d.map(function(a){return a.key?a.key:a}),this.db.transaction(function(b){b.executeSql(f,d,g,a)}),this},nuke:function(b){var c="DELETE FROM "+this.record,d=this,e=b?function(){d.lambda(b).call(d)}:function(){};return this.db.transaction(function(b){b.executeSql(c,[],e,a)}),this}}}()),f.adapter("html5-filesystem",function(a){var b=a.FileError,c=function(a){var c,d=!0;switch(a.code){case b.QUOTA_EXCEEDED_ERR:c="QUOTA_EXCEEDED_ERR";break;case b.NOT_FOUND_ERR:c="NOT_FOUND_ERR",d=!1;break;case b.SECURITY_ERR:c="SECURITY_ERR";break;case b.INVALID_MODIFICATION_ERR:c="INVALID_MODIFICATION_ERR";break;case b.INVALID_STATE_ERR:c="INVALID_STATE_ERR";break;default:c="Unknown Error"}console&&d&&console.error(a,c)},d=function(a,b,e){var f=e||[];a.readEntries(function(c){c.length?d(a,b,f.concat(Array.prototype.slice.call(c))):b&&b(f.map(function(a){return a.name}))},c)},e={},f=function(a,b){var c=e[a.name];c?b(c):setTimeout(function(){f(a,b)},10)},g=function(){var a=-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://");return a?!0:!1},h=function(a){var b;if(g())b=a;else{var c="application/json";try{b=new Blob([a],{type:c})}catch(d){var e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"==d.name&&e){var f=new e;f.append([a.buffer]),b=f.getBlob(c)}else b=a}}return b};return{valid:function(){var b=a.requestFileSystem||a.webkitRequestFileSystem||a.moz_requestFileSystem;return!!b},init:function(b,d){function f(b){var c=a.requestFileSystem||a.webkitRequestFileSystem||a.moz_requestFileSystem,f=window.PERSISTENT;"undefined"!=typeof LocalFileSystem&&"undefined"!=typeof LocalFileSystem.PERSISTENT&&(f=LocalFileSystem.PERSISTENT),c(f,b,function(a){a.root.getDirectory(j,{create:!0},function(a){e[j]=a,d&&g.fn(g.name,d).call(g,g)},function(a){h(a)})},function(a){h(a)})}var g=this,h=function(a){c(a),d&&g.fn(g.name,d).call(g,g)},i=b.size||104857600,j=this.name;g.backup=!1,"undefined"!=typeof b.backup&&(g.backup=b.backup),"undefined"!=typeof navigator.webkitPersistentStorage?navigator.webkitPersistentStorage.requestQuota(i,f,function(){logger.warn("User declined file storage"),h("User declined file storage")}):f(0)},keys:function(a){var b=this;return f(this,function(c){d(c.createReader(),function(c){a&&b.fn("keys",a).call(b,c)})}),this},save:function(a,b){var d=this,e=a.key||this.uuid();a.key=e;var g=function(a){c(a),b&&d.lambda(b).call(d)};return f(this,function(c){var f=function(c,e){c.createWriter(function(c){c.onerror=e,c.onwriteend=function(){this.onwriteend=null,this.truncate(this.position),b&&d.lambda(b).call(d,a)};var f=JSON.stringify(a),g=h(f);c.write(g)},e)};c.getFile(e,{create:!0},function(a){"function"!=typeof a.setMetadata||d.backup!==!1&&"false"!==d.backup?f(a,g):a.setMetadata(function(){f(a,g)},function(){f(a,g)},{"com.apple.MobileBackup":1})},g)}),this},batch:function(a,b){for(var c=this,d=[],e=0,f=a.length;f>e;e++)c.save(a[e],function(a){d.push(a),d.length===f&&b&&c.lambda(b).call(c,d)});return this},get:function(a,b){var d=this;if(this.isArray(a))for(var e=[],g=0,h=a.length;h>g;g++)d.get(a[g],function(a){a&&e.push(a),e.length===h&&b&&d.lambda(b).call(d,e)});else{var i=function(a){c(a),b&&d.lambda(b).call(d)};f(this,function(c){c.getFile(a,{create:!1},function(c){c.file(function(c){var e=new FileReader;e.onerror=i,e.onload=function(c){var e={};try{e=JSON.parse(c.target.result),e.key=a}catch(c){e={key:a}}b&&d.lambda(b).call(d,e)},e.readAsText(c)},i)},i)})}return this},exists:function(a,b){var c=this;return f(this,function(d){d.getFile(a,{create:!1},function(){b&&c.lambda(b).call(c,!0)},function(){b&&c.lambda(b).call(c,!1)})}),this},all:function(a){var b=this;return a&&this.keys(function(c){c.length?b.get(c,function(c){b.fn(b.name,a).call(b,c)}):b.fn(b.name,a).call(b,[])}),this},remove:function(a,b){var d=this,e=function(a){c(a),b&&d.lambda(b).call(d)};return f(this,function(c){c.getFile("string"==typeof a?a:a.key,{create:!1},function(a){a.remove(function(){b&&d.lambda(b).call(d)},e)},e)}),this},nuke:function(a){var b=this,c=0;return this.keys(function(d){if(d.length)for(var e=0,f=d.length;f>e;e++)b.remove(d[e],function(){c++,c===f&&a&&b.lambda(a).call(b)});else a&&b.lambda(a).call(b)}),this}}}(this)),f.adapter("memory",function(){var a={};return{valid:function(){return!0},init:function(b,c){a[this.name]=a[this.name]||{index:[],store:{}},this.index=a[this.name].index,this.store=a[this.name].store;var d=this.fn(this.name,c);return d&&d.call(this,this),this},keys:function(a){return this.fn("keys",a).call(this,this.index),this},save:function(a,b){var c=a.key||this.uuid();return this.exists(c,function(d){d||(a.key&&delete a.key,this.index.push(c)),this.store[c]=a,b&&(a.key=c,this.lambda(b).call(this,a))}),this},batch:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)this.save(a[d],function(a){c.push(a)});return b&&this.lambda(b).call(this,c),this},get:function(a,b){var c;if(this.isArray(a)){c=[];for(var d=0,e=a.length;e>d;d++)c.push(this.store[a[d]])}else c=this.store[a],c&&(c.key=a);return b&&this.lambda(b).call(this,c),this},exists:function(a,b){return this.lambda(b).call(this,!!this.store[a]),this},all:function(a){for(var b=[],c=0,d=this.index.length;d>c;c++){var e=this.store[this.index[c]];e.key=this.index[c],b.push(e)}return this.fn(this.name,a).call(this,b),this},remove:function(a,b){for(var c=this.isArray(a)?a:[a],d=0,e=c.length;e>d;d++){var f=c[d].key?c[d].key:c[d],g=this.indexOf(this.index,f);0>g||(delete this.store[f],this.index.splice(g,1))}return b&&this.lambda(b).call(this),this},nuke:function(b){return this.store=a[this.name].store={},this.index=a[this.name].index=[],b&&this.lambda(b).call(this),this}}}()),e("undefined"!=typeof f?f:window.Lawnchair)}.call(c,void 0,void 0,void 0,void 0,function(a){b.exports=a})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(_dereq_,module,exports){(function(global){__browserify_shim_require__=_dereq_,function browserifyShim(module,exports,_dereq_,define,browserify_shim__define__module__export__){var JSON;JSON||(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),browserify_shim__define__module__export__("undefined"!=typeof JSON?JSON:window.JSON)}.call(global,void 0,void 0,void 0,void 0,function(a){module.exports=a})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(a,b,c){function d(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function e(){return new d(null)}function f(a,b,c,d,e,f){for(;--f>=0;){var g=b*this[a++]+c[d]+e;e=Math.floor(g/67108864),c[d++]=67108863&g}return e}function g(a,b,c,d,e,f){for(var g=32767&b,h=b>>15;--f>=0;){var i=32767&this[a],j=this[a++]>>15,k=h*i+j*g;i=g*i+((32767&k)<<15)+c[d]+(1073741823&e),e=(i>>>30)+(k>>>15)+h*j+(e>>>30),c[d++]=1073741823&i}return e}function h(a,b,c,d,e,f){for(var g=16383&b,h=b>>14;--f>=0;){var i=16383&this[a],j=this[a++]>>14,k=h*i+j*g;i=g*i+((16383&k)<<14)+c[d]+e,e=(i>>28)+(k>>14)+h*j,c[d++]=268435455&i}return e}function i(a){return oa.charAt(a)}function j(a,b){var c=pa[a.charCodeAt(b)];return null==c?-1:c}function k(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s}function l(a){this.t=1,this.s=0>a?-1:0,a>0?this[0]=a:-1>a?this[0]=a+DV:this.t=0}function m(a){var b=e();return b.fromInt(a),b}function n(a,b){var c;if(16==b)c=4;else if(8==b)c=3;else if(256==b)c=8;else if(2==b)c=1;else if(32==b)c=5;else{if(4!=b)return void this.fromRadix(a,b);c=2}this.t=0,this.s=0;for(var e=a.length,f=!1,g=0;--e>=0;){var h=8==c?255&a[e]:j(a,e);0>h?"-"==a.charAt(e)&&(f=!0):(f=!1,0==g?this[this.t++]=h:g+c>this.DB?(this[this.t-1]|=(h&(1<<this.DB-g)-1)<<g,this[this.t++]=h>>this.DB-g):this[this.t-1]|=h<<g,g+=c,g>=this.DB&&(g-=this.DB))}8==c&&0!=(128&a[0])&&(this.s=-1,g>0&&(this[this.t-1]|=(1<<this.DB-g)-1<<g)),this.clamp(),f&&d.ZERO.subTo(this,this)}function o(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t}function p(a){if(this.s<0)return"-"+this.negate().toString(a);var b;if(16==a)b=4;else if(8==a)b=3;else if(2==a)b=1;else if(32==a)b=5;else{if(4!=a)return this.toRadix(a);b=2}var c,d=(1<<b)-1,e=!1,f="",g=this.t,h=this.DB-g*this.DB%b;if(g-->0)for(h<this.DB&&(c=this[g]>>h)>0&&(e=!0,f=i(c));g>=0;)b>h?(c=(this[g]&(1<<h)-1)<<b-h,c|=this[--g]>>(h+=this.DB-b)):(c=this[g]>>(h-=b)&d,0>=h&&(h+=this.DB,--g)),c>0&&(e=!0),e&&(f+=i(c));return e?f:"0"}function q(){var a=e();return d.ZERO.subTo(this,a),a}function r(){return this.s<0?this.negate():this}function s(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(b=c-a.t,0!=b)return this.s<0?-b:b;for(;--c>=0;)if(0!=(b=this[c]-a[c]))return b;return 0}function t(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function u(){return this.t<=0?0:this.DB*(this.t-1)+t(this[this.t-1]^this.s&this.DM)}function v(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s}function w(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s}function x(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b[c+g+1]=this[c]>>e|h,h=(this[c]&f)<<d;for(c=g-1;c>=0;--c)b[c]=0;b[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()}function y(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)return void(b.t=0);var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}function z(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=0>d?-1:0,-1>d?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()}function A(a,b){var c=this.abs(),e=a.abs(),f=c.t;for(b.t=f+e.t;--f>=0;)b[f]=0;for(f=0;f<e.t;++f)b[f+c.t]=c.am(0,e[f],b,f,0,c.t);b.s=0,b.clamp(),this.s!=a.s&&d.ZERO.subTo(b,b)}function B(a){for(var b=this.abs(),c=a.t=2*b.t;--c>=0;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}a.t>0&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()}function C(a,b,c){var f=a.abs();if(!(f.t<=0)){var g=this.abs();if(g.t<f.t)return null!=b&&b.fromInt(0),void(null!=c&&this.copyTo(c));null==c&&(c=e());var h=e(),i=this.s,j=a.s,k=this.DB-t(f[f.t-1]);k>0?(f.lShiftTo(k,h),g.lShiftTo(k,c)):(f.copyTo(h),g.copyTo(c));var l=h.t,m=h[l-1];if(0!=m){var n=m*(1<<this.F1)+(l>1?h[l-2]>>this.F2:0),o=this.FV/n,p=(1<<this.F1)/n,q=1<<this.F2,r=c.t,s=r-l,u=null==b?e():b;for(h.dlShiftTo(s,u),c.compareTo(u)>=0&&(c[c.t++]=1,c.subTo(u,c)),d.ONE.dlShiftTo(l,u),u.subTo(h,h);h.t<l;)h[h.t++]=0;for(;--s>=0;){var v=c[--r]==m?this.DM:Math.floor(c[r]*o+(c[r-1]+q)*p);if((c[r]+=h.am(0,v,c,s,0,l))<v)for(h.dlShiftTo(s,u),c.subTo(u,c);c[r]<--v;)c.subTo(u,c)}null!=b&&(c.drShiftTo(l,b),i!=j&&d.ZERO.subTo(b,b)),c.t=l,c.clamp(),k>0&&c.rShiftTo(k,c),0>i&&d.ZERO.subTo(c,c)}}}function D(a){var b=e();return this.abs().divRemTo(a,null,b),this.s<0&&b.compareTo(d.ZERO)>0&&a.subTo(b,b),b}function E(a){this.m=a}function F(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function G(a){return a}function H(a){a.divRemTo(this.m,null,a)}function I(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function J(a,b){a.squareTo(b),this.reduce(b)}function K(){if(this.t<1)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a;return b=b*(2-(15&a)*b)&15,b=b*(2-(255&a)*b)&255,b=b*(2-((65535&a)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV,b>0?this.DV-b:-b}function L(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function M(a){var b=e();return a.abs().dlShiftTo(this.m.t,b),b.divRemTo(this.m,null,b),a.s<0&&b.compareTo(d.ZERO)>0&&this.m.subTo(b,b),b}function N(a){var b=e();return a.copyTo(b),this.reduce(b),b}function O(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a[b],d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;for(c=b+this.m.t,a[c]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function P(a,b){a.squareTo(b),this.reduce(b)}function Q(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function R(){return 0==(this.t>0?1&this[0]:this.s)}function S(a,b){if(a>4294967295||1>a)return d.ONE;var c=e(),f=e(),g=b.convert(this),h=t(a)-1;for(g.copyTo(c);--h>=0;)if(b.sqrTo(c,f),(a&1<<h)>0)b.mulTo(f,g,c);else{var i=c;c=f,f=i}return b.revert(c)}function T(a,b){var c;return c=256>a||b.isEven()?new E(b):new L(b),this.exp(a,c)}function U(){this.i=0,this.j=0,this.S=new Array}function V(a){var b,c,d;for(b=0;256>b;++b)this.S[b]=b;for(c=0,b=0;256>b;++b)c=c+this.S[b]+a[b%a.length]&255,d=this.S[b],this.S[b]=this.S[c],this.S[c]=d;this.i=0,this.j=0}function W(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}function X(){return new U}function Y(a){ra[sa++]^=255&a,ra[sa++]^=a>>8&255,ra[sa++]^=a>>16&255,ra[sa++]^=a>>24&255,sa>=ta&&(sa-=ta)}function Z(){Y((new Date).getTime())}function $(){if(null==qa){for(Z(),qa=X(),qa.init(ra),sa=0;sa<ra.length;++sa)ra[sa]=0;sa=0}return qa.next()}function _(a){var b;for(b=0;b<a.length;++b)a[b]=$()}function aa(){}function ba(a,b){return new d(a,b)}function ca(a){return 16>a?"0"+a.toString(16):a.toString(16)}function da(a,b){if(b<a.length+11)return alert("Message too long for RSA"),null;for(var c=new Array,e=a.length-1;e>=0&&b>0;){var f=a.charCodeAt(e--);128>f?c[--b]=f:f>127&&2048>f?(c[--b]=63&f|128,c[--b]=f>>6|192):(c[--b]=63&f|128,c[--b]=f>>6&63|128,c[--b]=f>>12|224)}c[--b]=0;for(var g=new aa,h=new Array;b>2;){for(h[0]=0;0==h[0];)g.nextBytes(h);c[--b]=h[0]}return c[--b]=2,c[--b]=0,new d(c)}function ea(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function fa(a,b){null!=a&&null!=b&&a.length>0&&b.length>0?(this.n=ba(a,16),this.e=parseInt(b,16)):alert("Invalid RSA public key")}function ga(a){return a.modPowInt(this.e,this.n)}function ha(a){var b=da(a,this.n.bitLength()+7>>3);if(null==b)return null;var c=this.doPublic(b);if(null==c)return null;var d=c.toString(16);return 0==(1&d.length)?d:"0"+d}var ia,ja=0xdeadbeefcafe,ka=15715070==(16777215&ja);ka&&"Microsoft Internet Explorer"==navigator.appName?(d.prototype.am=g,ia=30):ka&&"Netscape"!=navigator.appName?(d.prototype.am=f,ia=26):(d.prototype.am=h,ia=28),d.prototype.DB=ia,d.prototype.DM=(1<<ia)-1,d.prototype.DV=1<<ia;var la=52;d.prototype.FV=Math.pow(2,la),d.prototype.F1=la-ia,d.prototype.F2=2*ia-la;var ma,na,oa="0123456789abcdefghijklmnopqrstuvwxyz",pa=new Array;for(ma="0".charCodeAt(0),na=0;9>=na;++na)pa[ma++]=na;for(ma="a".charCodeAt(0),na=10;36>na;++na)pa[ma++]=na;for(ma="A".charCodeAt(0),na=10;36>na;++na)pa[ma++]=na;E.prototype.convert=F,E.prototype.revert=G,E.prototype.reduce=H,E.prototype.mulTo=I,E.prototype.sqrTo=J,L.prototype.convert=M,L.prototype.revert=N,L.prototype.reduce=O,L.prototype.mulTo=Q,L.prototype.sqrTo=P,d.prototype.copyTo=k,d.prototype.fromInt=l,d.prototype.fromString=n,d.prototype.clamp=o,d.prototype.dlShiftTo=v,d.prototype.drShiftTo=w,d.prototype.lShiftTo=x,d.prototype.rShiftTo=y,d.prototype.subTo=z,d.prototype.multiplyTo=A,d.prototype.squareTo=B,d.prototype.divRemTo=C,d.prototype.invDigit=K,d.prototype.isEven=R,d.prototype.exp=S,d.prototype.toString=p,d.prototype.negate=q,d.prototype.abs=r,d.prototype.compareTo=s,d.prototype.bitLength=u,d.prototype.mod=D,d.prototype.modPowInt=T,d.ZERO=m(0),d.ONE=m(1),U.prototype.init=V,U.prototype.next=W;var qa,ra,sa,ta=256;if(null==ra){ra=new Array,sa=0;var ua;if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&window.crypto){var va=window.crypto.random(32);for(ua=0;ua<va.length;++ua)ra[sa++]=255&va.charCodeAt(ua)}for(;ta>sa;)ua=Math.floor(65536*Math.random()),ra[sa++]=ua>>>8,ra[sa++]=255&ua;sa=0,Z()}aa.prototype.nextBytes=_,ea.prototype.doPublic=ga,ea.prototype.setPublic=fa,ea.prototype.encrypt=ha,b.exports={SecureRandom:aa,byte2Hex:ca,RSAKey:ea}},{}],5:[function(a,b,c){function d(a,b){return n.isUndefined(b)?""+b:!n.isNumber(b)||!isNaN(b)&&isFinite(b)?n.isFunction(b)||n.isRegExp(b)?b.toString():b:b.toString()}function e(a,b){return n.isString(a)?a.length<b?a:a.slice(0,b):a}function f(a){return e(JSON.stringify(a.actual,d),128)+" "+a.operator+" "+e(JSON.stringify(a.expected,d),128)}function g(a,b,c,d,e){throw new q.AssertionError({message:c,actual:a,expected:b,operator:d,stackStartFunction:e})}function h(a,b){a||g(a,!0,b,"==",q.ok)}function i(a,b){if(a===b)return!0;if(n.isBuffer(a)&&n.isBuffer(b)){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return n.isDate(a)&&n.isDate(b)?a.getTime()===b.getTime():n.isRegExp(a)&&n.isRegExp(b)?a.source===b.source&&a.global===b.global&&a.multiline===b.multiline&&a.lastIndex===b.lastIndex&&a.ignoreCase===b.ignoreCase:n.isObject(a)||n.isObject(b)?k(a,b):a==b}function j(a){return"[object Arguments]"==Object.prototype.toString.call(a)}function k(a,b){if(n.isNullOrUndefined(a)||n.isNullOrUndefined(b))return!1;if(a.prototype!==b.prototype)return!1;if(j(a))return j(b)?(a=o.call(a),b=o.call(b),i(a,b)):!1;try{var c,d,e=r(a),f=r(b)}catch(g){return!1}if(e.length!=f.length)return!1;for(e.sort(),f.sort(),d=e.length-1;d>=0;d--)if(e[d]!=f[d])return!1;for(d=e.length-1;d>=0;d--)if(c=e[d],!i(a[c],b[c]))return!1;return!0}function l(a,b){return a&&b?"[object RegExp]"==Object.prototype.toString.call(b)?b.test(a):a instanceof b?!0:b.call({},a)===!0?!0:!1:!1}function m(a,b,c,d){var e;n.isString(c)&&(d=c,c=null);try{b()}catch(f){e=f}if(d=(c&&c.name?" ("+c.name+").":".")+(d?" "+d:"."),a&&!e&&g(e,c,"Missing expected exception"+d),!a&&l(e,c)&&g(e,c,"Got unwanted exception"+d),a&&e&&c&&!l(e,c)||!a&&e)throw e}var n=a("util/"),o=Array.prototype.slice,p=Object.prototype.hasOwnProperty,q=b.exports=h;q.AssertionError=function(a){this.name="AssertionError",this.actual=a.actual,this.expected=a.expected,this.operator=a.operator,a.message?(this.message=a.message,this.generatedMessage=!1):(this.message=f(this),this.generatedMessage=!0);var b=a.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,b);else{var c=new Error;if(c.stack){var d=c.stack,e=b.name,h=d.indexOf("\n"+e);if(h>=0){var i=d.indexOf("\n",h+1);d=d.substring(i+1)}this.stack=d}}},n.inherits(q.AssertionError,Error),q.fail=g,q.ok=h,q.equal=function(a,b,c){a!=b&&g(a,b,c,"==",q.equal)},q.notEqual=function(a,b,c){a==b&&g(a,b,c,"!=",q.notEqual)},q.deepEqual=function(a,b,c){i(a,b)||g(a,b,c,"deepEqual",q.deepEqual)},q.notDeepEqual=function(a,b,c){i(a,b)&&g(a,b,c,"notDeepEqual",q.notDeepEqual)},q.strictEqual=function(a,b,c){a!==b&&g(a,b,c,"===",q.strictEqual)},q.notStrictEqual=function(a,b,c){a===b&&g(a,b,c,"!==",q.notStrictEqual)},q["throws"]=function(a,b,c){m.apply(this,[!0].concat(o.call(arguments)))},q.doesNotThrow=function(a,b){m.apply(this,[!1].concat(o.call(arguments)))},q.ifError=function(a){if(a)throw a};var r=Object.keys||function(a){var b=[];for(var c in a)p.call(a,c)&&b.push(c);return b}},{"util/":11}],6:[function(a,b,c){(function(c){function d(){}function e(){m.log.apply(m,arguments)}function f(){m.log.apply(m,arguments)}function g(){m.warn.apply(m,arguments)}function h(a){p[a]=Date.now()}function i(a){var b=p[a];if(!b)throw new Error("No such label: "+a);var c=Date.now()-b;m.log(a+": "+c+"ms")}function j(){var a=new Error;a.name="Trace",a.message=n.format.apply(null,arguments),m.error(a.stack)}function k(a){m.log(n.inspect(a)+"\n")}function l(a){if(!a){var b=o.call(arguments,1);l.ok(!1,n.format.apply(null,b))}}var m,n=a("util"),l=a("assert"),o=Array.prototype.slice,p={};m="undefined"!=typeof c&&c.console?c.console:"undefined"!=typeof window&&window.console?window.console:{};for(var q=[[d,"log"],[e,"info"],[f,"warn"],[g,"error"],[h,"time"],[i,"timeEnd"],[j,"trace"],[k,"dir"],[l,"assert"]],r=0;r<q.length;r++){var s=q[r],t=s[0],u=s[1];m[u]||(m[u]=t)}b.exports=m}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{assert:5,util:11}],7:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],8:[function(a,b,c){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],9:[function(a,b,c){var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.binding=function(a){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],10:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],11:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)f.push(F(b,String(g))?m(a,b,c,d,String(g),!0):"");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){
return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("/mnt/src/fh-js-sdk/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":10,"/mnt/src/fh-js-sdk/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":9,inherits:8}],12:[function(a,b,c){!function(a){var c="undefined";!function(a,c){"undefined"!=typeof b?b.exports=c():"function"==typeof define&&"object"==typeof define.amd?define(c):this[a]=c()}("log",function(){function b(b){return typeof console===c?l:console[b]===a?console.log!==a?d(console,"log"):l:d(console,b)}function d(b,c){var d=b[c];if(d.bind!==a)return b[c].bind(b);if(Function.prototype.bind===a)return e(d,b);try{return Function.prototype.bind.call(b[c],b)}catch(f){return e(d,b)}}function e(a,b){return function(){Function.prototype.apply.apply(a,[b,arguments])}}function f(a){for(var b=0;b<m.length;b++)k[m[b]]=a(m[b])}function g(){return typeof window!==c&&window.document!==a&&window.document.cookie!==a}function h(){try{return typeof window!==c&&window.localStorage!==a}catch(b){return!1}}function i(a){var b,c=!1;for(var d in k.levels)if(k.levels.hasOwnProperty(d)&&k.levels[d]===a){b=d;break}if(h())try{window.localStorage.loglevel=b}catch(e){c=!0}else c=!0;c&&g()&&(window.document.cookie="loglevel="+b+";")}function j(){var b;if(h()&&(b=window.localStorage.loglevel),b===a&&g()){var c=n.exec(window.document.cookie)||[];b=c[1]}k.levels[b]===a&&(b="WARN"),k.setLevel(k.levels[b])}var k={},l=function(){},m=["trace","debug","info","warn","error"],n=/loglevel=([^;]+)/;return k.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},k.setLevel=function(d){if("number"==typeof d&&d>=0&&d<=k.levels.SILENT){if(i(d),d===k.levels.SILENT)return void f(function(){return l});if(typeof console===c)return f(function(a){return function(){typeof console!==c&&(k.setLevel(d),k[a].apply(k,arguments))}}),"No console available for logging";f(function(a){return d<=k.levels[a.toUpperCase()]?b(a):l})}else{if("string"!=typeof d||k.levels[d.toUpperCase()]===a)throw"log.setLevel() called with invalid level: "+d;k.setLevel(k.levels[d.toUpperCase()])}},k.enableAll=function(){k.setLevel(k.levels.TRACE)},k.disableAll=function(){k.setLevel(k.levels.SILENT)},j(),k})}()},{}],13:[function(a,b,c){var d=Object.prototype.toString;b.exports=function(a){switch(d.call(a)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}if("object"==typeof a&&a&&"number"==typeof a.length)try{if("function"==typeof a.callee)return"arguments"}catch(b){if(b instanceof TypeError)return"arguments"}return null===a?"null":void 0===a?"undefined":a&&1===a.nodeType?"element":a===Object(a)?"object":typeof a}},{}],14:[function(a,b,c){var d=a("./modules/constants"),e=a("./modules/events"),f=a("./modules/logger"),g=a("./modules/ajax"),e=a("./modules/events"),h=a("./modules/waitForCloud"),i=a("./modules/api_act"),j=a("./modules/api_auth"),k=a("./modules/api_sec"),l=a("./modules/api_hash"),m=a("./modules/sync-cli"),n=a("./modules/api_mbaas"),o=a("./modules/api_cloud"),p=a("./modules/fhparams"),q=a("./modules/appProps"),r=a("./modules/device"),s=function(a,b){e.addListener(a,b),a===d.INIT_EVENT&&(h.isReady()?b(null,{host:h.getCloudHostUrl()}):h.getInitError()&&b(h.getInitError()))},t=function(a,b){a===d.INIT_EVENT&&h.isReady()?b(null,{host:h.getCloudHostUrl()}):a===d.INIT_EVENT&&h.getInitError()?b(h.getInitError()):e.once(a,b)},u=function(a,b,c){f.warn("$fh.init will be deprecated soon"),h.ready(function(a,d){if(a){if("function"==typeof c)return c(a)}else"function"==typeof b&&b(d.host)})},v=window.$fh||{};v.init=u,v.act=i,v.auth=j,v.cloud=o,v.sec=k,v.hash=l,v.sync=m,v.ajax=v.__ajax=g,v.mbaas=n,v._getDeviceId=r.getDeviceId,v.fh_timeout=6e4,v.getCloudURL=function(){return h.getCloudHostUrl()},v.getFHParams=function(){return p.buildFHParams()},v.addListener=s,v.on=s,v.once=t;for(var w=["removeListener","removeAllListeners","setMaxListeners","listeners","emit"],x=0;x<w.length;x++)v[w[x]]=e[w[x]];v.on(d.INIT_EVENT,function(a,b){a?(v.cloud_props={},v.app_props={}):(v.cloud_props={hosts:{url:b.host}},v.app_props=q.getAppProps())}),v.on(d.INTERNAL_CONFIG_LOADED_EVENT,function(a,b){v.app_props=a?{}:q.getAppProps(),e.emit(d.CONFIG_LOADED_EVENT,null)}),v.reset=h.reset,window.$fh=v,b.exports=v},{"./modules/ajax":16,"./modules/api_act":17,"./modules/api_auth":18,"./modules/api_cloud":19,"./modules/api_hash":20,"./modules/api_mbaas":21,"./modules/api_sec":22,"./modules/appProps":23,"./modules/constants":25,"./modules/device":27,"./modules/events":28,"./modules/fhparams":29,"./modules/logger":35,"./modules/sync-cli":43,"./modules/waitForCloud":45}],15:[function(a,b,c){var d=function(a){this.xdr=a,this.isWrapper=!0,this.readyState=0,this.onreadystatechange=null,this.status=0,this.statusText="",this.responseText="";var b=this;this.xdr.onload=function(){b.readyState=4,b.status=200,b.statusText="",b.responseText=b.xdr.responseText,b.onreadystatechange&&b.onreadystatechange()},this.xdr.onerror=function(){b.onerror&&b.onerror(),b.readyState=4,b.status=0,b.statusText="",b.onreadystatechange&&b.onreadystatechange()},this.xdr.ontimeout=function(){b.readyState=4,b.status=408,b.statusText="timeout",b.onreadystatechange&&b.onreadystatechange()}};d.prototype.open=function(a,b,c){this.xdr.open(a,b)},d.prototype.send=function(a){this.xdr.send(a)},d.prototype.abort=function(){this.xdr.abort()},d.prototype.setRequestHeader=function(a,b){},d.prototype.getResponseHeader=function(a){},b.exports=d},{}],16:[function(a,b,c){function d(a,b,c){return v.emit(b,c),!0}function e(a,b,c,e){return a.global?d(b||D,c,e):void 0}function f(a){a.global&&0===J.active++&&e(a,null,"ajaxStart")}function g(a){a.global&&!--J.active&&e(a,null,"ajaxStop")}function h(a,b){var c=b.context;return b.beforeSend.call(c,a,b)===!1?!1:void e(b,c,"ajaxSend",[a,b])}function i(a,b,c){var d=c.context,f="success";c.success.call(d,a,f,b),e(c,d,"ajaxSuccess",[b,c,a]),k(f,b,c)}function j(a,b,c,d){var f=d.context;d.error.call(f,c,b,a),e(d,f,"ajaxError",[c,d,a]),k(b,c,d)}function k(a,b,c){var d=c.context;c.complete.call(d,b,a),e(c,d,"ajaxComplete",[b,c]),g(c)}function l(){}function m(){var a=!1;return navigator.userAgent&&navigator.userAgent.indexOf("MSIE")>=0&&(a=!0),a}function n(a){var b=null;if(window.XMLHttpRequest&&(b=new XMLHttpRequest),m()&&a===!0&&"undefined"!=typeof window.XDomainRequest&&"undefined"==typeof window.cordova&&(b=new w(new XDomainRequest)),"undefined"!=typeof Titanium){var c={};J.settings&&J.settings.timeout&&(c.timeout=J.settings.timeout),b=Titanium.Network.createHTTPClient(c)}return b}function o(a){return a&&(a==H?"html":a==G?"json":E.test(a)?"script":F.test(a)&&"xml")||"text"}function p(a,b){return(a+"&"+b).replace(/[&?]{1,2}/,"?")}function q(a){"object"===u(a.data)&&("function"==typeof a.data.append?a.formdata=!0:a.data=s(a.data)),!a.data||a.type&&"GET"!=a.type.toUpperCase()||(a.url=p(a.url,a.data))}function r(a,b,c,d){var e="array"===u(b);for(var f in b){var g=b[f];d&&(f=c?d:d+"["+(e?"":f)+"]"),!d&&e?a.add(g.name,g.value):(c?"array"===u(g):"object"===u(g))?r(a,g,c,f):a.add(f,g)}}function s(a,b){var c=[];return c.add=function(a,b){this.push(K(a)+"="+K(b))},r(c,a,b),c.join("&").replace("%20","+")}function t(a){var b=Array.prototype.slice;return b.call(arguments,1).forEach(function(b){for(A in b)void 0!==b[A]&&(a[A]=b[A])}),a}var u,v=a("./events"),w=a("./XDomainRequestWrapper"),x=a("./logger");try{u=a("type-of")}catch(y){var z=a;u=z("type")}var A,B,C=0,D=window.document,E=/^(?:text|application)\/javascript/i,F=/^(?:text|application)\/xml/i,G="application/json",H="text/html",I=/^\s*$/,J=b.exports=function(a){var b=t({},a||{});window&&window.$fh&&"number"==typeof window.$fh.fh_timeout&&(J.settings.timeout=window.$fh.fh_timeout);for(A in J.settings)void 0===b[A]&&(b[A]=J.settings[A]);f(b),b.crossDomain||(b.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(b.url)&&(RegExp.$1!=window.location.protocol||RegExp.$2!=window.location.host));var c=b.dataType,d=/=\?/.test(b.url);if("jsonp"==c||d)return d||(b.url=p(b.url,(b.jsonp?b.jsonp:"_callback")+"=?")),J.JSONP(b);b.url||(b.url=window.location.toString()),q(b);var e=b.accepts[c],g={},k=/^([\w-]+:)\/\//.test(b.url)?RegExp.$1:window.location.protocol,m=b.xhr(b.crossDomain),n=null;b.crossDomain||(g["X-Requested-With"]="XMLHttpRequest"),e&&(g.Accept=e,e.indexOf(",")>-1&&(e=e.split(",",2)[0]),m.overrideMimeType&&m.overrideMimeType(e)),(b.contentType||b.data&&!b.formdata&&"GET"!=b.type.toUpperCase())&&(g["Content-Type"]=b.contentType||"application/x-www-form-urlencoded"),b.headers=t(g,b.headers||{}),"undefined"!=typeof Titanium&&(m.onerror=function(){n&&(clearTimeout(n),j(null,"error",m,b))}),m.onreadystatechange=function(){if(4==m.readyState){clearTimeout(n),n=void 0;var a,d=!1;if(b.tryJSONP&&0===m.status&&b.crossDomain&&!m.isTimeout&&"file:"!=k)return x.debug("retry ajax call with jsonp"),b.type="GET",b.dataType="jsonp",b.data="_jsonpdata="+b.data,J(b);if(m.status>=200&&m.status<300||304==m.status||0==m.status&&"file:"==k){c=c||o(m.getResponseHeader("content-type")),a=m.responseText,x.debug("ajax response :: status = "+m.status+" :: body = "+a);try{"script"==c?(1,eval)(a):"xml"==c?a=m.responseXML:"json"==c&&(a=I.test(a)?null:JSON.parse(a))}catch(e){d=e}d?(x.debug("ajax error",d),j(d,"parsererror",m,b)):i(a,m,b)}else j(null,"error",m,b)}};var r="async"in b?b.async:!0;x.debug("ajax call settings",b),m.open(b.type,b.url,r);for(B in b.headers)m.setRequestHeader(B,b.headers[B]);return h(m,b)===!1?(x.debug("ajax call is aborted due to ajaxBeforeSend"),m.abort(),!1):(b.timeout>0&&(n=setTimeout(function(){x.debug("ajax call timed out"),m.onreadystatechange=l,m.abort(),m.isTimeout=!0,j(null,"timeout",m,b)},b.timeout)),m.send(b.data?b.data:null),m)};J.active=0,J.JSONP=function(a){if(!("type"in a))return J(a);var b,c="jsonp"+ ++C,d=D.createElement("script"),e=function(){c in window&&(window[c]=l),k("abort",f,a)},f={abort:e},g=D.getElementsByTagName("head")[0]||D.documentElement;return a.error&&(d.onerror=function(){f.abort(),a.error()}),window[c]=function(d){clearTimeout(b),b=void 0,delete window[c],i(d,f,a)},q(a),d.src=a.url.replace(/=\?/,"="+c),g.insertBefore(d,g.firstChild),a.timeout>0&&(b=setTimeout(function(){f.abort(),k("timeout",f,a)},a.timeout)),f},J.settings={type:"GET",beforeSend:l,success:l,error:l,complete:l,context:null,global:!0,xhr:n,accepts:{script:"text/javascript, application/javascript",json:G,xml:"application/xml, text/xml",html:H,text:"text/plain"},crossDomain:!1},J.get=function(a,b){return J({url:a,success:b})},J.post=function(a,b,c,d){return"function"===u(b)&&(d=d||c,c=b,b=null),J({type:"POST",url:a,data:b,success:c,dataType:d})},J.getJSON=function(a,b){return J({url:a,success:b,dataType:"json"})};var K=encodeURIComponent},{"./XDomainRequestWrapper":15,"./events":28,"./logger":35,"type-of":13}],17:[function(a,b,c){function d(a,b,c){var d=f.getCloudHost(),e=d.getActUrl(a.act),l=a.req||{};return l=g.addFHParams(l),h({url:e,tryJSONP:"undefined"==typeof Titanium,type:"POST",dataType:"json",data:i.stringify(l),contentType:"application/json",timeout:a.timeout||k.timeout,success:b,error:function(a,b,d){return j(c,a,b,d)}})}var e=a("./logger"),f=a("./waitForCloud"),g=a("./fhparams"),h=a("./ajax"),i=a("JSON"),j=a("./handleError"),k=a("./appProps");b.exports=function(a,b,c){return e.debug("act is called"),c||(c=function(a,b){e.debug(a+":"+i.stringify(b))}),a.act?void f.ready(function(f,g){return e.debug("Calling fhact now"),f?c(f.message,f):void d(a,b,c)}):c("act_no_action",{})}},{"./ajax":16,"./appProps":23,"./fhparams":29,"./handleError":30,"./logger":35,"./waitForCloud":45,JSON:3}],18:[function(a,b,c){var d=a("./logger"),e=a("./waitForCloud"),f=a("./fhparams"),g=a("./ajax"),h=a("JSON"),i=a("./handleError"),j=a("./device"),k=a("./constants"),l=a("./checkAuth"),m=a("./appProps");b.exports=function(a,b,c){return c||(c=function(a,b){d.debug(a+":"+h.stringify(b))}),a.policyId?a.clientToken?void e.ready(function(d,e){if(d)return c(d.message,d);var n={};n.policyId=a.policyId,n.clientToken=a.clientToken,a.endRedirectUrl&&(n.endRedirectUrl=a.endRedirectUrl,a.authCallback&&(n.endRedirectUrl+=(/\?/.test(n.endRedirectUrl)?"&":"?")+"_fhAuthCallback="+a.authCallback)),n.params={},a.params&&(n.params=a.params);var o=a.endRedirectUrl||"status=complete";n.device=j.getDeviceId();var p=m.getAppProps(),q=p.host+k.boxprefix+"admin/authpolicy/auth";p.local&&(q=k.boxprefix+"admin/authpolicy/auth"),n=f.addFHParams(n),g({url:q,type:"POST",tryJSONP:"undefined"==typeof Titanium,data:h.stringify(n),dataType:"json",contentType:"application/json",timeout:a.timeout||p.timeout,success:function(a){l.handleAuthResponse(o,a,b,c)},error:function(a,b,d){i(c,a,b,d)}})}):c("auth_no_clientToken",{}):c("auth_no_policyId",{})}},{"./ajax":16,"./appProps":23,"./checkAuth":24,"./constants":25,"./device":27,"./fhparams":29,"./handleError":30,"./logger":35,"./waitForCloud":45,JSON:3}],19:[function(a,b,c){function d(a,b,c){var d=f.getCloudHost(),e=d.getCloudUrl(a.path),l=a.data||{};l=g.addFHParams(l);var m,n=a.method||"POST";return m="POST"===n.toUpperCase()?i.stringify(l):l,h({url:e,type:n,dataType:a.dataType||"json",data:m,contentType:a.contentType||"application/json",timeout:a.timeout||k.timeout,success:b,error:function(a,b,d){return j(c,a,b,d)}})}var e=a("./logger"),f=a("./waitForCloud"),g=a("./fhparams"),h=a("./ajax"),i=a("JSON"),j=a("./handleError"),k=a("./appProps");b.exports=function(a,b,c){e.debug("cloud is called"),c||(c=function(a,b){e.debug(a+":"+i.stringify(b))}),f.ready(function(f,g){return e.debug("Calling fhact now"),f?c(f.message,f):void d(a,b,c)})}},{"./ajax":16,"./appProps":23,"./fhparams":29,"./handleError":30,"./logger":35,"./waitForCloud":45,JSON:3}],20:[function(a,b,c){var d=a("./security/hash");b.exports=function(a,b,c){var e={};"undefined"==typeof a.algorithm&&(a.algorithm="MD5"),e.act="hash",e.params=a,d(e,b,c)}},{"./security/hash":41}],21:[function(a,b,c){var d=a("./logger"),e=a("./waitForCloud"),f=a("./fhparams"),g=a("./ajax"),h=a("JSON"),i=a("./handleError"),j=(a("./constants"),a("./appProps"));b.exports=function(a,b,c){d.debug("mbaas is called."),c||(c=function(a,b){console.debug(a+":"+h.stringify(b))});var k=a.service,l=a.params;e.ready(function(m,n){if(d.debug("Calling mbaas now"),m)return c(m.message,m);var o=e.getCloudHost(),p=o.getMBAASUrl(k);return l=f.addFHParams(l),g({url:p,tryJSONP:"undefined"==typeof Titanium,type:"POST",dataType:"json",data:h.stringify(l),contentType:"application/json",timeout:a.timeout||j.timeout,success:b,error:function(a,b,d){return i(c,a,b,d)}})})}},{"./ajax":16,"./appProps":23,"./constants":25,"./fhparams":29,"./handleError":30,"./logger":35,"./waitForCloud":45,JSON:3}],22:[function(a,b,c){var d=a("./security/aes-keygen"),e=a("./security/aes-node"),f=a("./security/rsa-node"),g=a("./security/hash");b.exports=function(a,b,c){return a.act?a.params?a.params.algorithm?(a.params.algorithm=a.params.algorithm.toLowerCase(),"hash"===a.act?g(a,b,c):"encrypt"===a.act?"aes"===a.params.algorithm?e.encrypt(a,b,c):"rsa"===a.params.algorithm?f.encrypt(a,b,c):c("encrypt_bad_algorithm:"+a.params.algorithm,{},a):"decrypt"===a.act?"aes"===a.params.algorithm?e.decrypt(a,b,c):c("decrypt_bad_algorithm:"+a.params.algorithm,{},a):"keygen"===a.act?"aes"===a.params.algorithm?d(a,b,c):c("keygen_bad_algorithm:"+a.params.algorithm,{},a):void 0):void c("no_params_algorithm",{},a):void c("no_params",{},a):void c("bad_act",{},a)}},{"./security/aes-keygen":39,"./security/aes-node":40,"./security/hash":41,"./security/rsa-node":42}],23:[function(a,b,c){var d=a("./constants"),e=a("./ajax"),f=a("./logger"),g=a("./queryMap"),h=null,i=function(a){var b=document.location.href,c=g(b),i="undefined"!=typeof c.url;if(i)return h={},h.local=!0,h.host=c.url.replace(/#.*?$/g,""),h.appid="000000000000000000000000",h.appkey="0000000000000000000000000000000000000000",h.projectid="000000000000000000000000",h.connectiontag="0.0.1",h.loglevel=c.loglevel,a(null,h);var j=c.fhconfig||d.config_js;e({url:j,dataType:"json",success:function(b){return f.debug("fhconfig = "+JSON.stringify(b)),null==b?window.fh_app_props?(h=window.fh_app_props,a(null,window.fh_app_props)):a(new Error("app_config_missing")):(h=b,void a(null,h))},error:function(b,c,e){return window.fh_app_props?(h=window.fh_app_props,a(null,window.fh_app_props)):(f.error(d.config_js+" Not Found"),void a(new Error("app_config_missing")))}})},j=function(a){h=a},k=function(){return h};b.exports={load:i,getAppProps:k,setAppProps:j}},{"./ajax":16,"./constants":25,"./logger":35,"./queryMap":37}],24:[function(a,b,c){var d=a("./logger"),e=a("./queryMap"),f=a("JSON"),g=a("./fhparams"),h=function(a){if(/\_fhAuthCallback/.test(a)){var b=e(a);if(b){var c=b._fhAuthCallback;if(c)if(b.result&&"success"===b.result){var d={sessionToken:b.fh_auth_session,authResponse:f.parse(decodeURIComponent(decodeURIComponent(b.authResponse)))};g.setAuthSessionToken(b.fh_auth_session),window[c](null,d)}else window[c]({message:b.message})}}},i=function(a,b,c,h){if(b.status&&"ok"===b.status){var i=function(a){a.sessionToken&&g.setAuthSessionToken(a.sessionToken),c(a)};if(b.url){var j=null,k=function(b){if(b.indexOf(a)>-1){j&&j.close();var c=e(b);if(c)if(c.result&&"success"===c.result){var d={sessionToken:c.fh_auth_session,authResponse:f.parse(decodeURIComponent(decodeURIComponent(c.authResponse)))};i(d)}else h&&h("auth_failed",{message:c.message});else h&&h("auth_failed",{message:c.message})}};if(window.PhoneGap||window.cordova)if(window.plugins&&window.plugins.childBrowser)"function"==typeof window.plugins.childBrowser.showWebPage&&(window.plugins.childBrowser.onLocationChange=k,window.plugins.childBrowser.showWebPage(b.url),j=window.plugins.childBrowser);else try{j=window.open(b.url,"_blank","location=yes"),j.addEventListener("loadstart",function(a){k(a.url)})}catch(l){d.info("InAppBrowser plugin is not intalled."),i(b)}else document.location.href=b.url}else i(b)}else h&&h("auth_failed",b)};window.addEventListener?window.addEventListener("load",function(){h(window.location.href)},!1):window.attachEvent&&window.attachEvent("onload",function(){h(window.location.href)}),b.exports={handleAuthResponse:i}},{"./fhparams":29,"./logger":35,"./queryMap":37,JSON:3}],25:[function(a,b,c){b.exports={boxprefix:"/box/srv/1.1/",sdk_version:"2.5.1-BUILD-NUMBER",config_js:"fhconfig.json",INIT_EVENT:"fhinit",INTERNAL_CONFIG_LOADED_EVENT:"internalfhconfigloaded",CONFIG_LOADED_EVENT:"fhconfigloaded"}},{}],26:[function(a,b,c){b.exports={readCookieValue:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},createCookie:function(a,b){var c=new Date;c.setTime(c.getTime()+31536e8);var d="; expires="+c.toGMTString();document.cookie=a+"="+b+d+"; path = /"}}},{}],27:[function(a,b,c){var d=a("./cookies"),e=a("./uuid"),f=a("./logger");b.exports={getDeviceId:function(){if("undefined"!=typeof window.fhdevice&&"undefined"!=typeof window.fhdevice.uuid)return window.fhdevice.uuid;if("undefined"!=typeof window.device&&"undefined"!=typeof window.device.uuid)return window.device.uuid;if("undefined"!=typeof navigator.device&&"undefined"!=typeof navigator.device.uuid)return navigator.device.uuid;var a="mock_uuid",b=d.readCookieValue(a);return null==b&&(b=e.createUUID(),d.createCookie(a,b)),b},getCuidMap:function(){return"undefined"!=typeof window.fhdevice&&"undefined"!=typeof window.fhdevice.cuidMap?window.fhdevice.cuidMap:"undefined"!=typeof window.device&&"undefined"!=typeof window.device.cuidMap?window.device.cuidMap:"undefined"!=typeof navigator.device&&"undefined"!=typeof navigator.device.cuidMap?navigator.device.cuidMap:null},getDestination:function(){var b=null,c=a("./platformsMap"),d=navigator.userAgent,e=document.location.search.split("fh_destination_code=");return e.length>1?b=e[1]:"undefined"!=typeof window.fh_destination_code?b=window.fh_destination_code:c.forEach(function(a){a.test.forEach(function(c){d.indexOf(c)>-1&&(b=a.destination)})}),null==b&&(b="web"),f.debug("destination = "+b),b}}},{"./cookies":26,"./logger":35,"./platformsMap":36,"./uuid":44}],28:[function(a,b,c){var d=a("events").EventEmitter,e=new d;e.setMaxListeners(0),b.exports=e},{events:7}],29:[function(a,b,c){var d=a("./device"),e=a("./sdkversion"),f=a("./appProps"),g=a("./logger"),h=null,i=null,j=function(){if(h)return h;var a={};a.cuid=d.getDeviceId(),a.cuidMap=d.getCuidMap(),a.destination=d.getDestination(),(window.device||navigator.device)&&(a.device=window.device||navigator.device),"undefined"!=typeof window.fh_app_version&&(a.app_version=fh_app_version),"undefined"!=typeof window.fh_project_version&&(a.project_version=fh_project_version),"undefined"!=typeof window.fh_project_app_version&&(a.project_app_version=fh_project_app_version),a.sdk_version=e(),i&&(a.sessionToken=i);var b=f.getAppProps();return b&&(a.appid=b.appid,a.appkey=b.appkey,a.projectid=b.projectid,a.analyticsTag=b.analyticsTag,a.connectiontag=b.connectiontag,b.init&&(a.init="string"==typeof b.init?JSON.parse(b.init):b.init)),h=a,g.debug("fhparams = ",h),a},k=function(a){var a=a||{};return a.__fh=j(),a},l=function(a){i=a};b.exports={buildFHParams:j,addFHParams:k,setAuthSessionToken:l}},{"./appProps":23,"./device":27,"./logger":35,"./sdkversion":38}],30:[function(a,b,c){var d=a("JSON");b.exports=function(a,b,c,e){var f,g=0;if(b)try{g=b.status;var h=d.parse(b.responseText);f=h.error||h.msg,f instanceof Array&&(f=f.join("\n"))}catch(i){f=b.responseText}a&&a(f,{status:g,message:c,error:e})}},{JSON:3}],31:[function(a,b,c){function d(a){var b=a;return"/"===b.charAt(b.length-1)&&(b=b.substring(0,b.length-1)),b}function e(a){var b=a;return b.length>1&&"/"===b.charAt(0)&&(b=b.substring(1,b.length)),b}function f(a){this.cloud_props=a,this.cloud_host=void 0,this.isLegacy=!1}var g=a("./constants"),h=a("./appProps");f.prototype.getHost=function(a){if(this.cloud_host)return this.cloud_host;var b,c;if(this.cloud_props&&this.cloud_props.hosts&&(b=this.cloud_props.hosts.url,"undefined"==typeof b)){var e=this.cloud_props.hosts.releaseCloudUrl;c=this.cloud_props.hosts.releaseCloudType,"undefined"!=typeof a&&a.indexOf("dev")>-1&&(e=this.cloud_props.hosts.debugCloudUrl,c=this.cloud_props.hosts.debugCloudType),b=e}return b=d(b),this.cloud_host=b,"fh"===c&&(this.isLegacy=!0),b},f.prototype.getActUrl=function(a){var b=h.getAppProps()||{};return"undefined"==typeof this.cloud_host&&this.getHost(b.mode),this.isLegacy?this.cloud_host+g.boxprefix+"act/"+this.cloud_props.domain+"/"+b.appid+"/"+a+"/"+b.appid:this.cloud_host+"/cloud/"+a},f.prototype.getMBAASUrl=function(a){var b=h.getAppProps()||{};return"undefined"==typeof this.cloud_host&&this.getHost(b.mode),this.cloud_host+"/mbaas/"+a},f.prototype.getCloudUrl=function(a){var b=h.getAppProps()||{};return"undefined"==typeof this.cloud_host&&this.getHost(b.mode),this.cloud_host+"/"+e(a)},b.exports=f},{"./appProps":23,"./constants":25}],32:[function(a,b,c){var d=(a("./loadScript"),a("../../libs/generated/lawnchair")),e=a("./lawnchair-ext"),f=a("./constants"),g=a("./fhparams"),h=a("./ajax"),i=a("./handleError"),j=a("./logger"),k=a("JSON"),l=a("./security/hash"),m=a("./appProps"),n=a("./constants"),o=a("./events"),p=function(a){m.load(function(b,c){return b?a(b):(o.emit(n.INTERNAL_CONFIG_LOADED_EVENT,null,c),q(c,a))})},q=function(a,b){if(a.loglevel&&j.setLevel(a.loglevel),a.local){var c={domain:"local",firstTime:!1,hosts:{debugCloudType:"node",debugCloudUrl:a.host,releaseCloudType:"node",releaseCloudUrl:a.host,type:"cloud_nodejs",url:a.host},init:{trackId:"000000000000000000000000"},status:"ok"};return b(null,{cloud:c})}e.addAdapter(a,l);var m={name:"fh_init_storage",adapter:["dom","webkit-sqlite","window-name"],fail:function(a,b){var c="read/save from/to local storage failed  msg:"+a+" err:"+b;return fail(c,{})}};"undefined"!=typeof Titanium&&(m.adapter=["titanium"]);var n=function(a,c,d,e){var f=g.buildFHParams();h({url:a,type:"POST",tryJSONP:"undefined"==typeof Titanium,dataType:"json",contentType:"application/json",data:k.stringify(f),timeout:c.timeout,success:function(a){e&&e.save({key:"fh_init",value:a},function(){}),b&&b(null,{cloud:a})},error:function(a,c,e){var f="unknown";a&&(f=a.status+" - "+a.responseText),j.error("App init returned error : "+f),d?(j.info("Using cached host: "+k.stringify(d)),b&&b(null,{cloud:d})):(j.error("No cached host found. Init failed."),i(function(a,c){b&&b({error:c,message:a})},a,c,e))}})},o=null,p=a.host+f.boxprefix+"app/init";try{o=new d(m,function(){}),o.get("fh_init",function(b){var c=null;b&&null!==b.value&&"undefined"!=typeof b.value&&""!==b&&(b="string"==typeof b?k.parse(b):b,b.value="string"==typeof b.value?k.parse(b.value):b.value,a.init=b.value.init?b.value.init:"string"==typeof b.value?k.parse(b.value):b.value,b.value.hosts&&(c=b.value)),n(p,a,c,o)})}catch(q){n(p,a,null,null)}};b.exports={init:p,loadCloudProps:q}},{"../../libs/generated/lawnchair":2,"./ajax":16,"./appProps":23,"./constants":25,"./events":28,"./fhparams":29,"./handleError":30,"./lawnchair-ext":33,"./loadScript":34,"./logger":35,"./security/hash":41,JSON:3}],33:[function(a,b,c){var d=a("../../libs/generated/lawnchair"),e=function(a,b){function c(a){console&&console.log(a)}function d(d,e){d=a.appid+d,b({algorithm:"MD5",text:d},function(a){var b=a.hashvalue+".txt";return"undefined"==typeof navigator.externalstorage?(c("filenameForKey key="+d+" , Filename: "+b),e(b)):void navigator.externalstorage.enable(function(a){var c=b;return a.path&&(c=a.path,c.match(/\/$/)||(c+="/"),c+=b),b=c,e(b)},function(a){return e(b)})})}var e=function(a,b){if(!console)throw a;console.log("error in file system adapter !",a,b)};return{valid:function(){return!!window.requestFileSystem},init:function(a,b){a&&"function"==typeof a.fail&&(e=a.fail),b&&this.fn(this.name,b).call(this,this)},keys:function(a){throw"Currently not supported"},save:function(a,b){var c=a.key,f=a.val||a.value;d(c,function(a){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(d){d.root.getFile(a,{create:!0},function(a){a.createWriter(function(a){a.onwrite=function(){return b({key:c,val:f})},a.write(f)},function(){e("[save] Failed to create file writer")})},function(){e("[save] Failed to getFile")})},function(){e("[save] Failed to requestFileSystem")})})},batch:function(a,b){throw"Currently not supported"},get:function(a,b){d(a,function(c){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(d){d.root.getFile(c,{},function(c){c.file(function(c){var d=new FileReader;d.onloadend=function(c){var d=c.target.result;try{d=decodeURIComponent(d)}catch(e){}return b({key:a,val:d})},d.readAsText(c)},function(){e("[load] Failed to getFile")})},function(){b({key:a,val:null})})},function(){e("[load] Failed to get fileSystem")})})},exists:function(a,b){d(a,function(a){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(c){c.root.getFile(a,{},function(a){return b(!0)},function(a){return b(!1)})})})},all:function(a){throw"Currently not supported"},remove:function(a,b){d(a,function(c){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(d){d.root.getFile(c,{},function(c){c.remove(function(){return b({key:a,val:null})},function(){e("[remove] Failed to remove file")})},function(){e("[remove] Failed to getFile")})},function(){e("[remove] Failed to get fileSystem")})})},nuke:function(a){throw"Currently not supported"}}},f=function(a,b){d.adapter("localFileStorage",e(a,b))};b.exports={addAdapter:f}},{"../../libs/generated/lawnchair":2}],34:[function(a,b,c){b.exports=function(a,b){var c,d=document.head||document.getElementsByTagName("head")[0]||document.documentElement;c=document.createElement("script"),c.async="async",c.src=a,c.type="text/javascript",c.onload=c.onreadystatechange=function(){(!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=void 0,b&&"function"==typeof b&&b())},d.insertBefore(c,d.firstChild)}},{}],35:[function(a,b,c){var d=(a("console"),a("loglevel"));d.setLevel("info"),b.exports=d},{console:6,loglevel:12}],36:[function(a,b,c){b.exports=[{destination:"ipad",test:["iPad"]},{destination:"iphone",test:["iPhone"]},{destination:"android",test:["Android"]},{destination:"blackberry",test:["BlackBerry","BB10","RIM Tablet OS"]},{destination:"windowsphone",test:["Windows Phone 8"]},{destination:"windowsphone7",test:["Windows Phone OS 7"]}]},{}],37:[function(a,b,c){b.exports=function(a){var b={},c=a.split("?");if(2===c.length){var d=c[1],e=d.split("&");b={};for(var f=0;f<e.length;f++){var g=e[f],h=g.split("=");b[h[0]]=h[1]}}return b}},{}],38:[function(a,b,c){var d=a("./constants");b.exports=function(){var a="FH_JS_SDK";return"undefined"!=typeof window.fh_destination_code?a="FH_HYBRID_SDK":(window.PhoneGap||window.cordova)&&(a="FH_PHONEGAP_SDK"),a+"/"+d.sdk_version}},{"./constants":25}],39:[function(a,b,c){var d=a("../../../libs/rsa"),e=d.SecureRandom,f=d.byte2Hex,g=function(a){var b=new e,c=new Array(a);b.nextBytes(c);for(var d="",g=0;g<c.length;g++)d+=f(c[g]);return d},h=function(a,b,c){if(!a.params.keysize)return void c("no_params_keysize",{},a);if("aes"!==a.params.algorithm.toLowerCase())return void c("keygen_bad_algorithm",{},a);

var d=parseInt(a.params.keysize,10);return d>100&&(d/=8),"undefined"==typeof e?c("security library is not loaded."):b({algorithm:"AES",secretkey:g(d),iv:g(d)})};b.exports=h},{"../../../libs/rsa":4}],40:[function(a,b,c){var d=a("../../../libs/generated/crypto"),e=function(a,b,c){var e=["key","plaintext","iv"];if("aes"!==a.params.algorithm.toLowerCase())return c("encrypt_bad_algorithm",{},a);for(var f=0;e>f;f++){var g=e[f];if(!a.params[g])return c("no_params_"+g,{},a)}var h=d.AES.encrypt(a.params.plaintext,d.enc.Hex.parse(a.params.key),{iv:d.enc.Hex.parse(a.params.iv)});return cipher_text=d.enc.Hex.stringify(h.ciphertext),b({ciphertext:cipher_text})},f=function(a,b,c){var e=["key","ciphertext","iv"];if("aes"!==a.params.algorithm.toLowerCase())return c("decrypt_bad_algorithm",{},a);for(var f=0;e>f;f++){var g=e[f];if(!a.params[g])return c("no_params_"+g,{},a)}var h=d.enc.Hex.parse(a.params.ciphertext),i=d.enc.Base64.stringify(h),j=d.AES.decrypt(i,d.enc.Hex.parse(a.params.key),{iv:d.enc.Hex.parse(a.params.iv)});return plain_text=j.toString(d.enc.Utf8),b({plaintext:plain_text})};b.exports={encrypt:e,decrypt:f}},{"../../../libs/generated/crypto":1}],41:[function(a,b,c){var d=a("../../../libs/generated/crypto"),e=function(a,b,c){if(!a.params.text)return void c("hash_no_text",{},a);var e;if("md5"===a.params.algorithm.toLowerCase())e=d.MD5(a.params.text).toString(d.enc.Hex);else if("sha1"===a.params.algorithm.toLowerCase())e=d.SHA1(a.params.text).toString(d.enc.Hex);else if("sha256"===a.params.algorithm.toLowerCase())e=d.SHA256(a.params.text).toString(d.enc.Hex);else{if("sha512"!==a.params.algorithm.toLowerCase())return c("hash_unsupported_algorithm: "+a.params.algorithm);e=d.SHA512(a.params.text).toString(d.enc.Hex)}return b({hashvalue:e})};b.exports=e},{"../../../libs/generated/crypto":1}],42:[function(a,b,c){var d=a("../../../libs/rsa"),e=d.RSAKey,f=function(a,b,c){var d=["modulu","plaintext"];if("rsa"!==a.params.algorithm.toLowerCase())return c("encrypt_bad_algorithm",{},a);for(var f=0;d>f;f++){var g=d[f];if(!a.params[g])return c("no_params_"+g,{},a)}var h=new e;h.setPublic(a.params.modulu,"10001");var i=a.params.plaintext;return cipher_text=h.encrypt(i),b({ciphertext:cipher_text})};b.exports={encrypt:f}},{"../../../libs/rsa":4}],43:[function(a,b,c){var d=a("JSON"),e=a("./api_act"),f=a("./api_cloud"),g=a("../../libs/generated/crypto"),h=a("../../libs/generated/lawnchair"),i={defaults:{sync_frequency:10,auto_sync_local_updates:!0,notify_client_storage_failed:!0,notify_sync_started:!0,notify_sync_complete:!0,notify_offline_update:!0,notify_collision_detected:!0,notify_remote_update_failed:!0,notify_local_update_applied:!0,notify_remote_update_applied:!0,notify_delta_received:!0,notify_record_delta_received:!0,notify_sync_failed:!0,do_console_log:!1,crashed_count_wait:10,resend_crashed_updates:!0,sync_active:!0,storage_strategy:"html5-filesystem",file_system_quota:61644800,has_custom_sync:null,icloud_backup:!1},notifications:{CLIENT_STORAGE_FAILED:"client_storage_failed",SYNC_STARTED:"sync_started",SYNC_COMPLETE:"sync_complete",OFFLINE_UPDATE:"offline_update",COLLISION_DETECTED:"collision_detected",REMOTE_UPDATE_FAILED:"remote_update_failed",REMOTE_UPDATE_APPLIED:"remote_update_applied",LOCAL_UPDATE_APPLIED:"local_update_applied",DELTA_RECEIVED:"delta_received",RECORD_DELTA_RECEIVED:"record_delta_received",SYNC_FAILED:"sync_failed"},datasets:{},config:void 0,notify_callback:void 0,notify_callback_map:{},init_is_called:!1,init:function(a){i.consoleLog("sync - init called"),i.config=d.parse(d.stringify(i.defaults));for(var b in a)i.config[b]=a[b];i.init_is_called||(i.init_is_called=!0,i.datasetMonitor())},notify:function(a,b){1===arguments.length&&"function"==typeof a?i.notify_callback=a:i.notify_callback_map[a]=b},manage:function(a,b,c,e,f){i.consoleLog("manage - START");var b=b||{},g=function(g){i.consoleLog("doManage dataset :: initialised = "+g.initialised+" :: "+a+" :: "+d.stringify(b));var h=i.setOptions(b);g.query_params=c||g.query_params||{},g.meta_data=e||g.meta_data||{},g.config=h,g.syncRunning=!1,g.syncPending=!0,g.initialised=!0,"undefined"==typeof g.meta&&(g.meta={}),i.saveDataSet(a,function(){f&&f()})};i.getDataSet(a,function(a){i.consoleLog("manage - dataset already loaded"),g(a)},function(b){i.consoleLog("manage - dataset not loaded... trying to load"),i.loadDataSet(a,function(b){i.consoleLog("manage - dataset loaded from local storage"),i.doNotify(a,null,i.notifications.LOCAL_UPDATE_APPLIED,"load"),g(b)},function(b){i.consoleLog("manage - Creating new dataset for id "+a);var c={};c.data={},c.pending={},c.meta={},i.datasets[a]=c,g(c)})})},setOptions:function(a){i.config||(i.config=d.parse(d.stringify(i.defaults)));var b=d.parse(d.stringify(i.config)),c=d.parse(d.stringify(a));for(var e in c)b[e]=c[e];return b},list:function(a,b,c){i.getDataSet(a,function(a){if(a&&a.data){var e=d.parse(d.stringify(a.data));b(e)}else c&&c("no_data")},function(a,b){c&&c(a,b)})},create:function(a,b,c,d){return null==b&&d?d("null_data"):void i.addPendingObj(a,null,b,"create",c,d)},read:function(a,b,c,e){i.getDataSet(a,function(a){var f=a.data[b];if(f){var g=d.parse(d.stringify(f));c(g)}else e("unknown_uid")},function(a,b){e&&e(a,b)})},update:function(a,b,c,d,e){i.addPendingObj(a,b,c,"update",d,e)},"delete":function(a,b,c,d){i.addPendingObj(a,b,null,"delete",c,d)},getPending:function(a,b){i.getDataSet(a,function(a){var c;a&&(c=a.pending),b(c)},function(a,b){i.consoleLog(a)})},clearPending:function(a,b){i.getDataSet(a,function(c){c.pending={},i.saveDataSet(a,b)})},listCollisions:function(a,b,c){i.getDataSet(a,function(d){i.doCloudCall({dataset_id:a,req:{fn:"listCollisions",meta_data:d.meta_data}},b,c)},c)},removeCollision:function(a,b,c,d){i.getDataSet(a,function(e){i.doCloudCall({dataset_id:a,req:{fn:"removeCollision",hash:b,meta_data:e.meta_data}},c,d)})},isOnline:function(a){var b=!0;if("undefined"!=typeof navigator.onLine&&(b=navigator.onLine),b&&"undefined"!=typeof navigator.network&&"undefined"!=typeof navigator.network.connection){var c=navigator.network.connection.type;("none"===c||null===c)&&(b=!1)}return a(b)},doNotify:function(a,b,c,d){if(i.notify_callback||i.notify_callback_map[a]){var e=i.notify_callback_map[a]||i.notify_callback;if(i.config["notify_"+c]){var f={dataset_id:a,uid:b,code:c,message:d};setTimeout(function(){e(f)},0)}}},getDataSet:function(a,b,c){var d=i.datasets[a];d?b(d):c&&c("unknown_dataset "+a,a)},getQueryParams:function(a,b,c){var d=i.datasets[a];d?b(d.query_params):c&&c("unknown_dataset "+a,a)},setQueryParams:function(a,b,c,d){var e=i.datasets[a];e?(e.query_params=b,i.saveDataSet(a),c&&c(e.query_params)):d&&d("unknown_dataset "+a,a)},getMetaData:function(a,b,c){var d=i.datasets[a];d?b(d.meta_data):c&&c("unknown_dataset "+a,a)},setMetaData:function(a,b,c,d){var e=i.datasets[a];e?(e.meta_data=b,i.saveDataSet(a),c&&c(e.meta_data)):d&&d("unknown_dataset "+a,a)},getConfig:function(a,b,c){var d=i.datasets[a];d?b(d.config):c&&c("unknown_dataset "+a,a)},setConfig:function(a,b,c,d){var e=i.datasets[a];if(e){var f=i.setOptions(b);e.config=f,i.saveDataSet(a),c&&c(e.config)}else d&&d("unknown_dataset "+a,a)},stopSync:function(a,b,c){i.setConfig(a,{sync_active:!1},function(){b&&b()},c)},startSync:function(a,b,c){i.setConfig(a,{sync_active:!0},function(){b&&b()},c)},doSync:function(a,b,c){var d=i.datasets[a];d?(d.syncPending=!0,i.saveDataSet(a),b&&b()):c&&c("unknown_dataset "+a,a)},forceSync:function(a,b,c){var d=i.datasets[a];d?(d.syncForced=!0,i.saveDataSet(a),b&&b()):c&&c("unknown_dataset "+a,a)},sortObject:function(a){if("object"!=typeof a||null===a)return a;var b=[];return Object.keys(a).sort().forEach(function(c){b.push({key:c,value:i.sortObject(a[c])})}),b},sortedStringify:function(a){var b="";try{b=d.stringify(i.sortObject(a))}catch(c){console.error("Error stringifying sorted object:"+c)}return b},generateHash:function(a){var b=g.SHA1(i.sortedStringify(a));return b.toString()},addPendingObj:function(a,b,c,e,f,g){function h(c){c.hash=i.generateHash(c),i.getDataSet(a,function(d){d.pending[c.hash]=c,i.updateDatasetFromLocal(d,c),i.config.auto_sync_local_updates&&(d.syncPending=!0),i.saveDataSet(a),i.doNotify(a,b,i.notifications.LOCAL_UPDATE_APPLIED,e),f(c)},function(a,b){g&&g(a,b)})}i.isOnline(function(c){c||i.doNotify(a,b,i.notifications.OFFLINE_UPDATE,e)});var j={};j.inFlight=!1,j.action=e,j.post=d.parse(d.stringify(c)),j.postHash=i.generateHash(j.post),j.timestamp=(new Date).getTime(),"create"===e?(j.uid=j.postHash,h(j)):i.read(a,b,function(a){j.uid=b,j.pre=a.data,j.preHash=i.generateHash(a.data),h(j)},function(a,b){g&&g(a,b)})},syncLoop:function(a){i.getDataSet(a,function(b){b.syncPending=!1,b.syncRunning=!0,b.syncLoopStart=(new Date).getTime(),i.doNotify(a,null,i.notifications.SYNC_STARTED,null),i.isOnline(function(c){c?i.checkHasCustomSync(a,function(){var c={};c.fn="sync",c.dataset_id=a,c.query_params=b.query_params,c.config=b.config,c.meta_data=b.meta_data,c.dataset_hash=b.hash,c.acknowledgements=b.acknowledgements||[];var e=b.pending,f=[];for(var g in e)e[g].inFlight||e[g].crashed||e[g].delayed||(e[g].inFlight=!0,e[g].inFlightDate=(new Date).getTime(),f.push(e[g]));c.pending=f,f.length>0&&i.consoleLog("Starting sync loop - global hash = "+b.hash+" :: params = "+d.stringify(c,null,2));try{i.doCloudCall({dataset_id:a,req:c},function(c){function d(c,d,f){if(c)for(var g in c)e=c[g],f.push(e),b.pending[g]&&b.pending[g].inFlight&&!b.pending[g].crashed&&(delete b.pending[g],i.doNotify(a,e.uid,d,e))}var e;if(i.updatePendingFromNewData(a,b,c),i.updateCrashedInFlightFromNewData(a,b,c),i.updateDelayedFromNewData(a,b,c),i.updateMetaFromNewData(a,b,c),i.updateNewDataFromInFlight(a,b,c),i.updateNewDataFromPending(a,b,c),c.records&&(b.data=c.records,b.hash=c.hash,i.doNotify(a,c.hash,i.notifications.DELTA_RECEIVED,"full dataset")),c.updates){var f=[];d(c.updates.applied,i.notifications.REMOTE_UPDATE_APPLIED,f),d(c.updates.failed,i.notifications.REMOTE_UPDATE_FAILED,f),d(c.updates.collisions,i.notifications.COLLISION_DETECTED,f),b.acknowledgements=f}!c.records&&c.hash&&c.hash!==b.hash?(i.consoleLog("Local dataset stale - syncing records :: local hash= "+b.hash+" - remoteHash="+c.hash),i.syncRecords(a)):(i.consoleLog("Local dataset up to date"),i.syncComplete(a,"online",i.notifications.SYNC_COMPLETE))},function(c,d){i.markInFlightAsCrashed(b),i.consoleLog("syncLoop failed : msg="+c+" :: err = "+d),i.syncComplete(a,c,i.notifications.SYNC_FAILED)})}catch(h){i.consoleLog("Error performing sync - "+h),i.syncComplete(a,h,i.notifications.SYNC_FAILED)}}):i.syncComplete(a,"offline",i.notifications.SYNC_FAILED)})})},syncRecords:function(a){i.getDataSet(a,function(b){var c=b.data||{},e={};for(var f in c){var g=f,h=c[f].hash;e[g]=h}var j={};j.fn="syncRecords",j.dataset_id=a,j.query_params=b.query_params,j.clientRecs=e,i.consoleLog("syncRecParams :: "+d.stringify(j)),i.doCloudCall({dataset_id:a,req:j},function(d){var e;if(d.create)for(e in d.create)c[e]={hash:d.create[e].hash,data:d.create[e].data},i.doNotify(a,e,i.notifications.RECORD_DELTA_RECEIVED,"create");if(d.update)for(e in d.update)c[e].hash=d.update[e].hash,c[e].data=d.update[e].data,i.doNotify(a,e,i.notifications.RECORD_DELTA_RECEIVED,"update");if(d["delete"])for(e in d["delete"])delete c[e],i.doNotify(a,e,i.notifications.RECORD_DELTA_RECEIVED,"delete");i.doNotify(a,d.hash,i.notifications.DELTA_RECEIVED,"partial dataset"),b.data=c,d.hash&&(b.hash=d.hash),i.syncComplete(a,"online",i.notifications.SYNC_COMPLETE)},function(b,c){i.consoleLog("syncRecords failed : msg="+b+" :: err="+c),i.syncComplete(a,b,i.notifications.SYNC_FAILED)})})},syncComplete:function(a,b,c){i.getDataSet(a,function(d){d.syncRunning=!1,d.syncLoopEnd=(new Date).getTime(),i.saveDataSet(a),i.doNotify(a,d.hash,c,b)})},checkDatasets:function(){for(var a in i.datasets)if(i.datasets.hasOwnProperty(a)){var b=i.datasets[a];if(b&&!b.syncRunning&&(b.config.sync_active||b.syncForced)){var c=b.syncLoopStart,d=b.syncLoopEnd;if(b.syncForced)b.syncPending=!0;else if(null==c)i.consoleLog(a+" - Performing initial sync"),b.syncPending=!0;else if(null!=d){var e=(new Date).getTime()-d,f=1e3*b.config.sync_frequency;e>f&&(b.syncPending=!0)}b.syncPending&&(b.syncForced=!1,i.syncLoop(a))}}},checkHasCustomSync:function(a,b){var c=i.datasets[a];return c&&c.config?(i.consoleLog("dataset.config.has_custom_sync = "+c.config.has_custom_sync),null!=c.config.has_custom_sync?b():(i.consoleLog("starting check has custom sync"),void e({act:a,req:{fn:"sync"}},function(a){return i.consoleLog("check has_custom_sync - success - ",a),c.config.has_custom_sync=!0,b()},function(a,d){return i.consoleLog("check has_custom_sync - failure - ",d),d.status&&500===d.status?(i.consoleLog("check has_custom_sync - failed with 500, endpoint does exists"),c.config.has_custom_sync=!0):c.config.has_custom_sync=!1,b()}))):b()},doCloudCall:function(a,b,c){var d=!1,g=i.datasets[a.dataset_id];g&&g.config&&(d=g.config.has_custom_sync),1==d?e({act:a.dataset_id,req:a.req},function(a){b(a)},function(a,b){c(a,b)}):f({path:"/mbaas/sync/"+a.dataset_id,method:"post",data:a.req},function(a){b(a)},function(a,b){c(a,b)})},datasetMonitor:function(){i.checkDatasets(),setTimeout(function(){i.datasetMonitor()},500)},getStorageAdapter:function(a,b,c){var d=function(c,d){var e=(b?"save to":"load from")+" local storage failed msg: "+c+" err: "+d;i.doNotify(a,null,i.notifications.CLIENT_STORAGE_FAILED,e),i.consoleLog(e)};h({fail:d,adapter:i.config.storage_strategy,size:i.config.file_system_quota,backup:i.config.icloud_backup},function(){return c(null,this)})},saveDataSet:function(a,b){i.getDataSet(a,function(c){i.getStorageAdapter(a,!0,function(d,e){e.save({key:"dataset_"+a,val:c},function(){return b?b():void 0})})})},loadDataSet:function(a,b,c){i.getStorageAdapter(a,!1,function(e,f){f.get("dataset_"+a,function(e){if(e&&e.val){var f=e.val;if("string"==typeof f&&(f=d.parse(f)),f.initialised=!1,i.datasets[a]=f,i.consoleLog("load from local storage success for dataset_id :"+a),b)return b(f)}else if(c)return c()})})},clearCache:function(a,b){delete i.datasets[a],null===i.notify_callback_map[a],i.getStorageAdapter(a,!0,function(c,d){d.remove("dataset_"+a,function(){return i.consoleLog("local cache is cleared for dataset : "+a),b?b():void 0})})},updateDatasetFromLocal:function(a,b){var c,e,f=a.pending,g=b.uid;i.consoleLog("updating local dataset for uid "+g+" - action = "+b.action),a.meta[g]=a.meta[g]||{},"create"===b.action&&(a.data[g]&&(i.consoleLog("dataset already exists for uid in create :: "+d.stringify(a.data[g])),a.meta[g].fromPending&&(c=a.meta[g].pendingUid,delete f[c])),a.data[g]={}),"update"===b.action&&a.data[g]&&a.meta[g].fromPending&&(i.consoleLog("updating an existing pending record for dataset :: "+d.stringify(a.data[g])),c=a.meta[g].pendingUid,a.meta[g].previousPendingUid=c,e=f[c],e&&(e.inFlight?(i.consoleLog("existing in-inflight pending record = "+d.stringify(e)),b.delayed=!0,b.waiting=e.hash):(i.consoleLog("existing pre-flight pending record = "+d.stringify(e)),e.post=b.post,e.postHash=b.postHash,delete f[b.hash],b.hash=c))),"delete"===b.action&&a.data[g]&&(a.meta[g].fromPending&&(i.consoleLog("Deleting an existing pending record for dataset :: "+d.stringify(a.data[g])),c=a.meta[g].pendingUid,a.meta[g].previousPendingUid=c,e=f[c],e&&(e.inFlight?(i.consoleLog("existing in-inflight pending record = "+d.stringify(e)),b.delayed=!0,b.waiting=e.hash):(i.consoleLog("existing pending record = "+d.stringify(e)),"create"===e.action&&(delete f[b.hash],delete f[c]),"update"===e.action&&(b.pre=e.pre,b.preHash=e.preHash,b.inFlight=!1,delete f[c])))),delete a.data[g]),a.data[g]&&(a.data[g].data=b.post,a.data[g].hash=b.postHash,a.meta[g].fromPending=!0,a.meta[g].pendingUid=b.hash)},updatePendingFromNewData:function(a,b,c){var e,f=b.pending;if(f&&c.records)for(var g in f)if(f.hasOwnProperty(g)){var h=f[g];if(b.meta[h.uid]=b.meta[h.uid]||{},h.inFlight===!1){if(i.consoleLog("updatePendingFromNewData - Found Non inFlight record -> action="+h.action+" :: uid="+h.uid+" :: hash="+h.hash),"update"===h.action||"delete"===h.action)if(e=c.records[h.uid])i.consoleLog("updatePendingFromNewData - Updating pre values for existing pending record "+h.uid),h.pre=e.data,h.preHash=e.hash;else{var j=b.meta[h.uid].previousPendingUid,k=f[j];if(k&&c&&c.updates&&c.updates.applied&&c.updates.applied[k.hash]){var l=c.updates.applied[k.hash].uid;e=c.records[l],e&&(i.consoleLog("updatePendingFromNewData - Updating pre values for existing pending record which was previously a create "+h.uid+" ==> "+l),h.pre=e.data,h.preHash=e.hash,h.uid=l)}}"create"===h.action&&c&&c.updates&&c.updates.applied&&c.updates.applied[g]&&(i.consoleLog("updatePendingFromNewData - Found an update for a pending create "+d.stringify(c.updates.applied[g])),e=c.records[c.updates.applied[g].uid],e&&(i.consoleLog("updatePendingFromNewData - Changing pending create to an update based on new record  "+d.stringify(e)),h.action="update",h.pre=e.data,h.preHash=e.hash,h.uid=c.updates.applied[g].uid))}}},updateNewDataFromInFlight:function(a,b,c){var d=b.pending;if(d&&c.records)for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];if(f.inFlight){var g=c&&c.updates&&c.updates.hashes&&c.updates.hashes[e]?!0:!1;if(i.consoleLog("updateNewDataFromInFlight - Found inflight pending Record - action = "+f.action+" :: hash = "+e+" :: updateReceivedForPending="+g),!g){var h=c.records[f.uid];if("update"===f.action&&h)h.data=f.post,h.hash=f.postHash;else if("delete"===f.action&&h)delete c.records[f.uid];else if("create"===f.action){i.consoleLog("updateNewDataFromInFlight - re adding pending create to incomming dataset");var j={data:f.post,hash:f.postHash};c.records[f.uid]=j}}}}},updateNewDataFromPending:function(a,b,c){var d=b.pending;if(d&&c.records)for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];if(f.inFlight===!1){i.consoleLog("updateNewDataFromPending - Found Non inFlight record -> action="+f.action+" :: uid="+f.uid+" :: hash="+f.hash);var g=c.records[f.uid];if("update"===f.action&&g)g.data=f.post,g.hash=f.postHash;else if("delete"===f.action&&g)delete c.records[f.uid];else if("create"===f.action){i.consoleLog("updateNewDataFromPending - re adding pending create to incomming dataset");var h={data:f.post,hash:f.postHash};c.records[f.uid]=h}}}},updateCrashedInFlightFromNewData:function(a,b,c){var e,f,g={applied:i.notifications.REMOTE_UPDATE_APPLIED,failed:i.notifications.REMOTE_UPDATE_FAILED,collisions:i.notifications.COLLISION_DETECTED},h=b.pending,j={};if(h){for(e in h)if(h.hasOwnProperty(e)&&(f=h[e],f.inFlight&&f.crashed))if(i.consoleLog("updateCrashedInFlightFromNewData - Found crashed inFlight pending record uid="+f.uid+" :: hash="+f.hash),c&&c.updates&&c.updates.hashes){var k=c.updates.hashes[e];k?(j[k.uid]=k,i.consoleLog("updateCrashedInFlightFromNewData - Resolving status for crashed inflight pending record "+d.stringify(k)),"failed"===k.type&&("create"===k.action?(i.consoleLog("updateCrashedInFlightFromNewData - Deleting failed create from dataset"),delete b.data[k.uid]):("update"===k.action||"delete"===k.action)&&(i.consoleLog("updateCrashedInFlightFromNewData - Reverting failed "+k.action+" in dataset"),b.data[k.uid]={data:f.pre,hash:f.preHash})),delete h[e],i.doNotify(a,k.uid,g[k.type],k)):f.crashedCount?f.crashedCount++:f.crashedCount=1}else f.crashedCount?f.crashedCount++:f.crashedCount=1;for(e in h)h.hasOwnProperty(e)&&(f=h[e],f.inFlight&&f.crashed&&f.crashedCount>b.config.crashed_count_wait&&(i.consoleLog("updateCrashedInFlightFromNewData - Crashed inflight pending record has reached crashed_count_wait limit : "+d.stringify(f)),b.config.resend_crashed_updates?(i.consoleLog("updateCrashedInFlightFromNewData - Retryig crashed inflight pending record"),f.crashed=!1,f.inFlight=!1):(i.consoleLog("updateCrashedInFlightFromNewData - Deleting crashed inflight pending record"),delete h[e])))}},updateDelayedFromNewData:function(a,b,c){var e,f,g=b.pending;if(g)for(e in g)if(g.hasOwnProperty(e)&&(f=g[e],f.delayed&&f.waiting&&(i.consoleLog("updateDelayedFromNewData - Found delayed pending record uid="+f.uid+" :: hash="+f.hash+" :: waiting="+f.waiting),c&&c.updates&&c.updates.hashes))){var h=c.updates.hashes[f.waiting];h&&(i.consoleLog("updateDelayedFromNewData - Waiting pending record is resolved rec="+d.stringify(h)),f.delayed=!1,f.waiting=void 0)}},updateMetaFromNewData:function(a,b,c){var e=b.meta;if(e&&c&&c.updates&&c.updates.hashes)for(var f in e)if(e.hasOwnProperty(f)){var g=e[f],h=g.pendingUid,j=g.previousPendingUid;i.consoleLog("updateMetaFromNewData - Found metadata with uid = "+f+" :: pendingHash = "+h+" :: previousPendingHash ="+j);var k=!0,l=!0;if(j){k=!1;var m=c.updates.hashes[j];m&&(i.consoleLog("updateMetaFromNewData - Found previousPendingUid in meta data resolved - resolved = "+d.stringify(m)),g.previousPendingUid=void 0,k=!0)}if(h){l=!1;var m=c.updates.hashes[h];m&&(i.consoleLog("updateMetaFromNewData - Found pendingUid in meta data resolved - resolved = "+d.stringify(m)),g.pendingUid=void 0,l=!0)}k&&l&&(i.consoleLog("updateMetaFromNewData - both previous and current pendings are resolved for meta data with uid "+f+". Delete it."),delete e[f])}},markInFlightAsCrashed:function(a){var b,c,d=a.pending;if(d){var e={};for(b in d)d.hasOwnProperty(b)&&(c=d[b],c.inFlight&&(i.consoleLog("Marking in flight pending record as crashed : "+b),c.crashed=!0,e[c.uid]=c))}},consoleLog:function(a){i.config.do_console_log&&console.log(a)}};!function(){i.config=i.defaults}(),b.exports={init:i.init,manage:i.manage,notify:i.notify,doList:i.list,doCreate:i.create,doRead:i.read,doUpdate:i.update,doDelete:i["delete"],listCollisions:i.listCollisions,removeCollision:i.removeCollision,getPending:i.getPending,clearPending:i.clearPending,getDataset:i.getDataSet,getQueryParams:i.getQueryParams,setQueryParams:i.setQueryParams,getMetaData:i.getMetaData,setMetaData:i.setMetaData,getConfig:i.getConfig,setConfig:i.setConfig,startSync:i.startSync,stopSync:i.stopSync,doSync:i.doSync,forceSync:i.forceSync,generateHash:i.generateHash,loadDataSet:i.loadDataSet,checkHasCustomSync:i.checkHasCustomSync,clearCache:i.clearCache}},{"../../libs/generated/crypto":1,"../../libs/generated/lawnchair":2,"./api_act":17,"./api_cloud":19,JSON:3}],44:[function(a,b,c){b.exports={createUUID:function(){for(var a=[],b="0123456789ABCDEF",c=0;32>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);a[12]="4",a[16]=b.substr(3&a[16]|8,1);var d=a.join("");return d}}},{}],45:[function(a,b,c){var d,e=a("./initializer"),f=a("./events"),g=a("./hosts"),h=a("./constants"),i=a("./logger"),j=!1,k=!1,l=null,m=function(a){if(k)return a(null,{host:o()});if(f.once(h.INIT_EVENT,function(b,c){return a(b,c)}),!j){j=!0;var b=function(){e.init(function(a,b){return j=!1,a?(l=a,f.emit(h.INIT_EVENT,a)):(l=null,k=!0,d=new g(b.cloud),f.emit(h.INIT_EVENT,null,{host:o()}))})};"undefined"!=typeof window.cordova||"undefined"!=typeof window.phonegap?document.addEventListener("deviceready",b,!1):b()}},n=function(){return d},o=function(){if("undefined"!=typeof d){var b=a("./appProps").getAppProps();return d.getHost(b.mode)}return void 0},p=function(){return k},q=function(){return l},r=function(){k=!1,j=!1,d=void 0,l=void 0,m(function(){})};m(function(a,b){a?"app_config_missing"!==a.message?i.error("Failed to initialise fh."):i.info("No fh config file"):i.info("fh cloud is ready")}),b.exports={ready:m,isReady:p,getCloudHost:n,getCloudHostUrl:o,getInitError:q,reset:r}},{"./appProps":23,"./constants":25,"./events":28,"./hosts":31,"./initializer":32,"./logger":35}]},{},[14])(14)}),function(root){if(!JSON)var JSON=function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapeable.test(a)?'"'+a.replace(escapeable,function(a){var b=meta[a];return"string"==typeof b?b:(b=a.charCodeAt(),"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16))})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"number"==typeof i.length&&!i.propertyIsEnumerable("length")){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if("object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)d=rep[c],"string"==typeof d&&(e=str(d,i,rep),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)e=str(d,i,rep),e&&g.push(quote(d)+(gap?": ":":")+e);return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"};var escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;return{stringify:function(a,b,c){var d;if(gap="",indent="",c)if("number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(b){if("function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");rep=b}else rep=function(a,b){return Object.hasOwnProperty.call(this,a)?b:void 0};return str("",{"":a})},parse:function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(/^[\],:{}\s]*$/.test(text.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")},quote:quote}}();if(function(){if(!window.google||!google.gears){var a=null;if("undefined"!=typeof GearsFactory)a=new GearsFactory;else try{a=new ActiveXObject("Gears.Factory"),-1!=a.getBuildInfo().indexOf("ie_mobile")&&a.privateSetGlobalObject(this)}catch(b){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"]&&(a=document.createElement("object"),a.style.display="none",a.width=0,a.height=0,a.type="application/x-googlegears",document.documentElement.appendChild(a))}a&&(window.google||(google={}),google.gears||(google.gears={factory:a}))}}(),Persist=function(){var a,b,c,d,e,f,g="0.2.0";f=function(){var a,b="Thu, 01-Jan-1970 00:00:01 GMT",c=864e5,d=["expires","path","domain"],e=escape,f=unescape,g=document,h=function(){var a=new Date;return a.setTime(a.getTime()),a},j=function(a,b){var c,f,g,h=[],i=arguments.length>2?arguments[2]:{};for(h.push(e(a)+"="+e(b)),c=0;c<d.length;c++)f=d[c],(g=i[f])&&h.push(f+"="+g);return i.secure&&h.push("secure"),h.join("; ")},k=function(){var a="__EC_TEST__",b=new Date;return b=b.toGMTString(),this.set(a,b),this.enabled=this.remove(a)==b,this.enabled};return a={set:function(a,b){var d=arguments.length>2?arguments[2]:{},e=h(),f={};d.expires&&(d.expires*=c,f.expires=new Date(e.getTime()+d.expires),f.expires=f.expires.toGMTString());var k=["path","domain","secure"];for(i=0;i<k.length;i++)d[k[i]]&&(f[k[i]]=d[k[i]]);var l=j(a,b,f);return g.cookie=l,b},has:function(a){a=e(a);var b=g.cookie,c=b.indexOf(a+"="),d=(c+a.length+1,b.substring(0,a.length));return!c&&a!=d||0>c?!1:!0},get:function(a){a=e(a);var b,c=g.cookie,d=c.indexOf(a+"="),h=d+a.length+1,i=c.substring(0,a.length);return!d&&a!=i||0>d?null:(b=c.indexOf(";",h),0>b&&(b=c.length),f(c.substring(h,b)))},remove:function(c){var d=a.get(c),e={expires:b};return g.cookie=j(c,"",e),d},keys:function(){var a,b,c=g.cookie,d=c.split("; "),e=[];for(a=0;a<d.length;a++)b=d[a].split("="),e.push(f(b[0]));return e},all:function(){var a,b,c=g.cookie,d=c.split("; "),e=[];for(a=0;a<d.length;a++)b=d[a].split("="),e.push([f(b[0]),f(b[1])]);return e},version:"0.2.1",enabled:!1},a.enabled=k.call(a),a}();var h=function(){return Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b)}:function(a,b){var c,d;for(c=0,d=a.length;d>c;c++)if(a[c]==b)return c;return-1}}();e=function(){},c=function(a){return"PS"+a.replace(/_/g,"__").replace(/ /g,"_s")},C={search_order:["localstorage","whatwg_db","globalstorage","gears","ie","flash","cookie"],name_re:/^[a-z][a-z0-9_ -]+$/i,methods:["init","get","set","remove","load","save"],sql:{version:"1",create:"CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",get:"SELECT v FROM persist_data WHERE k = ?",set:"INSERT INTO persist_data(k, v) VALUES (?, ?)",remove:"DELETE FROM persist_data WHERE k = ?"},flash:{div_id:"_persist_flash_wrap",id:"_persist_flash",path:"persist.swf",size:{w:1,h:1},args:{autostart:!0}}},b={gears:{size:-1,test:function(){try{return window.google&&window.google.gears?!0:!1}catch(a){return!1}},methods:{transaction:function(a){var b=this.db;b.execute("BEGIN").close(),a.call(this,b),b.execute("COMMIT").close()},init:function(){var a;a=this.db=google.gears.factory.create("beta.database"),a.open(c(this.name)),a.execute(C.sql.create).close()},get:function(a,b,c){var d,e=C.sql.get;b&&this.transaction(function(f){var g,h;d=f.execute(e,[a]),g=d.isValidRow(),h=g?d.field(0):null,d.close(),b.call(c||this,g,h)})},set:function(a,b,c,d){var e=C.sql.remove,f=C.sql.set;this.transaction(function(g){g.execute(e,[a]).close(),g.execute(f,[a,b]).close(),c&&c.call(d||this,!0,b)})},remove:function(a,b,c){var d=C.sql.get;sql=C.sql.remove,r,val=null,is_valid=!1,this.transaction(function(e){b&&(r=e.execute(d,[a]),is_valid=r.isValidRow(),val=is_valid?r.field(0):null,r.close()),(!b||is_valid)&&e.execute(sql,[a]).close(),b&&b.call(c||this,is_valid,val)})}}},whatwg_db:{size:204800,test:function(){try{var a="PersistJS Test",c="Persistent database test.";return window.openDatabase&&window.openDatabase(a,C.sql.version,c,b.whatwg_db.size)?!0:!1}catch(d){return!1}},methods:{transaction:function(a){this.db_created||this.db.transaction(function(a){a.executeSql(C.sql.create,[],function(){this.db_created=!0})},e),this.db.transaction(a)},init:function(){this.db=openDatabase(this.name,C.sql.version,this.o.about||"Persistent storage for "+this.name,this.o.size||b.whatwg_db.size)},get:function(a,b,c){var d=C.sql.get;b&&(c=c||this,this.transaction(function(e){e.executeSql(d,[a],function(a,d){d.rows.length>0?b.call(c,!0,d.rows.item(0).v):b.call(c,!1,null)})}))},set:function(a,b,c,d){var e=C.sql.remove,f=C.sql.set;return this.transaction(function(g){g.executeSql(e,[a],function(){g.executeSql(f,[a,b],function(a,e){c&&c.call(d||this,!0,b)})})}),b},remove:function(a,b,c){var d=C.sql.get;sql=C.sql.remove,this.transaction(function(e){b?e.executeSql(d,[a],function(d,e){if(e.rows.length>0){var f=e.rows.item(0).v;d.executeSql(sql,[a],function(a,d){b.call(c||this,!0,f)})}else b.call(c||this,!1,null)}):e.executeSql(sql,[a])})}}},globalstorage:{size:5242880,test:function(){try{return window.globalStorage?!0:!1}catch(a){return!1}},methods:{key:function(a){return c(this.name)+c(a)},init:function(){alert("domain = "+this.o.domain),this.store=globalStorage[this.o.domain]},get:function(a,b,c){a=this.key(a),b&&b.call(c||this,!0,this.store.getItem(a))},set:function(a,b,c,d){a=this.key(a),this.store.setItem(a,b),c&&c.call(d||this,!0,b)},remove:function(a,b,c){var d;a=this.key(a),d=this.store[a],this.store.removeItem(a),b&&b.call(c||this,null!==d,d)}}},localstorage:{size:-1,test:function(){try{return window.localStorage?!0:!1}catch(a){return!1}},methods:{key:function(a){return c(this.name)+c(a)},init:function(){this.store=localStorage},get:function(a,b,c){a=this.key(a),b&&b.call(c||this,!0,this.store.getItem(a))},set:function(a,b,c,d){a=this.key(a),this.store.setItem(a,b),c&&c.call(d||this,!0,b)},remove:function(a,b,c){var d;a=this.key(a),d=this.store.getItem(a),this.store.removeItem(a),b&&b.call(c||this,null!==d,d)}}},ie:{prefix:"_persist_data-",size:65536,test:function(){try{return window.ActiveXObject?!0:!1;

}catch(a){return!1}},make_userdata:function(a){var b=document.createElement("div");return b.id=a,b.style.display="none",b.addBehavior("#default#userdata"),document.body.appendChild(b),b},methods:{init:function(){var a=b.ie.prefix+c(this.name);this.el=b.ie.make_userdata(a),this.o.defer&&this.load()},get:function(a,b,d){var e;a=c(a),this.o.defer||this.load(),e=this.el.getAttribute(a),b&&b.call(d||this,e?!0:!1,e)},set:function(a,b,d,e){a=c(a),this.el.setAttribute(a,b),this.o.defer||this.save(),d&&d.call(e||this,!0,b)},remove:function(a,b,d){var e;a=c(a),this.o.defer||this.load(),e=this.el.getAttribute(a),this.el.removeAttribute(a),this.o.defer||this.save(),b&&b.call(d||this,e?!0:!1,e)},load:function(){this.el.load(c(this.name))},save:function(){this.el.save(c(this.name))}}},cookie:{delim:":",size:4e3,test:function(){try{return a.Cookie.enabled?!0:!1}catch(b){return!1}},methods:{key:function(a){return this.name+b.cookie.delim+a},get:function(a,b,c){var d;a=this.key(a),d=f.get(a),b&&b.call(c||this,null!=d,d)},set:function(a,b,c,d){a=this.key(a),f.set(a,b,this.o),c&&c.call(d||this,!0,b)},remove:function(a,b,c,d){var b;a=this.key(a),b=f.remove(a),c&&c.call(d||this,null!=b,b)}}},flash:{test:function(){try{if(!deconcept||!deconcept.SWFObjectUtil)return!1;var a=deconcept.SWFObjectUtil.getPlayerVersion().major;return a>=8?!0:!1}catch(b){return!1}},methods:{init:function(){if(!b.flash.el){var a,c,d,e=C.flash;d=document.createElement("div"),d.id=e.div_id,document.body.appendChild(d),a=new deconcept.SWFObject(this.o.swf_path||e.path,e.id,e.size.w,e.size.h,"8");for(c in e.args)a.addVariable(c,e.args[c]);a.write(d),b.flash.el=document.getElementById(e.id)}this.el=b.flash.el},get:function(a,b,d){var e;a=c(a),e=this.el.get(this.name,a),b&&b.call(d||this,null!==e,e)},set:function(a,b,d,e){var f;a=c(a),f=this.el.set(this.name,a,b),d&&d.call(e||this,!0,b)},remove:function(a,b,d){var e;a=c(a),e=this.el.remove(this.name,a),b&&b.call(d||this,!0,e)}}}};var d=function(){var c,d,f,g,h=C.methods,i=C.search_order;for(c=0,d=h.length;d>c;c++)a.Store.prototype[h[c]]=e;for(a.type=null,a.size=-1,c=0,d=i.length;!a.type&&d>c;c++)if(f=b[i[c]],f.test()){a.type=i[c],a.size=f.size;for(g in f.methods)a.Store.prototype[g]=f.methods[g]}a._init=!0};return a={VERSION:g,type:null,size:0,add:function(a){b[a.id]=a,C.search_order=[a.id].concat(C.search_order),d()},remove:function(a){var c=h(C.search_order,a);0>c||(C.search_order.splice(c,1),delete b[a],d())},Cookie:f,Store:function(b,c){if(!C.name_re.exec(b))throw new Error("Invalid name");if(!a.type)throw new Error("No suitable storage found");c=c||{},this.name=b,c.domain=c.domain||location.host||"localhost",c.domain=c.domain.replace(/:\d+$/,""),this.o=c,c.expires=c.expires||730,c.path=c.path||"/",this.init()}},d(),a}(),"undefined"==typeof deconcept)var deconcept=new Object;"undefined"==typeof deconcept.util&&(deconcept.util=new Object),"undefined"==typeof deconcept.SWFObjectUtil&&(deconcept.SWFObjectUtil=new Object),deconcept.SWFObject=function(a,b,c,d,e,f,g,h,i,j){if(document.getElementById){this.DETECT_KEY=j?j:"detectflash",this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY),this.params=new Object,this.variables=new Object,this.attributes=new Array,a&&this.setAttribute("swf",a),b&&this.setAttribute("id",b),c&&this.setAttribute("width",c),d&&this.setAttribute("height",d),e&&this.setAttribute("version",new deconcept.PlayerVersion(e.toString().split("."))),this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion(),!window.opera&&document.all&&this.installedVer.major>7&&(deconcept.SWFObject.doPrepUnload=!0),f&&this.addParam("bgcolor",f);var k=g?g:"high";this.addParam("quality",k),this.setAttribute("useExpressInstall",!1),this.setAttribute("doExpressInstall",!1);var l=h?h:window.location;this.setAttribute("xiRedirectUrl",l),this.setAttribute("redirectUrl",""),i&&this.setAttribute("redirectUrl",i)}},deconcept.SWFObject.prototype={useExpressInstall:function(a){this.xiSWFPath=a?a:"expressinstall.swf",this.setAttribute("useExpressInstall",!0)},setAttribute:function(a,b){this.attributes[a]=b},getAttribute:function(a){return this.attributes[a]},addParam:function(a,b){this.params[a]=b},getParams:function(){return this.params},addVariable:function(a,b){this.variables[a]=b},getVariable:function(a){return this.variables[a]},getVariables:function(){return this.variables},getVariablePairs:function(){var a,b=new Array,c=this.getVariables();for(a in c)b.push(a+"="+c[a]);return b},getSWFHTML:function(){var a="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){this.getAttribute("doExpressInstall")&&(this.addVariable("MMplayerType","PlugIn"),this.setAttribute("swf",this.xiSWFPath)),a='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'"',a+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var b=this.getParams();for(var c in b)a+=[c]+'="'+b[c]+'" ';var d=this.getVariablePairs().join("&");d.length>0&&(a+='flashvars="'+d+'"'),a+="/>"}else{this.getAttribute("doExpressInstall")&&(this.addVariable("MMplayerType","ActiveX"),this.setAttribute("swf",this.xiSWFPath)),a='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'">',a+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var b=this.getParams();for(var c in b)a+='<param name="'+c+'" value="'+b[c]+'" />';var d=this.getVariablePairs().join("&");d.length>0&&(a+='<param name="flashvars" value="'+d+'" />'),a+="</object>"}return a},write:function(a){if(this.getAttribute("useExpressInstall")){var b=new deconcept.PlayerVersion([6,0,65]);this.installedVer.versionIsValid(b)&&!this.installedVer.versionIsValid(this.getAttribute("version"))&&(this.setAttribute("doExpressInstall",!0),this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl"))),document.title=document.title.slice(0,47)+" - Flash Player Installation",this.addVariable("MMdoctitle",document.title))}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var c="string"==typeof a?document.getElementById(a):a;return c.innerHTML=this.getSWFHTML(),!0}return""!=this.getAttribute("redirectUrl")&&document.location.replace(this.getAttribute("redirectUrl")),!1}},deconcept.SWFObjectUtil.getPlayerVersion=function(){var a=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var b=navigator.plugins["Shockwave Flash"];b&&b.description&&(a=new deconcept.PlayerVersion(b.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split(".")))}else{try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(d){try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");a=new deconcept.PlayerVersion([6,0,21]),c.AllowScriptAccess="always"}catch(d){if(6==a.major)return a}try{c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(d){}}null!=c&&(a=new deconcept.PlayerVersion(c.GetVariable("$version").split(" ")[1].split(",")))}return a},deconcept.PlayerVersion=function(a){this.major=null!=a[0]?parseInt(a[0]):0,this.minor=null!=a[1]?parseInt(a[1]):0,this.rev=null!=a[2]?parseInt(a[2]):0},deconcept.PlayerVersion.prototype.versionIsValid=function(a){return this.major<a.major?!1:this.major>a.major?!0:this.minor<a.minor?!1:this.minor>a.minor?!0:this.rev<a.rev?!1:!0},deconcept.util={getRequestParameter:function(a){var b=document.location.search||document.location.hash;if(b)for(var c=b.substring(1).split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return c[d].substring(c[d].indexOf("=")+1);return""}},deconcept.SWFObjectUtil.cleanupSWFs=function(){for(var a=document.getElementsByTagName("OBJECT"),b=0;b<a.length;b++){a[b].style.display="none";for(var c in a[b])"function"==typeof a[b][c]&&(a[b][c]=function(){})}},deconcept.SWFObject.doPrepUnload&&(deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){},__flash_savedUnloadHandler=function(){},window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)},window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload)),null==Array.prototype.push&&(Array.prototype.push=function(a){return this[this.length]=a,this.length});var getQueryParamValue=deconcept.util.getRequestParameter,FlashObject=deconcept.SWFObject,SWFObject=deconcept.SWFObject,$fh=root.$fh||{};"object"==typeof fh_app_props&&($fh.app_props=fh_app_props),$fh.legacy={};var defaultargs={success:function(){},failure:function(){},params:{}},handleargs=function(a,b,c){var d=[null,null,null],e=[null,null,null],f=a.length;f>2?(e[0]=a[f-3],e[1]=a[f-2],e[2]=a[f-1]):2==f?(e[1]=a[0],e[2]=a[1]):1==f&&(e[2]=a[0]);for(var g=0,h=0;3>g;g++){var i=e[g],j=typeof i;!i||0!=h||"object"!=j&&"boolean"!=j?i&&"function"==j&&(h=0==h?1:h,d[h++]=i):d[h++]=i}if(null==d[0])d[0]=b?b:defaultargs.params;else{var k=d[0];k._defaults=[];for(var l in b)b.hasOwnProperty(l)&&"undefined"==typeof k[l]&&(k[l]=b[l],k._defaults.push(l))}d[1]=null==d[1]?defaultargs.success:d[1],d[2]=null==d[2]?defaultargs.failure:d[2],c(d[0],d[1],d[2])},eventSupported=function(a){var b=document.createElement("i");return a in b||b.setAttribute&&b.setAttribute(a,"return;")||!1},__is_ready=!1,__ready_list=[],__ready_bound=!1,boxprefix="/box/srv/1.1/";_getHostPrefix=function(){return $fh.app_props.host+boxprefix};var __ready=function(){if(!__is_ready&&(__is_ready=!0,__ready_list)){try{for(;__ready_list[0];)__ready_list.shift().apply(document,[])}finally{}__ready_list=null}},__bind_ready=function(){__ready_bound||(__ready_bound=!0,document.addEventListener?(document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),__ready()},!1),window.addEventListener("load",__ready,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),__ready())}),window.attachEvent("onload",__ready),document.documentElement.doScroll&&window==window.top&&function(){if(!__is_ready){try{document.documentElement.doScroll("left")}catch(a){return void setTimeout(arguments.callee,0)}__ready()}}()))};__bind_ready();var _mapScriptLoaded="undefined"!=typeof google&&"undefined"!=typeof google.maps&&"undefined"!=typeof google.maps.Map,_mapLoadSuccessParameters=[],_mapScriptLoading=!1,_loadMapScript=function(){var a=document.createElement("script");a.type="text/javascript";var b=document.location.protocol;b="http:"===b||"https:"===b?b:"https:",a.src=b+"//maps.google.com/maps/api/js?sensor=true&callback=$fh._mapLoaded",document.body.appendChild(a)},audio_obj=null,audio_is_playing=!1;$fh.__dest__={send:function(a,b,c){c("send_nosupport")},notify:function(a,b,c){c("notify_nosupport")},contacts:function(a,b,c){c("contacts_nosupport")},acc:function(a,b,c){c("acc_nosupport")},geo:function(a,b,c){c("geo_nosupport")},cam:function(a,b,c){c("cam_nosupport")},device:function(a,b,c){c("device_nosupport")},listen:function(a,b,c){c("listen_nosupport")},handlers:function(a,b,c){c("handlers_no_support")},file:function(a,b,c){c("file_nosupport")},push:function(a,b,c){c("push_nosupport")},env:function(a,b,c){b({height:window.innerHeight,width:window.innerWidth})},data:function(a,b,c){if($fh._persist||($fh._persist=new Persist.Store("FH"+$fh.app_props.appid,{swf_path:"/static/c/start/swf/persist.swf"})),!a.key)return void c("data_nokey");var d={load:function(){$fh._persist.get(a.key,function(c,d){b(c?{key:a.key,val:d}:{key:a.key,val:null})})},save:function(){if(!a.val)return void c("data_noval");try{$fh._persist.set(a.key,a.val)}catch(d){return void c("data_error",{},a)}b()},remove:function(){$fh._persist.remove(a.key,function(c,d){b(c?{key:a.key,val:d}:{key:a.key,val:null})})}};d[a.act]?d[a.act]():c("data_badact",a)},log:function(a,b,c){"undefined"==typeof console?c("log_nosupport"):console.log(a.message)},ori:function(a,b,c){if("undefined"==typeof a.act||"listen"==a.act)eventSupported("onorientationchange")?window.addEventListener("orientationchange",b,!1):c("ori_nosupport",{},a);else if("set"==a.act){if(!a.value)return void c("ori_no_value",{},a);"portrait"==a.value?(document.getElementsByTagName("body")[0].style["-moz-transform"]="",document.getElementsByTagName("body")[0].style["-webkit-transform"]="",b({orientation:"portrait"})):(document.getElementsByTagName("body")[0].style["-moz-transform"]="rotate(90deg)",document.getElementsByTagName("body")[0].style["-webkit-transform"]="rotate(90deg)",b({orientation:"landscape"}))}else c("ori_badact",{},a)},map:function(a,b,c){if(!a.target)return void c("map_notarget",{},a);if(!a.lat)return void c("map_nolatitude",{},a);if(!a.lon)return void c("map_nologitude",{},a);var d=a.target;if("string"==typeof d){var e=null;if("undefined"!=typeof jQuery)try{var f=jQuery(d);f.length>0&&(e=f[0])}catch(g){e=null}null==e&&(e=document.getElementById(d)),d=e}else"object"==typeof d?1===d.nodeType&&"string"==typeof d.nodeName||(d=d[0]):d=null;if(!d)return void c("map_nocontainer",{},a);if(_mapScriptLoaded){var h={};h.zoom=a.zoom?a.zoom:8,h.center=new google.maps.LatLng(a.lat,a.lon),h.mapTypeId=google.maps.MapTypeId.ROADMAP;var i=new google.maps.Map(d,h);b({map:i})}else"function"==typeof b&&_mapLoadSuccessParameters.push({target:d,successFunction:b,mOptions:a}),$fh._mapLoaded=function(){_mapScriptLoaded=!0;for(var a=_mapLoadSuccessParameters.shift();"undefined"!=typeof a;){var b=a.mOptions,c={};c.zoom=b.zoom?b.zoom:8,c.center=new google.maps.LatLng(b.lat,b.lon),c.mapTypeId=google.maps.MapTypeId.ROADMAP;var d=new google.maps.Map(a.target,c);a.successFunction({map:d}),a=_mapLoadSuccessParameters.shift()}},_mapScriptLoading||(_mapScriptLoading=!0,_loadMapScript()),setTimeout(function(){_mapScriptLoaded||c("map_timeout",{},a)},2e4)},audio:function(a,b,c){if(null==!audio_obj&&"play"==a.act&&(!a.path||""==a.path))return void c("no_audio_path");var d={play:function(){if(null==audio_obj){if(audio_obj=document.createElement("audio"),!(audio_obj.play?!0:!1))return void c("audio_not_support");if(a.type){var e=audio_obj.canPlayType(a.type);if("no"==e||""==e)return void c("audio_type_not_supported")}audio_obj.src=a.path,a.controls&&(audio_obj.controls="controls"),a.autoplay&&(audio_obj.autoplay="autoplay"),a.loop&&(audio_obj.loop="loop"),document.body.appendChild(audio_obj),audio_obj.play(),audio_is_playing=!0,b()}else a.path&&a.path!=audio_obj.src?(audio_is_playing&&d.stop(!0),d.play()):audio_is_playing||(audio_obj.play(),audio_is_playing=!0,b())},pause:function(){null!=audio_obj&&audio_is_playing?("function"==typeof audio_obj.pause?audio_obj.pause():"function"==typeof audio_obj.stop&&audio_obj.stop(),audio_is_playing=!1,b()):c("no_audio_playing")},stop:function(a){null!=audio_obj?("function"==typeof audio_obj.stop?audio_obj.stop():"function"==typeof audio_obj.pause&&audio_obj.pause(),document.body.removeChild(audio_obj),audio_obj=null,audio_is_playing=!1,a||b()):c("no_audio")}};d[a.act]?d[a.act]():c("data_badact",a)},webview:function(a,b,c){c("webview_nosupport")},ready:function(a,b,c){__bind_ready(),__is_ready?b.apply(document,[]):__ready_list.push(b)}},$fh.send=function(){handleargs(arguments,{type:"email"},$fh.__dest__.send)},$fh.notify=function(){handleargs(arguments,{type:"vibrate"},$fh.__dest__.notify)},$fh.contacts=function(){handleargs(arguments,{act:"list"},$fh.__dest__.contacts)},$fh.acc=function(){handleargs(arguments,{act:"register",interval:0},$fh.__dest__.acc)},$fh.geo=function(){handleargs(arguments,{act:"register",interval:0},$fh.__dest__.geo)},$fh.cam=function(){handleargs(arguments,{act:"picture"},$fh.__dest__.cam)},$fh.data=function(){handleargs(arguments,{act:"load"},$fh.__dest__.data)},$fh.log=function(){handleargs(arguments,{message:"none"},$fh.__dest__.log)},$fh.device=function(){handleargs(arguments,{},$fh.__dest__.device)},$fh.listen=function(){handleargs(arguments,{act:"add"},$fh.__dest__.listen)},$fh.ori=function(){handleargs(arguments,{},$fh.__dest__.ori)},$fh.map=function(){handleargs(arguments,{},$fh.__dest__.map)},$fh.audio=function(){handleargs(arguments,{},$fh.__dest__.audio)},$fh.webview=function(){handleargs(arguments,{},$fh.__dest__.webview)},$fh.ready=function(){handleargs(arguments,{},$fh.__dest__.ready)},$fh.handlers=function(){handleargs(arguments,{type:"back"},$fh.__dest__.handlers)},$fh.file=function(){handleargs(arguments,{act:"upload"},$fh.__dest__.file)},$fh.push=function(){handleargs(arguments,{},$fh.__dest__.push)},$fh.env=function(){handleargs(arguments,{},function(a,b,c){$fh.__dest__.env({},function(a){a.application=$fh.app_props.appid,$fh._getDeviceId&&(a.uuid=$fh._getDeviceId()),a.agent=navigator.userAgent||"unknown",b(a)})})},$fh.device=function(){handleargs(arguments,{},function(a,b,c){})},$fh.geoip=function(){handleargs(arguments,{act:"get"},function(a,b,c){if("get"==a.act){var d={instance:$fh.app_props.appid,domain:$fh.cloud_props.domain};$fh.__ajax({url:_getHostPrefix()+"act/wid/geoip/resolve",type:"POST",data:JSON.stringify(d),success:function(a){for(var c in a.geoip)a[c]=a.geoip[c];b(a)}})}else c("geoip_badact",a)})},$fh.web=function(a,b,c){handleargs(arguments,{method:"GET"},function(a,b,c){a.url||c("bad_url"),$fh.__ajax(a.is_local?{url:a.url,type:"GET",dataType:"html",success:function(a){var c={};c.status=200,c.body=a,b(c)},error:function(){c()}}:{url:_getHostPrefix()+"act/wid/web",type:"POST",data:JSON.stringify(a),success:function(a){b(a)}})})},$fh.__webview_win=void 0,$fh.__dest__.webview=function(a,b,c){if("act"in a&&"open"!==a.act)"close"===a.act&&("undefined"!=typeof $fh.__webview_win&&($fh.__webview_win.close(),$fh.__webview_win=void 0),b("closed"));else{if(!a.url)return void c("no_url");{a.url}$fh.__webview_win=window.open(a.url,"_blank"),b("opened")}},("undefined"!=typeof window.PhoneGap||"undefined"!=typeof window.cordova)&&($fh._readyCallbacks=[],$fh._readyState=!1,$fh.__dest__.ready=function(a,b,c){if($fh._readyState)try{b()}catch(d){console.log("Error during $fh.ready. Skip. Error = "+d.message)}else $fh._readyCallbacks.push(b)}),$fh.__dest__.geo=function(a,b,c){if("undefined"!=typeof navigator.geolocation)if(a.act&&"register"!=a.act)"unregister"==a.act?($fh.__dest__._geoWatcher&&(navigator.geolocation.clearWatch($fh.__dest__._geoWatcher),$fh.__dest__._geoWatcher=void 0),b()):c("geo_badact",{},a);else{if($fh.__dest__._geoWatcher)return void c("geo_inuse",{},a);if(0==a.interval&&navigator.geolocation.getCurrentPosition(function(a){var c=a.coords,d={lon:c.longitude,lat:c.latitude,alt:c.altitude,acc:c.accuracy,head:c.heading,speed:c.speed,when:a.timestamp};b(d)},function(){c("error_geo",{},a)}),a.interval>0){var d=navigator.geolocation.watchPosition(function(a){var c=a.coords,d={lon:c.longitude,lat:c.latitude,alt:c.altitude,acc:c.accuracy,head:c.heading,speed:c.speed,when:a.timestamp};b(d)},function(){c("error_geo",{},a)},{frequency:a.interval});$fh.__dest__._geoWatcher=d}}else c("geo_nosupport",{},a)},$fh.__dest__.acc=function(a,b,c){b({x:4*Math.random()-2,y:4*Math.random()-2,z:4*Math.random()-2,when:(new Date).getTime()})},root.$fh=$fh}(this),function(a){function b(a){function b(){return e}var c={},d={exports:{}};!function(){function a(a){var c=!1;return function(){if(c)throw new Error("Callback was already called.");c=!0,a.apply(b,arguments)}}var b,e,f={};b=this,null!=b&&(e=b.async),f.noConflict=function(){return b.async=e,f};var g=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},h=function(a,b){if(a.map)return a.map(b);var c=[];return g(a,function(a,d,e){c.push(b(a,d,e))}),c},i=function(a,b,c){return a.reduce?a.reduce(b,c):(g(a,function(a,d,e){c=b(c,a,d,e)}),c)},j=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};"undefined"!=typeof process&&process.nextTick?(f.nextTick=process.nextTick,f.setImmediate="undefined"!=typeof setImmediate?setImmediate:f.nextTick):"function"==typeof setImmediate?(f.nextTick=function(a){setImmediate(a)},f.setImmediate=f.nextTick):(f.nextTick=function(a){setTimeout(a,0)},f.setImmediate=f.nextTick),f.each=function(b,c,d){if(d=d||function(){},!b.length)return d();var e=0;g(b,function(f){c(f,a(function(a){a?(d(a),d=function(){}):(e+=1,e>=b.length&&d(null))}))})},f.forEach=f.each,f.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c(null):e())})};e()},f.forEachSeries=f.eachSeries,f.eachLimit=function(a,b,c,d){var e=k(b);e.apply(null,[a,c,d])},f.forEachLimit=f.eachLimit;var k=function(a){return function(b,c,d){if(d=d||function(){},!b.length||0>=a)return d();var e=0,f=0,g=0;!function h(){if(e>=b.length)return d();for(;a>g&&f<b.length;)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,g-=1,e>=b.length?d():h())})}()}},l=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[f.each].concat(b))}},m=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[k(a)].concat(c))}},n=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[f.eachSeries].concat(b))}},o=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})};f.map=l(o),f.mapSeries=n(o),f.mapLimit=function(a,b,c,d){return p(b)(a,c,d)};var p=function(a){return m(a,o)};f.reduce=function(a,b,c,d){f.eachSeries(a,function(a,d){c(b,a,function(a,c){b=c,d(a)})},function(a){d(a,b)})},f.inject=f.reduce,f.foldl=f.reduce,f.reduceRight=function(a,b,c,d){var e=h(a,function(a){return a}).reverse();f.reduce(e,b,c,d)},f.foldr=f.reduceRight;var q=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(a){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};f.filter=l(q),f.filterSeries=n(q),f.select=f.filter,f.selectSeries=f.filterSeries;var r=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(a){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};f.reject=l(r),f.rejectSeries=n(r);var s=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(a){d()})};f.detect=l(s),f.detectSeries=n(s),f.some=function(a,b,c){f.each(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){}),d()})},function(a){c(!1)})},f.any=f.some,f.every=function(a,b,c){f.each(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){}),d()})},function(a){c(!0)})},f.all=f.every,f.sortBy=function(a,b,c){f.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},function(a,b){if(a)return c(a);var d=function(a,b){var c=a.criteria,d=b.criteria;return d>c?-1:c>d?1:0};c(null,h(b.sort(d),function(a){return a.value}))})},f.auto=function(a,b){b=b||function(){};var c=j(a);if(!c.length)return b(null);var d={},e=[],h=function(a){e.unshift(a)},k=function(a){for(var b=0;b<e.length;b+=1)if(e[b]===a)return void e.splice(b,1)},l=function(){g(e.slice(0),function(a){a()})};h(function(){j(d).length===c.length&&(b(null,d),b=function(){})}),g(c,function(c){var e=a[c]instanceof Function?[a[c]]:a[c],m=function(a){var e=Array.prototype.slice.call(arguments,1);if(e.length<=1&&(e=e[0]),a){var h={};g(j(d),function(a){h[a]=d[a]}),h[c]=e,b(a,h),b=function(){}}else d[c]=e,f.setImmediate(l)},n=e.slice(0,Math.abs(e.length-1))||[],o=function(){return i(n,function(a,b){return a&&d.hasOwnProperty(b)},!0)&&!d.hasOwnProperty(c)};if(o())e[e.length-1](m,d);else{var p=function(){o()&&(k(p),e[e.length-1](m,d))};h(p)}})},f.waterfall=function(a,b){if(b=b||function(){},a.constructor!==Array){var c=new Error("First argument to waterfall must be an array of functions");return b(c)}if(!a.length)return b();var d=function(a){return function(c){if(c)b.apply(null,arguments),b=function(){};else{var e=Array.prototype.slice.call(arguments,1),g=a.next();e.push(g?d(g):b),f.setImmediate(function(){a.apply(null,e)})}}};d(f.iterator(a))()};var t=function(a,b,c){if(c=c||function(){},b.constructor===Array)a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(j(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};f.parallel=function(a,b){t({map:f.map,each:f.each},a,b)},f.parallelLimit=function(a,b,c){t({map:p(b),each:k(b)},a,c)},f.series=function(a,b){if(b=b||function(){},a.constructor===Array)f.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};f.eachSeries(j(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},f.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},f.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var u=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};f.concat=l(u),f.concatSeries=n(u),f.whilst=function(a,b,c){a()?b(function(d){return d?c(d):void f.whilst(a,b,c)}):c()},f.doWhilst=function(a,b,c){a(function(d){return d?c(d):void(b()?f.doWhilst(a,b,c):c())})},f.until=function(a,b,c){a()?c():b(function(d){return d?c(d):void f.until(a,b,c)})},f.doUntil=function(a,b,c){a(function(d){return d?c(d):void(b()?c():f.doUntil(a,b,c))})},f.queue=function(b,c){function d(a,b,d,e){b.constructor!==Array&&(b=[b]),g(b,function(b){var g={data:b,callback:"function"==typeof e?e:null};d?a.tasks.unshift(g):a.tasks.push(g),a.saturated&&a.tasks.length===c&&a.saturated(),f.setImmediate(a.process)})}void 0===c&&(c=1);var e=0,h={tasks:[],concurrency:c,saturated:null,empty:null,drain:null,push:function(a,b){d(h,a,!1,b)},unshift:function(a,b){d(h,a,!0,b)},process:function(){if(e<h.concurrency&&h.tasks.length){var c=h.tasks.shift();h.empty&&0===h.tasks.length&&h.empty(),e+=1;var d=function(){e-=1,c.callback&&c.callback.apply(c,arguments),h.drain&&h.tasks.length+e===0&&h.drain(),h.process()},f=a(d);b(c.data,f)}},length:function(){return h.tasks.length},running:function(){return e}};return h},f.cargo=function(a,b){var c=!1,d=[],e={tasks:d,payload:b,saturated:null,empty:null,drain:null,push:function(a,c){a.constructor!==Array&&(a=[a]),g(a,function(a){d.push({data:a,callback:"function"==typeof c?c:null}),e.saturated&&d.length===b&&e.saturated()}),f.setImmediate(e.process)},process:function i(){if(!c){if(0===d.length)return void(e.drain&&e.drain());var f="number"==typeof b?d.splice(0,b):d.splice(0),j=h(f,function(a){return a.data});e.empty&&e.empty(),c=!0,a(j,function(){c=!1;var a=arguments;g(f,function(b){b.callback&&b.callback.apply(null,a)}),i()})}},length:function(){return d.length},running:function(){return c}};return e};var v=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(b?console.error&&console.error(b):console[a]&&g(c,function(b){console[a](b)}))}]))}};f.log=v("log"),f.dir=v("dir"),f.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var e=function(){var e=Array.prototype.slice.call(arguments),f=e.pop(),g=b.apply(null,e);g in c?f.apply(null,c[g]):g in d?d[g].push(f):(d[g]=[f],a.apply(null,e.concat([function(){c[g]=arguments;var a=d[g];delete d[g];for(var b=0,e=a.length;e>b;b++)a[b].apply(null,arguments)}])))};return e.memo=c,e.unmemoized=a,e},f.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},f.times=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return f.map(d,b,c)},f.timesSeries=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return f.mapSeries(d,b,c)},f.compose=function(){var a=Array.prototype.reverse.call(arguments);return function(){var b=this,c=Array.prototype.slice.call(arguments),d=c.pop();f.reduce(a,c,function(a,c,d){c.apply(b,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,c){d.apply(b,[a].concat(c))})}};var w=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};f.applyEach=l(w),f.applyEachSeries=n(w),f.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d}a(c)}c()},"undefined"!=typeof c&&c.amd?c([],function(){return f}):"undefined"!=typeof d&&d.exports?d.exports=f:b.async=f}();var e=d.exports;return function(){var a=b("async"),c="date",e="time",f="datetime",g=function(b){function d(b){a.each(Z.pages,function(b,c){a.each(b.fields,function(a,c){return a.pageId=b._id,a.adminOnly?(_[a._id]=a,c()):(a.fieldOptions=a.fieldOptions?a.fieldOptions:{},a.fieldOptions.definition=a.fieldOptions.definition?a.fieldOptions.definition:{},a.fieldOptions.validation=a.fieldOptions.validation?a.fieldOptions.validation:{},$[a._id]=a,a.required&&(aa[a._id]={field:a,submitted:!1,validated:!1}),c())},function(){return c()})},b)}function g(b){a.each(Z.fieldRules,function(b,c){a.each(b.ruleConditionalStatements,function(a,c){var d=a.sourceField;return ca[d]=ca[d]||[],ca[d].push(b),c()},function(){return Array.isArray(b.targetField)?void a.each(b.targetField,function(a,c){da[a]=da[a]||[],da[a].push(b),c()},c):(da[b.targetField]=da[b.targetField]||[],da[b.targetField].push(b),c())})},b)}function h(b){a.each(Z.pageRules,function(b,c){a.each(b.ruleConditionalStatements,function(a,c){var d=a.sourceField;return ea[d]=ea[d]||[],ea[d].push(b),c()},function(){return Array.isArray(b.targetPage)?void a.each(b.targetPage,function(a,c){fa[a]=fa[a]||[],fa[a].push(b),c()},c):(fa[b.targetPage]=fa[b.targetPage]||[],fa[b.targetPage].push(b),c())})},b)}function i(b){ba=JSON.parse(JSON.stringify(aa)),ga={},a.each(Y.formFields,function(a,b){return a.fieldId?_[a.fieldId]?b("Submission "+a.fieldId+" is an admin field. Admin fields cannot be passed to the rules engine."):(ga[a.fieldId]=a,b()):b(new Error("No fieldId in this submission entry: "+util.inspect(a)))},b)}function j(b){return X?b():void a.parallel([d,g,h],function(a){return a?b(a):(X=!0,b())})}function k(a,b){j(function(c){return c?b(c):(Y=a,void i(b))})}function l(b,c,d){return c&&c.formFields?void a.filter(c.formFields,function(a,c){return c(a.fieldId.toString()===b.fieldId.toString())},function(a){var b=null;return a&&a[0]&&a[0].fieldValues&&(b=a[0].fieldValues),d(void 0,b)}):d()}function m(b,c,d){"function"==typeof c&&(d=c,c=null),j(function(e){return e?d(e):void k(b,function(b){return b?d(b):void a.waterfall([function(a){return a(void 0,{validation:{valid:!0}})},function(a,b){n(a,c,b)},o],function(a,b){return a?d(a):d(void 0,b)})})})}function n(b,c,d){a.each(Y.formFields,function(a,d){var e=a.fieldId,f=$[e];l(a,c,function(c,g){return c?d(c):void s(a,f,g,function(a,c){return a?d(a):(c.valid||(b.validation.valid=!1,b.validation[e]=c),d())})})},function(a){return a?d(a):d(void 0,b)})}function o(b,c){a.each(Object.keys(ba),function(a,c){var d={};return ba[a].submitted?c():void T(a,!0,function(e,f){return e?c(e):(f&&(d.fieldId=a,d.valid=!1,d.fieldErrorMessage=["Required Field Not Submitted"],b.validation[a]=d,b.validation.valid=!1),c())})},function(a){return a?c(a):c(void 0,b)})}function p(a,b,c){j(function(d){return d?c(d):void k(b,function(b){if(b)return c(b);var d=ga[a],e=$[a];s(d,e,null,function(b,d){
if(b)return c(b);var e={validation:{}};return e.validation[a]=d,c(void 0,e)})})})}function q(a,b,c,d){function e(b,c){var d={errorMessages:[]};return b&&d.errorMessages.push(b),r(a,d,function(b,d){if(b)return c(b);var e={validation:{}};return e.validation[a]=d,c(void 0,e)})}"function"==typeof c&&(d=c,c=0),j(function(f){if(f)return d(f);var g=$[a],h=!1;h=g.repeating&&g.fieldOptions&&g.fieldOptions.definition&&g.fieldOptions.definition.minRepeat?c<g.fieldOptions.definition.minRepeat:g.required;var i=g.fieldOptions&&g.fieldOptions.validation?g.fieldOptions.validation:void 0;if(i&&!1===i.validateImmediately){var j={validation:{}};return j.validation[a]={valid:!0},d(void 0,j)}return w(b)?h?e("No value specified for required input",d):e(void 0,d):void v(g.type,function(a,c){return a?d(a):void c(b,g,void 0,function(a){var b;a&&(b=a.message?a.message:"Unknown error message"),e(b,d)})})})}function r(b,c,d){var e={};e.fieldId=b,e.errorMessages=c.errorMessages||[],e.fieldErrorMessage=c.fieldErrorMessage||[],a.some(e.errorMessages,function(a,b){return b(null!==a)},function(a){return e.valid=!a&&e.fieldErrorMessage.length<1,d(void 0,e)})}function s(a,b,c,d){T(b._id,!0,function(e,f){return e?d(e):void x(a,b,c,f,function(b,c){return b?d(b):void r(a.fieldId,c,d)})})}function t(a,b,c){var d=b[a];return d?c(void 0,d):c(new Error("Invalid Field Type "+a))}function u(a,b){return t(a,ha,b)}function v(a,b){return t(a,ia,b)}function w(a){return"undefined"==typeof a||null===a||""===a}function x(b,c,d,e,f){function g(a,b,c,d){if(!b.required)return d(void 0,null);var e=a&&a.fieldValues&&a.fieldValues.length>0;return!e&&c?d(void 0,"No value submitted for field "+b.name):d(void 0,null)}function h(a,b){var c=0;if(a&&a.fieldValues&&a.fieldValues.length>0)for(var d=0;d<a.fieldValues.length;d+=1)a.fieldValues[d]&&(c+=1);return b(void 0,c)}function i(a,b,c,d){if(!c)return d(void 0,null);if(b.repeating&&b.fieldOptions&&b.fieldOptions.definition){if(b.fieldOptions.definition.minRepeat&&a<b.fieldOptions.definition.minRepeat)return d(void 0,"Expected min of "+b.fieldOptions.definition.minRepeat+" values for field "+b.name+" but got "+a);if(b.fieldOptions.definition.maxRepeat&&a>b.fieldOptions.definition.maxRepeat)return d(void 0,"Expected max of "+b.fieldOptions.definition.maxRepeat+" values for field "+b.name+" but got "+a)}else if(a>1)return d(void 0,"Should not have multiple values for non-repeating field");return d(void 0,null)}function j(b,c,d,e){u(c.type,function(f,g){return f?e(f):void a.map(b.fieldValues,function(a,b){return w(a)?b(void 0,null):void g(a,c,d,function(a){var d;return d=a?a.message||"Error during validation of field":null,ba[c._id]&&(ba[c._id].submitted=!0),b(void 0,d)})},function(a,b){return a?e(a):e(void 0,b)})})}d=d||null,h(b,function(h,k){return h?f(h):void a.series({valuesSubmitted:a.apply(g,b,c,e),repeats:a.apply(i,k,c,e),values:a.apply(j,b,c,d)},function(a,b){if(a)return f(a);var c=[];return b.valuesSubmitted&&c.push(b.valuesSubmitted),b.repeats&&c.push(b.repeats),f(void 0,{fieldErrorMessage:c,errorMessages:b.values})})})}function y(a){var b,c,d,e="^",f="c".charCodeAt(0),g="n".charCodeAt(0),h=a.length;for(b=0;h>b;b+=1){switch(c=a.charCodeAt(b)){case f:d="[a-zA-Z0-9]";break;case g:d="[0-9]";break;default:var i=c.toString(16).toUpperCase();d="\\u"+("0000"+i).substr(-4)}e+=d}return e+"$"}function z(a,b){var c=new RegExp(b);return c.test(a)}function A(a,b,c){var d;return d="simple"===b?y(c):"regex"===b?c:y(c),z(a,d)}function B(a,b,c,d){if("string"!=typeof a)return d(new Error("Expected string but got "+typeof a));var e={};b&&b.fieldOptions&&b.fieldOptions.validation&&(e=b.fieldOptions.validation);var f=e.field_format_mode||"";f=f.trim();var g=e.field_format_string||"";return g=g.trim(),g&&g.length>0&&f&&f.length>0&&!A(a,f,g)?d(new Error("field value in incorrect format, expected format: "+g+" but submission value is: "+a)):b.fieldOptions&&b.fieldOptions.validation&&b.fieldOptions.validation.min&&a.length<b.fieldOptions.validation.min?d(new Error("Expected minimum string length of "+b.fieldOptions.validation.min+" but submission is "+a.length+". Submitted val: "+a)):b.fieldOptions&&b.fieldOptions.validation&&b.fieldOptions.validation.max&&a.length>b.fieldOptions.validation.max?d(new Error("Expected maximum string length of "+b.fieldOptions.validation.max+" but submission is "+a.length+". Submitted val: "+a)):d()}function C(a,b,c,d){var e=a-0,f=e==a;return f?D(e,b,c,d):d(new Error("Expected numeric but got: "+a))}function D(a,b,c,d){return"number"!=typeof a?d(new Error("Expected number but got "+typeof a)):b.fieldOptions&&b.fieldOptions.validation&&b.fieldOptions.validation.min&&a<b.fieldOptions.validation.min?d(new Error("Expected minimum Number "+b.fieldOptions.validation.min+" but submission is "+a+". Submitted number: "+a)):b.fieldOptions.validation.max&&a>b.fieldOptions.validation.max?d(new Error("Expected maximum Number "+b.fieldOptions.validation.max+" but submission is "+a+". Submitted number: "+a)):d()}function E(a,b,c,d){return"string"!=typeof a?d(new Error("Expected string but got "+typeof a)):null===a.match(/[-0-9a-zA-Z.+_]+@[-0-9a-zA-Z.+_]+\.[a-zA-Z]{2,4}/g)?d(new Error("Invalid email address format: "+a)):d()}function F(b,c,d,e){return"string"!=typeof b?e(new Error("Expected submission to be string but got "+typeof b)):c.fieldOptions.definition.options?void a.some(c.fieldOptions.definition.options,function(a,c){return c(a.label===b)},function(a){return a?e():e(new Error("Invalid option specified: "+b))}):e(new Error("No options exist for field "+c.name))}function G(b,c,d,e){var f;c&&c.fieldOptions&&c.fieldOptions.validation&&(f=c.fieldOptions.validation.min);var g;if(c&&c.fieldOptions&&c.fieldOptions.validation&&(g=c.fieldOptions.validation.max),f&&(null===b.selections||void 0===b.selections||b.selections.length<f)){var h;return b.selections&&(h=b.selections.length),e(new Error("Expected a minimum number of selections "+f+" but got "+h))}if(g&&b.selections&&b.selections.length>g)return e(new Error("Expected a maximum number of selections "+g+" but got "+b.selections.length));var i=[];a.eachSeries(c.fieldOptions.definition.options,function(a,b){for(var c in a)i.push(a[c]);return b()},function(){a.eachSeries(b.selections,function(a,b){return"string"!=typeof a?b(new Error("Expected checkbox submission to be string but got "+typeof a)):-1===i.indexOf(a)?b(new Error("Checkbox Option "+a+" does not exist in the field.")):b()},e)})}function H(a,b,c,d){return a.lat&&a["long"]?isNaN(parseFloat(a.lat))||isNaN(parseFloat(a["long"]))?d(new Error("Invalid latitude and longitude values")):d():d(new Error("Invalid object for locationMap submission"))}function I(a,b,c,d){function e(a,b){if("string"!=typeof a.zone||0===a.zone.length)return b(new Error("Invalid zone definition for northings and eastings location. "+a.zone));var c=parseInt(a.eastings,10);if(isNaN(c))return b(new Error("Invalid eastings definition for northings and eastings location. "+a.eastings));var d=parseInt(a.northings,10);return isNaN(d)?b(new Error("Invalid northings definition for northings and eastings location. "+a.northings)):b()}return"latlong"===b.fieldOptions.definition.locationUnit?a.lat&&a["long"]?isNaN(parseFloat(a.lat))||isNaN(parseFloat(a["long"]))?d(new Error("Invalid latitude and longitude values")):d():d(new Error("Invalid object for latitude longitude submission")):a.zone&&a.eastings&&a.northings?e(a,d):d(new Error("Invalid object for northings easting submission. Zone, Eastings and Northings elemets are required"))}function J(a,b,c,d){O(a,b,c,function(e){return e?void M(a,b,c,function(e){return e?void N(a,b,c,function(a){return a?d(a):d()}):d()}):d()})}function K(a,b,c,d){return"object"!=typeof a||null===a?d(new Error("Expected object but got "+typeof a)):"string"!=typeof a.text||0===a.text.length?d(new Error("Expected text parameter.")):"string"!=typeof a.format||0===a.format.length?d(new Error("Expected format parameter.")):d()}function L(a,b,c,d){a=a||{};var e=a.fieldOptions||{},f=e.definition||{},g=f.file_size||null;if(null!==g){var h=b[c],i=1;return h>1e3&&(i=h/1e3),h>1e3*g?d(new Error("File size is too large. File can be a maximum of "+g+"KB. Size of file selected: "+i+"KB")):d()}return d()}function M(b,c,d,e){if("object"!=typeof b)return e(new Error("Expected object but got "+typeof b));var f=[{keyName:"fileName",valueType:"string"},{keyName:"fileSize",valueType:"number"},{keyName:"fileType",valueType:"string"},{keyName:"fileUpdateTime",valueType:"number"},{keyName:"hashName",valueType:"string"}];a.each(f,function(a,c){var d=typeof b[a.keyName];return d!==a.valueType?c(new Error("Expected "+a.valueType+" but got "+d)):"fileName"===a.keyName&&b[a.keyName].length<=0?c(new Error("Expected value for "+a.keyName)):c()},function(a){return a?e(a):void L(c,b,"fileSize",function(a){return a?e(a):b.hashName.indexOf("filePlaceHolder")>-1?e():d&&d.hashName&&d.hashName.indexOf(b.hashName)>-1?e():e(new Error("Invalid file placeholder text"+b.hashName))})})}function N(b,c,d,e){if("function"!=typeof File)return e(new Error("Expected File object but got "+typeof b));var f=[{keyName:"name",valueType:"string"},{keyName:"size",valueType:"number"}];a.each(f,function(a,c){var d=typeof b[a.keyName];return d!==a.valueType?c(new Error("Expected "+a.valueType+" but got "+d)):"string"===d&&b[a.keyName].length<=0?c(new Error("Expected value for "+a.keyName)):"number"===d&&b[a.keyName]<=0?c(new Error("Expected > 0 value for "+a.keyName)):c()},function(a){return a?e(a):void L(c,b,"size",function(a){return a?e(a):e()})})}function O(a,b,c,d){return"string"!=typeof a?d(new Error("Expected base64 string but got "+typeof a)):a.length<=0?d(new Error("Expected base64 string but was empty")):d()}function P(a,b,d,g){var h,i=!1,j=[];if("string"!=typeof a)return g(new Error("Expected string but got "+typeof a));switch(b.fieldOptions.definition.datetimeUnit){case c:j=a.split("/"),i=3===j.length,i&&(i=W(j[2],1,31)),i&&(i=W(j[1],1,12)),i&&(i=W(j[0],1e3,9999));try{h=i?new Date(j[3],j[1],j[0]):new Date(a),i="Invalid Date"!==h.toString()}catch(k){i=!1}return i?g():g(new Error("Invalid date value "+a+". Date format is YYYY/MM/DD"));case e:return j=a.split(":"),i=2===j.length||3===j.length,i&&(i=W(j[0],0,23)),i&&(i=W(j[1],0,59)),i&&3===j.length&&(i=W(j[2],0,59)),i?g():g(new Error("Invalid time value "+a+". Time format is HH:MM:SS"));case f:j=a.split(/[- :]/),i=6===j.length||5===j.length,i&&(i=W(j[2],1,31)),i&&(i=W(j[1],1,12)),i&&(i=W(j[0],1e3,9999)),i&&(i=W(j[3],0,23)),i&&(i=W(j[4],0,59)),i&&6===j.length?i=W(j[5],0,59):j[5]=0;try{h=i?new Date(j[0],j[1],j[2],j[3],j[4],j[5]):new Date(a),i="Invalid Date"!==h.toString()}catch(k){i=!1}return i?g():g(new Error("Invalid dateTime string "+a+". dateTime format is YYYY/MM/DD HH:MM:SS"));default:return g(new Error("Invalid dateTime fieldtype "+b.fieldOptions.definition.datetimeUnit))}}function Q(a,b,c,d){return d(new Error("Should not submit section field: "+b.name))}function R(b,c){var d=!0;a.each(b,function(b,c){var e=[],f=[];a.each(b.ruleConditionalStatements,function(a,b){var c,d,g=$[a.sourceField],h=!1,i=[];return ga[a.sourceField]&&ga[a.sourceField].fieldValues&&(i=ga[a.sourceField].fieldValues,c=a.restriction,d=a.sourceValue,h=V(g,i[0],d,c)),e.push({field:g,submissionValues:i,condition:c,testValue:d,passed:h}),h&&f.push(g),b()},function(a){function g(a,b,c){return"and"===a&&b.length===c.length||"or"===a&&b.length>0}return a&&c(a),d=g(b.ruleConditionalOperator,f,e)?"show"===b.type&&d:"show"!==b.type&&d,c()})},function(a){return a?c(a):c(void 0,d)})}function S(a,b){j(function(c){return c?b(c):la(a)?R(fa[a],b):b(void 0,!0)})}function T(b,c,d){j(function(e){if(e)return d(e);var f=$[b];return _[b]?d(new Error("Submission "+b+" is an admin field. Admin fields cannot be passed to the rules engine.")):f?void a.waterfall([function(a){return c?void S(f.pageId,a):a(void 0,!0)},function(a,c){return a?ka(b)?R(da[b],c):c(void 0,!0):c(void 0,!1)}],d):d(new Error("Field does not exist in form"))})}function U(b,c){j(function(d){return d?c(d):void k(b,function(b){if(b)return c(b);var d={};a.parallel([function(b){d.fields={},a.eachSeries(Object.keys(da),function(a,b){T(a,!1,function(c,e){return c?b(c):(d.fields[a]={targetId:a,action:e?"show":"hide"},b())})},b)},function(b){d.pages={},a.eachSeries(Object.keys(fa),function(a,b){S(a,function(c,e){return c?b(c):(d.pages[a]={targetId:a,action:e?"show":"hide"},b())})},b)}],function(a){return a?c(a):c(void 0,{actions:d})})})})}function V(a,b,c,d){var e=a.type,f=a.fieldOptions?a.fieldOptions:{};return"undefined"==typeof b||null===b?!1:"function"==typeof ja[e]?ja[e](b,c,d,f):!1}function W(a,b,c){var d=parseInt(a,10);return!isNaN(d)&&d>=b&&c>=d}var X,Y,Z=b,$={},_={},aa={},ba={},ca={},da={},ea={},fa={},ga={},ha={text:B,textarea:B,number:C,emailAddress:E,dropdown:F,radio:F,checkboxes:G,location:I,locationMap:H,photo:M,signature:M,file:M,dateTime:P,url:B,sectionBreak:Q,barcode:K,sliderNumber:C},ia={text:B,textarea:B,number:C,emailAddress:E,dropdown:F,radio:F,checkboxes:G,location:I,locationMap:H,photo:J,signature:J,file:J,dateTime:P,url:B,sectionBreak:Q,barcode:K,sliderNumber:C},ja={text:function(a,b,c){return this.comparisonString(a,b,c)},textarea:function(a,b,c){return this.comparisonString(a,b,c)},number:function(a,b,c){return this.numericalComparison(a,b,c)},emailAddress:function(a,b,c){return this.comparisonString(a,b,c)},dropdown:function(a,b,c){return this.comparisonString(a,b,c)},radio:function(a,b,c){return this.comparisonString(a,b,c)},checkboxes:function(a,b,c){a=a||{};var d=!1;if(!(a.selections instanceof Array))return!1;for(var e=0;e<a.selections.length;e++){var f=a.selections[e];this.comparisonString(f,b,"is")&&(d=!0)}return"is"===c?d:!d},dateTime:function(a,b,d,g){var h=!1;g=g||{definition:{}};var i=null,j=null;switch(g.definition.datetimeUnit){case c:try{i=new Date(new Date(a).toDateString()).getTime(),j=new Date(new Date(b).toDateString()).getTime(),h=!0}catch(k){i=null,j=null,h=!1}break;case e:var l=this.cvtTimeToSeconds(a),m=this.cvtTimeToSeconds(b);i=l.seconds,j=m.seconds,h=l.valid&&m.valid;break;case f:try{i=new Date(a).getTime(),j=new Date(b).getTime(),h=!0}catch(k){h=!1}break;default:h=!1}return h?h="is at"===d?i===j:"is before"===d?j>i:"is after"===d?i>j:!1:!1},url:function(a,b,c){return this.comparisonString(a,b,c)},barcode:function(a,b,c){return a=a||{},"string"!=typeof a.text?!1:this.comparisonString(a.text,b,c)},sliderNumber:function(a,b,c){return this.numericalComparison(a,b,c)},comparisonString:function(a,b,c){var d=!0;return d="is"===c?a===b:"is not"===c?a!==b:"contains"===c?-1!==a.indexOf(b):"does not contain"===c?-1===a.indexOf(b):"begins with"===c?a.substring(0,b.length)===b:"ends with"===c?a.substring(Math.max(0,a.length-b.length),a.length)===b:!1},numericalComparison:function(a,b,c){var d=parseInt(a,10),e=parseInt(b,10);return isNaN(d)||isNaN(e)?!1:"is equal to"===c?d===e:"is less than"===c?e>d:"is greater than"===c?d>e:!1},cvtTimeToSeconds:function(a){var b=!1,c=0;if("string"==typeof a){var d=a.split(":");b=2===d.length||3===d.length,b&&(b=W(d[0],0,23),c+=60*parseInt(d[0],10)*60),b&&(b=W(d[1],0,59),c+=60*parseInt(d[1],10)),b&&3===d.length&&(b=W(d[2],0,59),c+=parseInt(d[2],10))}return{valid:b,seconds:c}}},ka=function(a){return!!da[a]},la=function(a){return!!fa[a]};return{validateForm:m,validateField:p,validateFieldValue:q,checkRules:U,validateFieldInternal:x,initSubmission:k,isFieldVisible:T,isConditionActive:V}};"undefined"!=typeof d&&d.exports&&(d.exports=g)}(),d.exports(a)}var c=function(a){function b(a,b){var d={updateForms:!0};if("undefined"==typeof b)b=a;else for(var e in a)d[e]=a[e];var f=d.config||{};c.config=c.models.config,c.config.init(f,function(a){a&&$fh.forms.log.e("Form config loading error: ",a),c.models.log.loadLocal(function(a){a&&console.error("Error loading config from local storage"),c.models.submissions.loadLocal(function(a){a&&console.error("Error loading submissions"),c.models.uploadManager.loadLocal(function(a){$fh.forms.log.d("Upload Manager loaded from memory."),a&&$fh.forms.log.e("Error loading upload manager from memory ",a),c.models.uploadManager.start(),$fh.forms.log.l("Refreshing Theme."),c.models.theme.refresh(!0,function(a){a&&$fh.forms.log.e("Error refreshing theme ",a),d.updateForms===!0?($fh.forms.log.l("Refreshing Forms."),c.models.forms.refresh(!0,function(a){a&&$fh.forms.log.e("Error refreshing forms: ",a),b()})):b()})})})})})}return a.init=b,a}(c||{});c.utils=function(a){function b(){return"undefined"!=typeof window.Phonegap||"undefined"!=typeof window.cordova}function c(a,b){if(b.constructor&&b.constructor===Function)for(var c in b.prototype)a.prototype[c]=b.prototype[c];else for(var d in b)a.prototype[d]=b[d]}function d(a){var b=new Date;return a?b.getTimezoneOffset():b}function e(a){var b=a.getProps(),c=b._id,e=b._type,f=d().getTime();return c&&e?c+"_"+e+"_"+f:c?c+"_"+f:e?e+"_"+f:f}function f(a,b){"undefined"!=typeof $fh&&$fh.hash?$fh.hash({algorithm:"MD5",text:a},function(a){a&&a.hashvalue?b(null,a.hashvalue):b("Crypto failed.")}):b("Crypto not found")}function g(a,b){$fh.forms.log.d("Sending mail: ",a),$fh.send(a,function(){b(null)},function(a){b(a)})}return a.extend=c,a.localId=e,a.md5=f,a.getTime=d,a.send=g,a.isPhoneGap=b,a}(c.utils||{}),c.utils=function(a){function b(){return r(),s}function d(a,b){if(!a instanceof File)return b("Only file object can be used for converting");var c=new FileReader;c.onloadend=function(a){var c=a.target.result;return b(null,c)},c.readAsDataURL(a)}function e(a){var b;if(c.utils.isPhoneGap())b=a;else{var d="text/plain";try{b=new Blob([a],{type:d})}catch(e){var f=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===e.name&&f){var g=new f;g.append([a.buffer]),b=g.getBlob(d)}else b=a}}return b}function f(a){h("dummy.txt","TestContnet",function(b,c){return b?a(b):void p("dummy.txt",0,{},function(b,c){var d=c.fullPath.replace("dummy.txt","");return c.remove(),a(null,d)})})}function g(a){var b=null;if("object"==typeof a&&null!==a)if(a instanceof File||a instanceof Blob)b=a;else{var c=JSON.stringify(a);b=e(c)}else"string"==typeof a&&(b=e(a));return b}function h(a,b,d){var e=g(b);if(null===e)return d("Invalid content type. Object was null");var f=e.size||e.length;p(a,f,{create:!0},function(b,f){b?d(b):c.utils.isPhoneGap()&&e instanceof File?f.getParent(function(b){o(e.fullPath,function(c,e){return c?d(c):(a=f.name,void f.remove(function(){e.copyTo(b,a,function(a){return d(null,a)},function(a){return d(a)})},function(a){return d(a)}))},function(a){return d(a)})},function(a){return d(a)}):f.createWriter(function(a){function b(a){return d(null,a)}function c(){a.onwriteend=b,a.write(e)}a.onwriteend=c,a.truncate(0)},function(a){d("Failed to create file write:"+a)})})}function i(a,b){p(a,0,{},function(a,c){return a?"NotFoundError"!==a.name&&1!==a.code?b(a):b(null,null):void c.remove(function(){b(null,null)},function(a){b("Failed to remove file"+a)})})}function j(a,b){n(a,function(a,c){if(a)b(a);else{var d=new FileReader;d.onloadend=function(a){var c=a.target.result;"object"==typeof c&&(c=JSON.stringify(c));try{c=decodeURIComponent(c)}catch(d){}return b(null,c)},d.readAsText(c)}})}function k(a,b){n(a,function(a,c){if(a)return b(a);var d=new FileReader;d.onloadend=function(a){var c=a.target.result;return b(null,c)},d.readAsDataURL(c)})}function l(a,b){n(a,function(a,c){if(a)return b(a);var d=c.type,e=new FileReader;e.onloadend=function(a){var c=a.target.result,e=new Blob([c],{type:d});b(null,e)},e.readAsArrayBuffer(c)})}function m(a,b){n(a,b)}function n(a,b){p(a,0,{},function(a,c){return a?b(a):void c.file(function(a){b(null,a)},function(a){b(a)})})}function o(a,b){-1===a.indexOf("file://")&&"Win32NT"!==window.device.platform&&(a="file://"+a),window.resolveLocalFileSystemURI(a,function(a){return b(null,a)},function(a){return b(a)})}function p(a,b,d,e){r(),"string"==typeof a?t(u,b,function(f){f.root.getFile(a,d,function(a){e(null,a)},function(f){if("QuotaExceededError"===f.name||10===f.code){var g=1073741824;q(g,function(c,f){p(a,b,d,e)})}else{if(!c.utils.isPhoneGap())return e(f);o(a,e)}})},function(){e("Failed to requestFileSystem")}):"function"==typeof e&&e("Expected file name to be a string but was "+a)}function q(a,b){navigator.webkitPersistentStorage?navigator.webkitPersistentStorage.requestQuota(a,function(a){b(null,a)},function(a){b(a,0)}):b(null,a)}function r(){window.requestFileSystem?(t=window.requestFileSystem,s=!0):window.webkitRequestFileSystem?(t=window.webkitRequestFileSystem,s=!0):s=!1,window.LocalFileSystem?u=window.LocalFileSystem.PERSISTENT:window.PERSISTENT&&(u=window.PERSISTENT)}a.fileSystem={isFileSystemAvailable:b,save:h,remove:i,readAsText:j,readAsBlob:l,readAsBase64Encoded:k,readAsFile:m,fileToBase64:d,getBasePath:f};var s=!1,t=function(){console.error("No file system available")},u=1;return r(),a}(c.utils||{}),c.utils=function(a){function b(){return m(),q}function c(){return m(),p}function d(a,b){m(),i(a,b)}function e(){u&&(u.stop(),u=null)}function f(a,b){a=a||{},$fh.forms.log.d("Taking photo ",a,p);var c=a.targetWidth?a.targetWidth:$fh.forms.config.get("targetWidth",640),d=a.targetHeight?a.targetHeight:$fh.forms.config.get("targetHeight",480),e=a.quality?a.quality:$fh.forms.config.get("quality",50),f="undefined"!=typeof a.saveToPhotoAlbum?a.saveToPhotoAlbum:$fh.forms.config.get("saveToPhotoAlbum"),h=a.encodingType?a.encodingType:$fh.forms.config.get("encodingType","jpeg");a.targetWidth=c,a.targetHeight=d,a.quality=e,a.saveToPhotoAlbum=f,a.encodingType=h,"undefined"==typeof a.sourceType&&"undefined"!=typeof Camera&&(a.sourceType=Camera.PictureSourceType.CAMERA),p?g(a,b):q?o(a,b):b("Your device does not support camera.")}function g(a,b){a.encodingType="jpeg"===a.encodingType?Camera.EncodingType.JPEG:Camera.EncodingType.PNG,navigator.camera.getPicture(h(b),b,{quality:a.quality,targetWidth:a.targetWidth,targetHeight:a.targetHeight,sourceType:a.sourceType,saveToPhotoAlbum:a.saveToPhotoAlbum,destinationType:Camera.DestinationType.FILE_URI,encodingType:a.encodingType})}function h(a){return function(b){var c=b;a(null,c)}}function i(a,b){$fh.forms.log.d("Taking photo _html5Camera",a,p);var c=a.targetWidth||$fh.forms.config.get("targetWidth"),d=a.targetHeight||$fh.forms.config.get("targetHeight");r.width=c,r.height=d,s.width=c,s.height=d,u?($fh.forms.log.e("Media device was not released by browser."),b("Media device occupied.")):navigator.getUserMedia({video:!0,audio:!1},function(a){r.src=window.URL.createObjectURL(a),u=a,b(null,r)},b)}function j(a,b){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.barcodeScanner?void cordova.plugins.barcodeScanner.scan(function(a){return $fh.forms.log.d("Barcode Found: "+JSON.stringify(a)),b(null,a)},function(a){$fh.forms.log.e("Scanning failed: "+a),b("Scanning failed: "+a)}):b("Barcode plugin not installed")}function k(a,b){return $fh.forms.log.e("Web Barcode Decoding not supported yet."),b("Web Barcode Decoding not supported yet.")}function l(a,b){c()?j(a,b):k(a,b)}function m(){$fh.forms.log.d("Checking env"),navigator.camera&&navigator.camera.getPicture?p=!0:n()?(q=!0,r=document.createElement("video"),r.autoplay="autoplay",s=document.createElement("canvas"),t=s.getContext("2d")):console.error("Cannot detect usable media API. Camera will not run properly on this device.")}function n(){return navigator.getUserMedia?!0:navigator.webkitGetUserMedia?(navigator.getUserMedia=navigator.webkitGetUserMedia,!0):navigator.mozGetUserMedia?(navigator.getUserMedia=navigator.mozGetUserMedia,!0):navigator.msGetUserMedia?(navigator.getUserMedia=navigator.msGetUserMedia,!0):!1}function o(a,b){if($fh.forms.log.d("Snapshot ",a),u){t.drawImage(r,0,0,a.targetWidth,a.targetHeight);var c=s.toDataURL("image/png"),d=t.getImageData(0,0,a.targetWidth,a.targetHeight);return a.cancelHtml5Camera&&e(),a.rawData?b(null,{imageData:d,width:a.targetWidth,height:a.targetHeight,base64:c}):b(null,c)}$fh.forms.log.e("Media resource is not available"),b("Resource not available")}a.takePhoto=f,a.isPhoneGapCamAvailable=c,a.isHtml5CamAvailable=b,a.initHtml5Camera=d,a.cancelHtml5Camera=e,a.captureBarcode=l;var p=!1,q=!1,r=null,s=null,t=null,u=null;return a}(c.utils||{}),c.web=function(a){return a.uploadFile=function(a,b,c){$fh.forms.log.d("Phonegap uploadFile ",a,b);var d=b.fullPath;if(!$fh.forms.config.isOnline())return $fh.forms.log.e("Phonegap uploadFile. Not Online.",a,b),c("No Internet Connection Available.");var e=function(b){$fh.forms.log.d("upload to url ",a," sucessful"),b.response=b.response||{},"string"==typeof b.response&&(b.response=JSON.parse(b.response)),c(null,b.response)},f=function(a){$fh.forms.log.e("An error uploading a file has occurred: Code = "+a.code),$fh.forms.log.d("upload error source "+a.source),$fh.forms.log.d("upload error target "+a.target),c(a)},g=new FileUploadOptions;g.fileName=null==b.name||""===b.name?"image.png":b.name,g.mimeType=b.contentType?b.contentType:"application/octet-stream",g.httpMethod="https",g.chunkedMode=!0,g.fileKey="file",g.headers={Connection:"close"},$fh.forms.log.d("Beginning file upload ",a,g);var h=new FileTransfer;h.upload(d,encodeURI(a),e,f,g)},a.downloadFile=function(a,b,d){$fh.forms.log.d("Phonegap downloadFile ",a,b);var e=new FileTransfer;return $fh.forms.config.isOnline()?void c.utils.fileSystem.getBasePath(function(c,f){function g(a){return $fh.forms.log.d("File Download Completed Successfully. FilePath: "+a.fullPath),d(null,a.toURL())}function h(a){return $fh.forms.log.e("Error downloading file "+b.fileName+" code: "+a.code),d("Error downloading file "+b.fileName+" code: "+a.code)}if(c)return $fh.forms.log.e("Error getting base path for file download: "+a),d(c);if(!b.fileName)return $fh.forms.log.e("No file name associated with the file to download"),d("No file name associated with the file to download");$fh.forms.log.d("File name for file "+b.fileName+" found. Starting download");var i=f+b.fileName;e.download(encodeURI(a),i,g,h,!1,{headers:{Connection:"close"}})}):($fh.forms.log.e("Phonegap downloadFile. Not Online.",a,b),d("No Internet Connection Available."))},a}(c.web||{}),c.web.ajax=function(a){function b(){}function c(a,b){$fh.forms.log.d("Ajax get ",a),e({url:a,type:"GET",dataType:"json",success:function(c,d){$fh.forms.log.d("Ajax get",a,"Success"),b(null,c)},error:function(c,d,e){$fh.forms.log.e("Ajax get",a,"Fail",c,d,e),b(c)}})}function d(a,b,c){$fh.forms.log.d("Ajax post ",a,b);var d,f=!1;if("object"==typeof b)if(b instanceof File){f=!0,d=new FormData;var g=b.name;d.append(g,b),b=d}else b=JSON.stringify(b);var h={url:a,type:"POST",data:b,dataType:"json",success:function(b,d){$fh.forms.log.d("Ajax post ",a," Success"),c(null,b)},error:function(b,d,e){$fh.forms.log.e("Ajax post ",a," Fail ",b,d,e),c(b)}};f===!1&&(h.contentType="application/json"),e(h)}a="undefined"!=typeof $fh&&$fh.__ajax?$fh.__ajax:b,a.get=c,a.post=d;var e=a;return a}(c.web.ajax||{}),c.stores=function(a){function b(a){this.name=a}return a.Store=b,b.prototype.create=function(a,b){throw"Create not implemented:"+this.name},b.prototype.read=function(a,b){throw"Read not implemented:"+this.name},b.prototype.update=function(a,b){throw"Update not implemented:"+this.name},b.prototype.removeEntry=function(a,b){throw"Delete not implemented:"+this.name},b.prototype.upsert=function(a,b){throw"Upsert not implemented:"+this.name},a}(c.stores||{}),c.stores=function(a){function b(){c.stores.Store.call(this,"LocalStorage")}function d(a){return"function"==typeof a.getLocalId?a.getLocalId():a}function e(){j()?g.apply({},arguments):f.apply({},arguments)}function f(a,b,c){return $fh&&$fh.data?void $fh.data(a,function(c){return"undefined"==typeof c&&(c={key:a.key,val:a.val}),"remove"===a.act.toLowerCase()?b(null,null):void b(null,c.val?c.val:null)},c):b()}function g(a,b,d){function e(a){return"undefined"!=typeof d?d(a,{}):void 0}function f(a,b){var d=c.config.get("appId","unknownAppId");a+=d,h.md5(a,function(c,d){c&&(d=a);var e=d;return-1===a.indexOf("filePlaceHolder")&&(e+=".txt"),"undefined"==typeof navigator.externalstorage?b(e):void navigator.externalstorage.enable(function(a){var c=e;return a.path&&(c=a.path,c.match(/\/$/)||(c+="/"),c+=e),e=c,b(e)},function(a){return b(e)})})}function g(a,c){f(a,function(a){i.save(a,c,function(a,d){a?e(a):b(null,c)})})}function j(a){f(a,function(a){i.remove(a,function(a){a?"NotFoundError"===a.name||1===a.code?b(null,null):e(a):b(null,null)})})}function k(a){f(a,function(a){i.readAsText(a,function(a,c){a?"NotFoundError"===a.name||1===a.code?b(null,null):e(a):b(null,c)})})}function l(a){f(a,function(a){i.readAsFile(a,function(a,c){a?"NotFoundError"===a.name||1===a.code?b(null,null):e(a):b(null,c)})})}return"undefined"==typeof a.act?k(a.key):"save"===a.act?g(a.key,a.val):"remove"===a.act?j(a.key):"load"===a.act?k(a.key):"loadFile"===a.act?l(a.key):"undefined"!=typeof d?d("Action ["+a.act+"] is not defined",{}):void 0}var h=c.utils,i=h.fileSystem,j=function(){};return c.utils.extend(b,c.stores.Store),b.prototype.create=function(a,b){var c=h.localId(a);a.setLocalId(c),this.update(a,b)},b.prototype.read=function(a,b){if("object"==typeof a&&"offlineTest"===a.get("_type"))return b(null,{});var c=d(a);null!=c?e({act:"load",key:c.toString()},b,b):b(null,null)},b.prototype.update=function(a,b){var c=d(a),f=a.getProps(),g=JSON.stringify(f);e({act:"save",key:c.toString(),val:g},b,b)},b.prototype.removeEntry=function(a,b){var c=d(a);e({act:"remove",key:c.toString()},b,b)},b.prototype.upsert=function(a,b){var c=d(a);null===c?this.create(a,b):this.update(a,b)},b.prototype.switchFileSystem=function(a){j=function(){return a}},b.prototype.defaultStorage=function(){j=function(){return i.isFileSystemAvailable()}},b.prototype.saveFile=function(a,b,c){return j()?void e({act:"save",key:a,val:b},c,c):c("File system not available")},b.prototype.updateTextFile=function(a,b,c){e({act:"save",key:a,val:b},c,c)},b.prototype.readFile=function(a,b){e({act:"loadFile",key:a},b,b)},b.prototype.readFileText=function(a,b){e({act:"load",key:a},b,b)},j=function(){return i.isFileSystemAvailable()},a.localStorage=new b,a}(c.stores||{}),c.stores=function(a){function b(){e.call(this,"MBaaS")}function d(a){$fh.forms.log.d("_getUrl ",a);var b=a.get("_type"),d=c.config.getCloudHost(),e=c.config.get("mbaasBaseUrl"),f=c.config.get("formUrls"),g="";f[b]?g=f[b]:$fh.forms.log.e("type not found to get url:"+b);var h=d+e+g,i={};switch(i.appId=c.config.get("appId"),b){case"config":i.appid=a.get("appId"),i.deviceId=a.get("deviceId");break;case"form":i.formId=a.get("_id");break;case"formSubmission":i.formId=a.getFormId();break;case"fileSubmission":i.submissionId=a.getSubmissionId(),i.hashName=a.getHashName(),i.fieldId=a.getFieldId();break;case"base64fileSubmission":i.submissionId=a.getSubmissionId(),i.hashName=a.getHashName(),i.fieldId=a.getFieldId();break;case"submissionStatus":i.submissionId=a.get("submissionId");break;case"completeSubmission":i.submissionId=a.get("submissionId");break;case"formSubmissionDownload":i.submissionId=a.getSubmissionId();break;case"fileSubmissionDownload":i.submissionId=a.getSubmissionId(),i.fileGroupId=a.getFileGroupId();break;case"offlineTest":return"http://127.0.0.1:8453"}for(var j in i)h=h.replace(":"+j,i[j]);return h}var e=c.stores.Store;return a.mBaaS=new b,c.utils.extend(b,e),b.prototype.checkStudio=function(){return c.config.get("studioMode")},b.prototype.create=function(a,b){var e=this;if(e.checkStudio())b("Studio mode mbaas not supported");else{var f=d(a);e.isFileAndPhoneGap(a)?c.web.uploadFile(f,a.getProps(),b):c.web.ajax.post(f,a.getProps(),b)}},b.prototype.isFileAndPhoneGap=function(a){var b=this;return b.isFileTransfer(a)&&b.isPhoneGap()},b.prototype.isFileTransfer=function(a){return"fileSubmission"===a.get("_type")||"base64fileSubmission"===a.get("_type")||"fileSubmissionDownload"===a.get("_type")},b.prototype.isPhoneGap=function(){return"undefined"!=typeof window.Phonegap||"undefined"!=typeof window.cordova},b.prototype.read=function(a,b){var e=this;if(e.checkStudio())b("Studio mode mbaas not supported");
else if("offlineTest"===a.get("_type"))b("offlinetest. ignore");else{var f=d(a);if(e.isFileTransfer(a)&&e.isPhoneGap())c.web.downloadFile(f,a.getFileMetaData(),b);else{if(e.isFileTransfer(a))return b(null,a.getRemoteFileURL());c.web.ajax.get(f,b)}}},b.prototype.update=function(a,b){},b.prototype["delete"]=function(a,b){},b.prototype.completeSubmission=function(a,b){if(this.checkStudio())return b("Studio mode mbaas not supported");var e=d(a);c.web.ajax.post(e,{},b)},b.prototype.submissionStatus=function(a,b){if(this.checkStudio())return b("Studio mode mbaas not supported");var e=d(a);c.web.ajax.get(e,b)},b.prototype.isOnline=function(a){var b=c.config.getCloudHost(),d=b+c.config.get("statusUrl","/sys/info/ping");c.web.ajax.get(d,function(b){return b?($fh.forms.log.e("Online status ajax ",b),a(!1)):($fh.forms.log.d("Online status ajax success"),a(!0))})},a}(c.stores||{}),c.stores=function(a){function b(a,b){d.call(this,"DataAgent"),this.remoteStore=a,this.localStore=b}var d=c.stores.Store;return a.DataAgent=b,a.dataAgent=new b(c.stores.mBaaS,c.stores.localStorage),c.utils.extend(b,d),b.prototype.read=function(a,b){$fh.forms.log.d("DataAgent read ",a);var c=this;this.localStore.read(a,function(d,e){d||!e?($fh.forms.log.d("Error reading model from localStore ",a,d),c.refreshRead(a,b)):b(null,e,!1)})},b.prototype.refreshRead=function(a,b){$fh.forms.log.d("DataAgent refreshRead ",a);var c=this;this.remoteStore.read(a,function(d,e){d?($fh.forms.log.e("Error reading model from remoteStore ",a,d),b(d)):($fh.forms.log.d("Model refresh successfull from remoteStore ",a,e),a.fromJSON(e),c.localStore.upsert(a,function(){var a=Array.prototype.slice.call(arguments,0);a.push(!0),b.apply({},a)}))})},b.prototype.attemptRead=function(a,b){$fh.forms.log.d("DataAgent attemptRead ",a);var c=this;c.checkOnlineStatus(function(d){$fh.forms.config.isOnline()?c.refreshRead(a,function(d){d?c.read(a,b):b.apply({},arguments)}):c.read(a,b)})},b.prototype.checkOnlineStatus=function(a){$fh.forms.log.d("DataAgent check online status ");var b=this;return c.utils.isPhoneGap()&&navigator.connection&&navigator.connection.type&&navigator.connection.type===Connection.NONE?($fh.forms.config.offline(),a(!1)):void b.remoteStore.isOnline(function(b){b===!1?$fh.forms.config.offline():$fh.forms.config.online(),a(null,b)})},a}(c.stores||{}),c.models=function(a){function b(a){if(this.props={_id:null,_type:null,_ludid:null},this.utils=c.utils,this.events={},"undefined"!=typeof a)for(var b in a)this.props[b]=a[b];this.touch()}return b.prototype.on=function(a,b){this.events[a]||(this.events[a]=[]),this.events[a].indexOf(b)<0&&this.events[a].push(b)},b.prototype.off=function(a,b){this.events[a]&&this.events[a].indexOf(b)>=0&&this.events[a].splice(this.events[a].indexOf(b),1)},b.prototype.clearEvents=function(){this.events={}},b.prototype.emit=function(){var a=Array.prototype.slice.call(arguments,0),b=a.shift(),c=this.events[b];if(c&&c.length>0)for(var d=0;d<c.length;d++){var e=c[d];e.apply(this,a)}},b.prototype.getProps=function(){return this.props},b.prototype.get=function(a,b){return"undefined"==typeof this.props[a]?b:this.props[a]},b.prototype.set=function(a,b){this.props[a]=b},b.prototype.setLocalId=function(a){this.set("_ludid",a)},b.prototype.getLocalId=function(){return this.get("_ludid")},b.prototype.toJSON=function(){var a={};for(var b in this.props)a[b]=this.props[b];return a},b.prototype.fromJSON=function(a){if("string"==typeof a)this.fromJSONStr(a);else for(var b in a)this.set(b,a[b]);this.touch()},b.prototype.fromJSONStr=function(a){try{var b=JSON.parse(a);this.fromJSON(b)}catch(c){console.error("Error parsing JSON",c)}},b.prototype.touch=function(){this.set("_localLastUpdate",c.utils.getTime())},b.prototype.getLocalUpdateTimeStamp=function(){return this.get("_localLastUpdate")},b.prototype.genLocalId=function(){return c.utils.localId(this)},b.prototype.refresh=function(a,b){function c(a,c){!a&&c?(e.fromJSON(c),b(null,e)):b(a,e)}var d=this.getDataAgent(),e=this;"undefined"==typeof b&&(b=a,a=!1),a?d.attemptRead(this,c):d.read(this,c)},b.prototype.attemptRefresh=function(a){var b=this.getDataAgent(),c=this;b.attemptRead(this,function(b,d){!b&&d?(c.fromJSON(d),a(null,c)):a(b,c)})},b.prototype.loadLocal=function(a){var b=c.stores.localStorage,d=this;b.read(this,function(b,c){b?a(b):(c&&d.fromJSON(c),a(b,d))})},b.prototype.saveLocal=function(a){var b=c.stores.localStorage;b.upsert(this,a)},b.prototype.clearLocal=function(a){var b=c.stores.localStorage;b.removeEntry(this,a)},b.prototype.getDataAgent=function(){return this.dataAgent||this.setDataAgent(c.stores.dataAgent),this.dataAgent},b.prototype.setDataAgent=function(a){this.dataAgent=a},a.Model=b,a}(c.models||{}),c.models=function(a){function b(){d.call(this,{_type:"config",_ludid:"config"})}var d=c.models.Model,e=!0,f="notset";return c.utils.extend(b,d),b.prototype.init=function(a,b){a.studioMode?(this.set("studioMode",!0),this.fromJSON(a),b()):(this.set("studioMode",!1),this.staticConfig(a),this.refresh(!0,b))},b.prototype.isStudioMode=function(){return this.get("studioMode")},b.prototype.refresh=function(a,b){function c(a,c){var d={};if(!a&&c){if("string"==typeof c)try{d=JSON.parse(c)}catch(f){return $fh.forms.log.e("Invalid json config defintion from remote",f),d={},b(f,null)}else d=c;e.set("defaultConfigValues",d),e.saveLocal(function(a,c){b(a,e)})}else b(a,e)}var d=this.getDataAgent(),e=this;"undefined"==typeof b&&(b=a,a=!1),e.loadLocal(function(a,b){a&&$fh.forms.log.e("Config loadLocal ",a),d.remoteStore.read(e,c)})},b.prototype.getCloudHost=function(){return f},b.prototype.staticConfig=function(a){var b=this,c={defaultConfigValues:{},userConfigValues:{}};b.get("userConfigValues")&&(c.userConfigValues=b.get("userConfigValues"));var d=$fh&&$fh.app_props?$fh.app_props.appid:a.appid,e=$fh&&$fh.app_props?$fh.app_props.mode:"dev";b.set("appId",d),b.set("env",e),$fh&&$fh._getDeviceId?b.set("deviceId",$fh._getDeviceId()):b.set("deviceId","notset"),b._initMBaaS(a),a||(a={}),a.config_admin_user&&delete a.config_admin_user,c.defaultConfigValues=a;var f={sent_save_min:5,sent_save_max:1e3,targetWidth:640,targetHeight:480,quality:50,debug_mode:!1,logger:!1,max_retries:3,timeout:7,log_line_limit:5e3,log_email:"test@example.com",log_level:3,log_levels:["error","warning","log","debug"],config_admin_user:!0,picture_source:"both",saveToPhotoAlbum:!0,encodingType:"jpeg",sent_items_to_keep_list:[5,10,20,30,40,50,100]};for(var g in f)c.defaultConfigValues[g]=f[g];b.fromJSON(c)},b.prototype._initMBaaS=function(a){var b=this;a=a||{};var c=$fh.cloud_props,d=$fh.app_props;d&&(f=d.host),c&&c.hosts&&(f=c.hosts.url),"string"==typeof a.cloudHost&&(f=a.cloudHost),b.set("mbaasBaseUrl","/mbaas");b.get("appId");b.set("formUrls",{forms:"/forms/:appId",form:"/forms/:appId/:formId",theme:"/forms/:appId/theme",formSubmission:"/forms/:appId/:formId/submitFormData",fileSubmission:"/forms/:appId/:submissionId/:fieldId/:hashName/submitFormFile",base64fileSubmission:"/forms/:appId/:submissionId/:fieldId/:hashName/submitFormFileBase64",submissionStatus:"/forms/:appId/:submissionId/status",formSubmissionDownload:"/forms/:appId/submission/:submissionId",fileSubmissionDownload:"/forms/:appId/submission/:submissionId/file/:fileGroupId",completeSubmission:"/forms/:appId/:submissionId/completeSubmission",config:"/forms/:appid/config/:deviceId"}),b.set("statusUrl","/sys/info/ping")},b.prototype.setOnline=function(){var a=e;e=!0,a||this.emit("online")},b.prototype.setOffline=function(){var a=e;e=!1,a&&this.emit("offline")},b.prototype.isOnline=function(){return c.utils.isPhoneGap()&&navigator.connection&&navigator.connection.type?e===!0&&navigator.connection.type!==Connection.NONE:e===!0},b.prototype.isStudioMode=function(){return this.get("studioMode",!1)},a.config=new b,a}(c.models||{}),c.models=function(a){function b(){d.call(this,{_type:"forms",_ludid:"forms_list",loaded:!1})}var d=c.models.Model;return c.utils.extend(b,d),b.prototype.isFormUpdated=function(a){var b=a.get("_id"),c=a.getLastUpdate(),d=this.getFormMetaById(b);return d?c!==d.lastUpdatedTimestamp:!1},b.prototype.setLocalId=function(){$fh.forms.log.e("Forms setLocalId. Not Permitted for Forms.")},b.prototype.getFormMetaById=function(a){$fh.forms.log.d("Forms getFormMetaById ",a);for(var b=this.getFormsList(),c=0;c<b.length;c++){var d=b[c];if(d._id===a)return d}return $fh.forms.log.e("Forms getFormMetaById: No form found for id: ",a),null},b.prototype.size=function(){return this.get("forms").length},b.prototype.getFormsList=function(){return this.get("forms",[])},b.prototype.getFormIdByIndex=function(a){return $fh.forms.log.d("Forms getFormIdByIndex: ",a),this.getFormsList()[a]._id},a.forms=new b,a}(c.models||{}),c.models=function(a){function b(a,b){function f(){function a(){return h.fromJSON(j),h.initialise(),e[h.getFormId()]=h,b(null,h)}return $fh.forms.log.d("Form: loadFromLocal ",i,j,k,l),e[k]?(b(null,e[k]),e[k]):j?a():void h.refresh(!1,function(a,c){return a?b(a):(c.initialise(),e[k]=c,b(null,c))})}function g(){function a(a){$fh.forms.log.d("Form: checkForUpdate",i,j,k,l),a.refresh(!1,function(d,f){d&&$fh.forms.log.e("Error refreshing form from local: ",d),c.models.forms.isFormUpdated(a)?a.refresh(!0,function(c,d){return c?b(c,null):(a.initialise(),e[k]=d,b(c,d))}):(a.initialise(),e[k]=f,b(d,f))})}return $fh.forms.log.d("Form: loadFromRemote",i,j,k,l),e[k]&&($fh.forms.log.d("Form: loaded from cache",i,j,k,l),!c.models.forms.isFormUpdated(e[k]))?(b(null,e[k]),e[k]):void a(h)}var h=this,i=a.rawMode||!1,j=a.rawData||null,k=a.formId,l=a.fromRemote;return $fh.forms.log.d("Form: ",i,j,k,l),"function"!=typeof l&&"function"!=typeof b?$fh.forms.log.e("a callback function is required for initialising form data. new Form (formId, [isFromRemote], cb)"):("function"==typeof l&&(b=l,l=!1),k?(d.call(h,{_id:k,_type:"form"}),h.set("_id",k),h.setLocalId(h.genLocalId(k)),void(i===!0?f():g())):b("Cannot initialise a form object without an id. id:"+k,null))}var d=c.models.Model;a.Form=b;var e={};return c.utils.extend(b,d),b.prototype.getLastUpdate=function(){return $fh.forms.log.d("Form: getLastUpdate"),this.get("lastUpdatedTimestamp")},b.prototype.genLocalId=function(a){return a="string"==typeof a?a:this.get("_id",""),"form_"+a},b.prototype.initialise=function(){this.filterAdminFields(),this.initialisePage(),this.initialiseFields(),this.initialiseRules()},b.prototype.filterAdminFields=function(){for(var a=this.getPagesDef(),b={},c=0;c<a.length;c++){for(var d=a[c],e=d.fields,f=[],g=0,h=0;h<e.length;h++){var i=e[h];i.adminOnly||(b[i._id]={page:c,field:g},g++,f.push(i))}a[c].fields=f}this.set("pages",a),this.set("fieldRef",b)},b.prototype.initialiseFields=function(){$fh.forms.log.d("Form: initialiseFields");var a=this.getFieldRef();this.fields={};for(var b in a){var d=a[b],e=d.page,f=d.field;if(void 0===e||void 0===f)throw"Corruptted field reference";var g=this.getFieldDefByIndex(e,f);if(!g)throw"Field def is not found.";this.fields[b]=new c.models.Field(g,this)}},b.prototype.initialiseRules=function(){$fh.forms.log.d("Form: initialiseRules"),this.rules={};for(var a=this.getPageRules(),b=this.getFieldRules(),d=[],e=0;e<a.length;e++){var f=a[e];d.push({type:"page",definition:f})}for(e=0;e<b.length;e++){var g=b[e];d.push({type:"field",definition:g})}for(e=0;e<d.length;e++)for(var h=d[e],i=new c.models.Rule(h),j=i.getRelatedFieldId(),k=0;k<j.length;k++){var l=j[k];this.rules[l]||(this.rules[l]=[]),this.rules[l].push(i)}},b.prototype.getRulesByFieldId=function(a){return $fh.forms.log.d("Form: getRulesByFieldId"),this.rules[a]},b.prototype.initialisePage=function(){$fh.forms.log.d("Form: initialisePage");var a=this.getPagesDef();this.pages=[];for(var b=0;b<a.length;b++){var d=a[b],e=new c.models.Page(d,this);this.pages.push(e)}},b.prototype.getPageNumberByFieldId=function(a){return a?this.getFieldRef()[a].page:null},b.prototype.getPageModelList=function(){return this.pages},b.prototype.getName=function(){return this.get("name","")},b.prototype.getDescription=function(){return this.get("description","")},b.prototype.getPageRules=function(){return this.get("pageRules",[])},b.prototype.getFieldRules=function(){return this.get("fieldRules",[])},b.prototype.getFieldRef=function(){return this.get("fieldRef",{})},b.prototype.getPagesDef=function(){return this.get("pages",[])},b.prototype.getPageRef=function(){return this.get("pageRef",{})},b.prototype.getFieldModelById=function(a){return this.fields[a]},b.prototype.getFieldModelByCode=function(a){var b=this;if(!a||"string"!=typeof a)return null;for(var c in b.fields){var d=b.fields[c];if(null!==d.getCode()&&d.getCode()===a)return d}return null},b.prototype.getFieldDefByIndex=function(a,b){$fh.forms.log.d("Form: getFieldDefByIndex: ",a,b);var c=this.getPagesDef(),d=c[a];if(d){var e=d.fields?d.fields:[],f=e[b];if(f)return f}return $fh.forms.log.e("Form: getFieldDefByIndex: No field found for page and field index: ",a,b),null},b.prototype.getPageModelById=function(a){$fh.forms.log.d("Form: getPageModelById: ",a);var b=this.getPageRef()[a];return"undefined"!=typeof b?this.pages[b]:void $fh.forms.log.e("page id is not found in pageRef: "+a)},b.prototype.newSubmission=function(){return $fh.forms.log.d("Form: newSubmission"),c.models.submission.newInstance(this)},b.prototype.getFormId=function(){return this.get("_id")},b.prototype.removeFromCache=function(){$fh.forms.log.d("Form: removeFromCache"),e[this.getFormId()]&&delete e[this.getFormId()]},b.prototype.getFileFieldsId=function(){$fh.forms.log.d("Form: getFileFieldsId");var a=[];for(var b in this.fields){var c=this.fields[b];("file"===c.getType()||"photo"===c.getType()||"signature"===c.getType())&&a.push(b)}return a},b.prototype.getRuleEngine=function(){if($fh.forms.log.d("Form: getRuleEngine"),this.rulesEngine)return this.rulesEngine;var a=this.getProps();return this.rulesEngine=new c.RulesEngine(a),this.rulesEngine},a}(c.models||{}),c.models=function(a){function b(a){$fh.forms.log.d("FileSubmission ",a),d.call(this,{_type:"fileSubmission",data:a})}var d=c.models.Model;return a.FileSubmission=b,c.utils.extend(b,d),b.prototype.loadFile=function(a){$fh.forms.log.d("FileSubmission loadFile");var b=this.getHashName(),d=this;c.stores.localStorage.readFile(b,function(c,e){c?($fh.forms.log.e("FileSubmission loadFile. Error reading file",b,c),a(c)):($fh.forms.log.d("FileSubmission loadFile. File read correctly",b,e),d.fileObj=e,a(null))})},b.prototype.getProps=function(){return this.fileObj?($fh.forms.log.d("FileSubmissionDownload: file object found"),this.fileObj):void $fh.forms.log.e("FileSubmissionDownload: no file object found")},b.prototype.setSubmissionId=function(a){$fh.forms.log.d("FileSubmission setSubmissionId.",a),this.set("submissionId",a)},b.prototype.getSubmissionId=function(){return this.get("submissionId")},b.prototype.getHashName=function(){return this.get("data").hashName},b.prototype.getFieldId=function(){return this.get("data").fieldId},a}(c.models||{}),c.models=function(a){function b(a){$fh.forms.log.d("FileSubmissionDownload ",a),d.call(this,{_type:"fileSubmissionDownload",data:a})}var d=c.models.Model;return a.FileSubmissionDownload=b,c.utils.extend(b,d),b.prototype.setSubmissionId=function(a){$fh.forms.log.d("FileSubmission setSubmissionId.",a),this.set("submissionId",a)},b.prototype.getSubmissionId=function(){return $fh.forms.log.d("FileSubmission getSubmissionId: ",this.get("submissionId")),this.get("submissionId","")},b.prototype.getHashName=function(){return $fh.forms.log.d("FileSubmission getHashName: ",this.get("data").hashName),this.get("data",{}).hashName},b.prototype.getFieldId=function(){return $fh.forms.log.d("FileSubmission getFieldId: ",this.get("data").fieldId),this.get("data",{}).fieldId},b.prototype.getFileMetaData=function(){return $fh.forms.log.d("FileSubmission getFileMetaData: ",this.get("data")),this.get("data")?$fh.forms.log.d("FileSubmission getFileMetaData: data found",this.get("data")):$fh.forms.log.e("FileSubmission getFileMetaData: No data found"),this.get("data",{})},b.prototype.getFileGroupId=function(){return $fh.forms.log.d("FileSubmission getFileGroupId: ",this.get("data")),this.get("data",{}).groupId||"notset"},b.prototype.getRemoteFileURL=function(){function a(){var a=b.getSubmissionId(),d=b.getFileGroupId(),e=c.config.get("formUrls",{}).fileSubmissionDownload;return e?(e=e.replace(":submissionId",a),e=e.replace(":fileGroupId",d),e=e.replace(":appId",c.config.get("appId","notSet")),c.models.config.getCloudHost()+"/mbaas"+e):"notset"}var b=this;return $fh.forms.log.d("FileSubmission getRemoteFileURL: "),a()},a}(c.models||{}),c.models=function(a){function b(a){d.call(this,{_type:"formSubmission",data:a})}var d=c.models.Model;return a.FormSubmission=b,c.utils.extend(b,d),b.prototype.getProps=function(){return this.get("data")},b.prototype.getFormId=function(){return this.get("data")||$fh.forms.log.e("No form data for form submission"),this.get("data").formId},a}(c.models||{}),c.models=function(a){function b(a){d.call(this,{_type:"completeSubmission",submissionId:a.get("submissionId"),localSubmissionId:a.get("localSubmissionId")})}var d=c.models.Model;return a.FormSubmissionComplete=b,c.utils.extend(b,d),a}(c.models||{}),c.models=function(a){function b(a){d.call(this,{_type:"formSubmissionDownload",data:a})}var d=c.models.Model;return a.FormSubmissionDownload=b,c.utils.extend(b,d),b.prototype.getSubmissionId=function(){return this.get("data").get("submissionId","not-set")},a}(c.models||{}),c.models=function(a){function b(a){d.call(this,{_type:"submissionStatus",submissionId:a.get("submissionId"),localSubmissionId:a.get("localSubmissionId")})}var d=c.models.Model;return a.FormSubmissionStatus=b,c.utils.extend(b,d),a}(c.models||{}),c.models=function(a){function b(a){d.call(this,a),this.set("_type","base64fileSubmission")}var d=c.models.FileSubmission;return a.Base64FileSubmission=b,c.utils.extend(b,d),a}(c.models||{}),c.models=function(a){function b(){d.call(this,{_type:"submissions",_ludid:"submissions_list",submissions:[]})}var d=c.models.Model;return c.utils.extend(b,d),b.prototype.setLocalId=function(){$fh.forms.log.e("Submissions setLocalId. Not Permitted for submissions.")},b.prototype.saveSubmission=function(a,b){$fh.forms.log.d("Submissions saveSubmission");var c=this;this.updateSubmissionWithoutSaving(a),this.clearSentSubmission(function(){c.saveLocal(b)})},b.prototype.updateSubmissionWithoutSaving=function(a){$fh.forms.log.d("Submissions updateSubmissionWithoutSaving");var b=this.pruneSubmission(a),c=b._ludid;if(c){var d=this.findMetaByLocalId(c),e=this.get("submissions");d?(e.splice(e.indexOf(d),1),e.push(b)):e.push(b)}else $fh.forms.log.e("Invalid submission for localId:",c,JSON.stringify(a))},b.prototype.clearSentSubmission=function(a){$fh.forms.log.d("Submissions clearSentSubmission");var b=this,c=$fh.forms.config.get($fh.forms.config.get("max_sent_saved")?"max_sent_saved":"sent_save_min"),d=(this.get("submissions"),this.getSubmitted());if(d.length>c){$fh.forms.log.d("Submissions clearSentSubmission pruning sentSubmissions.length>maxSent"),d=d.sort(function(a,b){return Date(a.submittedDate)<Date(b.submittedDate)?1:-1});for(var e=[];d.length>c;)e.push(d.pop());for(var f=e.length,g=0;g<e.length;g++){var h=e[g];b.getSubmissionByMeta(h,function(b,c){c.clearLocal(function(b){b&&$fh.forms.log.e("Submissions clearSentSubmission submission clearLocal",b),f--,0===f&&a(null,null)})})}}else a(null,null)},b.prototype.findByFormId=function(a){$fh.forms.log.d("Submissions findByFormId",a);for(var b=[],c=this.get("submissions"),d=0;d<c.length;d++){var e=c[d];c[d].formId===a&&b.push(e)}return b},b.prototype.getSubmissions=function(){return this.get("submissions")},b.prototype.getSubmissionMetaList=b.prototype.getSubmissions,b.prototype.findMetaByLocalId=function(a){$fh.forms.log.d("Submissions findMetaByLocalId",a);for(var b=this.get("submissions"),c=0;c<b.length;c++){var d=b[c];if(b[c]._ludid===a)return d}return null},b.prototype.findMetaByRemoteId=function(a){a=a||"",$fh.forms.log.d("Submissions findMetaByRemoteId: "+a);for(var b=this.get("submissions"),c=0;c<b.length;c++){var d=b[c];if(b[c].submissionId&&b[c].submissionId===a)return d}return null},b.prototype.pruneSubmission=function(a){$fh.forms.log.d("Submissions pruneSubmission");for(var b=["_id","_ludid","status","formName","formId","_localLastUpdate","createDate","submitDate","deviceFormTimestamp","errorMessage","submissionStartedTimestamp","submittedDate","submissionId","saveDate","uploadStartDate"],c=a.getProps(),d={},e=0;e<b.length;e++){var f=b[e];d[f]=c[f]}return d},b.prototype.clear=function(a){$fh.forms.log.d("Submissions clear");var b=this;this.clearLocal(function(c){c?($fh.forms.log.e(c),a(c)):(b.set("submissions",[]),a(null,null))})},b.prototype.getDrafts=function(a){return $fh.forms.log.d("Submissions getDrafts: ",a),a||(a={}),a.status="draft",this.findByStatus(a)},b.prototype.getPending=function(a){return $fh.forms.log.d("Submissions getPending: ",a),a||(a={}),a.status="pending",this.findByStatus(a)},b.prototype.getSubmitted=function(a){return $fh.forms.log.d("Submissions getSubmitted: ",a),a||(a={}),a.status="submitted",this.findByStatus(a)},b.prototype.getError=function(a){return $fh.forms.log.d("Submissions getError: ",a),a||(a={}),a.status="error",this.findByStatus(a)},b.prototype.getInProgress=function(a){return $fh.forms.log.d("Submissions getInProgress: ",a),a||(a={}),a.status="inprogress",this.findByStatus(a)},b.prototype.getDownloaded=function(a){return $fh.forms.log.d("Submissions getDownloaded: ",a),a||(a={}),a.status="downloaded",this.findByStatus(a)},b.prototype.findByStatus=function(a){if($fh.forms.log.d("Submissions findByStatus: ",a),a||(a={}),"string"==typeof a&&(a={status:a}),null===a.status)return[];for(var b=a.status,c=a.formId,d=a.sortField||"createDate",e=this.get("submissions",[]),f=[],g=0;g<e.length;g++)b.indexOf(e[g].status)>-1&&(null!=c?e[g].formId===c&&f.push(e[g]):f.push(e[g]));return f=f.sort(function(a,b){return Date(a[d])<Date(b[d])?-1:1})},b.prototype.getSubmissionByMeta=function(a,b){$fh.forms.log.d("Submissions getSubmissionByMeta: ",a);var d=a._ludid;d?c.models.submission.fromLocal(d,b):($fh.forms.log.e("Submissions getSubmissionByMeta: local id not found for retrieving submission.",d,a),b("local id not found for retrieving submission"))},b.prototype.removeSubmission=function(a,b){$fh.forms.log.d("Submissions removeSubmission: ",a);var c=this.indexOf(a);c>-1&&this.get("submissions").splice(c,1),this.saveLocal(b)},b.prototype.indexOf=function(a,b){$fh.forms.log.d("Submissions indexOf: ",a);for(var c=this.get("submissions"),d=0;d<c.length;d++){{c[d]}if(c[d]._ludid===a)return d}return-1},a.submissions=new b,a}(c.models||{}),c.models=function(a){function b(a,b){b=b?b:{};var d=new e(a,b);return b.submissionId&&c.models.submissions.updateSubmissionWithoutSaving(d),d}function d(a,b){if($fh.forms.log.d("Submission fromLocal: ",a),f[a])$fh.forms.log.d("Submission fromLocal from cache: ",a),b(null,f[a]);else{$fh.forms.log.d("Submission fromLocal not in cache. Loading from local storage.: ",a);var c=new e;c.setLocalId(a),c.loadLocal(function(c,d){if(c)$fh.forms.log.e("Submission fromLocal. Error loading from local: ",a,c),b(c);else{if($fh.forms.log.d("Submission fromLocal. Load from local sucessfull: ",a),d.isDownloadSubmission())return b(null,d);d.reloadForm(function(c,e){c?($fh.forms.log.e("Submission fromLocal. reloadForm. Error re-loading form: ",a,c),b(c)):($fh.forms.log.d("Submission fromLocal. reloadForm. Re-loading form successfull: ",a),f[a]=d,b(null,d))})}})}}function e(a,b){b=b||{},$fh.forms.log.d("Submission: ",b),g.call(this,{_type:"submission"}),"undefined"!=typeof a&&a?(this.set("formName",a.get("name")),this.set("formId",a.get("_id")),this.set("deviceFormTimestamp",a.getLastUpdate()),this.set("createDate",c.utils.getTime()),this.set("timezoneOffset",c.utils.getTime(!0)),this.set("appId",c.config.get("appId")),this.set("appEnvironment",c.config.get("env")),this.set("appCloudName",""),this.set("comments",[]),this.set("formFields",[]),this.set("saveDate",null),this.set("submitDate",null),this.set("uploadStartDate",null),this.set("submittedDate",null),this.set("userId",null),this.set("filesInSubmission",[]),this.set("deviceId",c.config.get("deviceId")),this.transactionMode=!1):(this.set("appId",c.config.get("appId")),b.submissionId?(this.set("downloadSubmission",!0),this.setRemoteSubmissionId(b.submissionId)):this.set("status","new")),this.set("status","new"),this.genLocalId();var d=this.getLocalId();f[d]=this}a.submission={newInstance:b,fromLocal:d};var f={},g=c.models.Model,h={"new":["draft","pending"],draft:["pending","draft"],pending:["inprogress","error","draft"],inprogress:["pending","error","inprogress","downloaded","queued"],submitted:[],error:["draft","pending","error"],downloaded:[],queued:["error","submitted"]};return c.utils.extend(e,g),e.prototype.saveDraft=function(a){$fh.forms.log.d("Submission saveDraft: ");var b="draft",d=this;this.set("timezoneOffset",c.utils.getTime(!0)),this.set("saveDate",c.utils.getTime()),this.changeStatus(b,function(b){return b?a(b):(d.emit("savedraft"),void a(null,null))})},e.prototype.validateField=function(a,b){$fh.forms.log.d("Submission validateField: ",a);var c=this;this.getForm(function(d,e){if(d)b(d);else{var f=c.getProps(),g=e.getRuleEngine();g.validateField(a,f,b)}})},e.prototype.checkRules=function(a){$fh.forms.log.d("Submission checkRules: ");var b=this;this.getForm(function(c,d){if(c)a(c);else{var e=b.getProps(),f=d.getRuleEngine();f.checkRules(e,a)}})},e.prototype.performValidation=function(a){var b=this;b.getForm(function(c,d){if(c)return $fh.forms.log.e("Submission submit: Error getting form ",c),a(c);var e=d.getRuleEngine(),f=b.getProps();e.validateForm(f,a)})},e.prototype.validateSubmission=function(a){var b=this;b.performValidation(function(c,d){if(c)return a(c);var e=d.validation;return e.valid?a(null,e.valid):(b.emit("validationerror",e),void a(null,e.valid))})},e.prototype.submit=function(a){var b=this;$fh.forms.log.d("Submission submit: ");var d="pending";this.set("timezoneOffset",c.utils.getTime(!0)),b.performValidation(function(c,e){if(c)$fh.forms.log.e("Submission submit validateForm: Error validating form ",c),a(c);else{$fh.forms.log.d("Submission submit: validateForm. Completed result",e);var f=e.validation;f.valid?($fh.forms.log.d("Submission submit: validateForm. Completed Form Valid",e),b.set("submitDate",new Date),b.changeStatus(d,function(c){c?a(c):(b.emit("submit"),a(null,null))})):($fh.forms.log.d("Submission submit: validateForm. Completed Validation error",e),b.emit("validationerror",f),a("Validation error"))}})},e.prototype.getUploadTask=function(a){var b=this.getUploadTaskId();b?c.models.uploadManager.getTaskById(b,a):a(null,null)},e.prototype.getFormId=function(){return this.get("formId")},e.prototype.getFormSubmittedAgainst=function(){return this.get("formSubmittedAgainst")},e.prototype.getDownloadTask=function(a){var b=this;if($fh.forms.log.d("getDownloadTask"),b.isDownloadSubmission())b.getUploadTask(a);else if(a&&"function"==typeof a)return $fh.forms.log.e("Submission is not a download submission"),a("Submission is not a download submission")},e.prototype.cancelUploadTask=function(a){var b="submit",d=this;c.models.uploadManager.cancelSubmission(this,function(c){c&&$fh.forms.log.e(c),d.changeStatus(b,a)})},e.prototype.getUploadTaskId=function(){return this.get("uploadTaskId")},e.prototype.setUploadTaskId=function(a){this.set("uploadTaskId",a)},e.prototype.isInProgress=function(){return"inprogress"===this.get("status")},e.prototype.isDownloaded=function(){return"downloaded"===this.get("status")},e.prototype.isSubmitted=function(){return"submitted"===this.get("status")},e.prototype.submitted=function(a){var b=this;if(b.isDownloadSubmission()){var d="Downloaded submissions should not call submitted function.";return $fh.forms.log.e(d),a(d)}$fh.forms.log.d("Submission submitted called");var e="submitted";b.set("submittedDate",c.utils.getTime()),b.changeStatus(e,function(c){c?($fh.forms.log.e("Error setting submitted status "+c),a(c)):($fh.forms.log.d("Submitted status set for submission "+b.get("submissionId")+" with localId "+b.getLocalId()),b.emit("submitted",b.get("submissionId")),a(null,null))})},e.prototype.queued=function(a){var b=this;if(b.isDownloadSubmission()){var d="Downloaded submissions should not call queued function.";return $fh.forms.log.e(d),a(d)}var e="queued";b.set("queuedDate",c.utils.getTime()),b.changeStatus(e,function(c){c?($fh.forms.log.e("Error setting queued status "+c),a(c)):($fh.forms.log.d("Queued status set for submission "+b.get("submissionId")+" with localId "+b.getLocalId()),b.emit("queued",b.get("submissionId")),a(null,b))})},e.prototype.downloaded=function(a){$fh.forms.log.d("Submission Downloaded called");var b=this,d="downloaded";b.set("downloadedDate",c.utils.getTime()),b.changeStatus(d,function(c){c?($fh.forms.log.e("Error setting downloaded status "+c),a(c)):($fh.forms.log.d("Downloaded status set for submission "+b.get("submissionId")+" with localId "+b.getLocalId()),b.emit("downloaded",b.get("submissionId")),a(null,b))})},e.prototype.genLocalId=function(){var a=c.utils.localId(this),b=this.get("formId")||Math.ceil(1e5*Math.random());this.setLocalId(b+"_"+a)},e.prototype.changeStatus=function(a,b){if(this.isStatusValid(a)){this.set("status",a),this.saveToList(function(a){a&&$fh.forms.log.e(a)}),this.saveLocal(b)}else $fh.forms.log.e("Target status is not valid: "+a),b("Target status is not valid: "+a)},e.prototype.upload=function(a){var b="inprogress",d=this;return this.isStatusValid(b)?(this.set("status",b),this.set("uploadStartDate",c.utils.getTime()),c.models.submissions.updateSubmissionWithoutSaving(this),c.models.uploadManager.queueSubmission(d,function(b,c){b?a(b):(c.set("error",null),c.saveLocal(function(a){a&&$fh.forms.log.e("Error saving upload task: "+a)}),d.emit("inprogress",c),c.on("progress",function(a){$fh.forms.log.d("Emitting upload progress for submission: "+d.getLocalId()+JSON.stringify(a)),d.emit("progress",a)}),a(null,c))}),void 0):a("Invalid Status to upload a form submission.")},e.prototype.download=function(a){var b=this;$fh.forms.log.d("Starting download for submission: "+b.getLocalId());var d="pending";return this.isStatusValid(d)?(this.set("status",d),d="inprogress",this.isStatusValid(d)?(this.set("status",d),void c.models.uploadManager.queueSubmission(b,function(c,d){return c?a(c):(d.set("error",null),d.saveLocal(function(a){a&&$fh.forms.log.e("Error saving download task: "+a)}),b.emit("inprogress",d),d.on("progress",function(a){$fh.forms.log.d("Emitting download progress for submission: "+b.getLocalId()+JSON.stringify(a)),b.emit("progress",a)}),a(null,d))})):a("Invalid Status to dowload a form submission")):a("Invalid Status to download a form submission.")},e.prototype.saveToList=function(a){c.models.submissions.saveSubmission(this,a)},e.prototype.error=function(a,b){this.set("errorMessage",a);var c="error";this.changeStatus(c,b),this.emit("error",a)},e.prototype.getStatus=function(){return this.get("status")},e.prototype.isStatusValid=function(a){$fh.forms.log.d("isStatusValid. Target Status: "+a+" Current Status: "+this.get("status").toLowerCase());var b=this.get("status").toLowerCase(),c=h[b];return c.indexOf(a)>-1?!0:(this.set("status","error"),!1)},e.prototype.addComment=function(a,b){var d=c.utils.getTime(),e=d.getTime(),f={madeBy:"undefined"==typeof b?"":b.toString(),madeOn:d,value:a,timeStamp:e};return this.getComments().push(f),e},e.prototype.getComments=function(){return this.get("comments")},e.prototype.removeComment=function(a){for(var b=this.getComments(),c=0;c<b.length;c++){var d=b[c];if(d.timeStamp===a)return void b.splice(c,1)}},e.prototype.populateFilesInSubmission=function(){for(var a=this,b=[],c=a.getSubmissionFiles(),d=0;d<c.length;d++)c[d].fileName?b.push(c[d].fileName):c[d].hashName&&b.push(c[d].hashName);a.set("filesInSubmission",c)},e.prototype.getSubmissionFiles=function(){
var a=this;$fh.forms.log.d("In getSubmissionFiles: "+a.getLocalId());for(var b=[],c=a.getFormFields(),d=0;d<c.length;d++)for(var e=c[d].fieldValues||[],f=0;f<e.length;f++)e[f].fileName?b.push(e[f]):e[f].hashName&&b.push(e[f]);return b},e.prototype.addInputValue=function(a,b){$fh.forms.log.d("Adding input value: ",JSON.stringify(a||{}));var c=this,d=a.fieldId,e=a.value;if(null===e||"undefined"==typeof e)return $fh.forms.log.e("addInputValue: Input value was null. Params: "+d),b(null,{});var f=void 0===a.index?-1:a.index;this.getForm(function(e,g){var h=g.getFieldModelById(d);if(c.transactionMode)c.tmpFields[d]||(c.tmpFields[d]=[]),a.isStore=!1,h.processInput(a,function(a,e){return a?b(a):(f>-1?c.tmpFields[d][f]=e:c.tmpFields[d].push(e),b(null,e))});else{var i=c.getInputValueObjectById(d);i.fieldValues[f]&&"string"==typeof i.fieldValues[f].hashName&&(a.previousFile=i.fieldValues[f]),h.processInput(a,function(a,d){return a?b(a):(f>-1?i.fieldValues[f]=d:i.fieldValues.push(d),"string"==typeof d.hashName&&c.pushFile(d.hashName),b(null,d))})}})},e.prototype.pushFile=function(a){var b=this.get("filesInSubmission",[]);"string"==typeof a&&-1===b.indexOf(a)&&(b.push(a),this.set("filesInSubmission",b))},e.prototype.removeFileValue=function(a){var b=this.get("filesInSubmission",[]);"string"==typeof a&&b.indexOf(a)>-1&&(b.splice(b.indexOf(a),1),this.set("filesInSubmission",b))},e.prototype.getInputValueByFieldId=function(a,b){var c=this.getInputValueObjectById(a).fieldValues;this.getForm(function(d,e){var f=e.getFieldModelById(a);f.convertSubmission(c,b)})},e.prototype.reset=function(){var a=this;a.clearLocalSubmissionFiles(function(b){a.set("formFields",[])})},e.prototype.isDownloadSubmission=function(){return this.get("downloadSubmission")===!0},e.prototype.getSubmissionFile=function(a,b){c.stores.localStorage.readFile(a,b)},e.prototype.clearLocalSubmissionFiles=function(a){$fh.forms.log.d("In clearLocalSubmissionFiles");var b=this,d=b.get("filesInSubmission",[]);$fh.forms.log.d("Files to clear ",d);for(var e in d)$fh.forms.log.d("Clearing file "+d[e]),c.stores.localStorage.removeEntry(d[e],function(a){a&&$fh.forms.log.e("Error removing files from "+a)});a()},e.prototype.startInputTransaction=function(){this.transactionMode=!0,this.tmpFields={}},e.prototype.endInputTransaction=function(a){this.transactionMode=!1;var b={},d="",e=0,f=[],g="";if(a){b=this.tmpFields;for(d in b){var h=this.getInputValueObjectById(d);for(f=b[d],e=0;e<f.length;e++)g=f[e],h.fieldValues.push(g),"string"==typeof g.hashName&&this.pushFile(g.hashName)}this.tmpFields={}}else{b=this.tmpFields,this.tmpFields={};for(d in b)for(f=b[d],e=0;e<f.length;e++)g=f[e],"string"==typeof g.hashName&&c.stores.localStorage.removeEntry(g.hashName,function(a){$fh.forms.log.e("Error removing file from transaction ",a)})}},e.prototype.removeFieldValue=function(a,b){var d=this,e=[],f={};e=this.transactionMode?this.tmpFields.fieldId:this.getInputValueObjectById(a).fieldId,"undefined"==typeof b?f=e.splice(0,e.length):e.length>b&&(f=e.splice(b,1)),"string"==typeof f.hashName&&c.stores.localStorage.removeEntry(f.hashName,function(a){a?$fh.forms.log.e("Error removing file: ",a):d.removeFileValue(f.hashName)})},e.prototype.getInputValueObjectById=function(a){for(var b=this.getFormFields(),c=0;c<b.length;c++){var d=b[c];if(d.fieldId._id){if(d.fieldId._id===a)return d}else if(d.fieldId===a)return d}var e={fieldId:a,fieldValues:[]};return b.push(e),e},e.prototype.getForm=function(a){var b=c.models.Form,d=this.get("formId");return d?($fh.forms.log.d("FormId found for getForm: "+d),void new b({formId:d,rawMode:!0},a)):($fh.forms.log.e("No form Id specified for getForm"),a("No form Id specified for getForm"))},e.prototype.reloadForm=function(a){$fh.forms.log.d("Submission reload form");var b=c.models.Form,d=this.get("formId"),e=this;new b({formId:d,rawMode:!0},function(b,c){b?a(b):(e.form=c,e.get("deviceFormTimestamp",null)||e.set("deviceFormTimestamp",c.getLastUpdate()),a(null,c))})},e.prototype.getFileInputValues=function(a){var b=this;b.getFileFieldsId(function(c,d){return c?a(c):a(null,b.getInputValueArray(d))})},e.prototype.getFormFields=function(){for(var a=this.get("formFields",[]),b=0;b<a.length;b++)a[b].fieldValues=a[b].fieldValues||[],a[b].fieldValues=a[b].fieldValues.filter(function(a){return null!==a&&"undefined"!=typeof a});return a},e.prototype.getFileFieldsId=function(a){var b=this,c=[];if(b.isDownloadSubmission()){for(var d=b.getFormFields(),e=0;e<d.length;e++){var f=d[e].fieldId||{};("file"===f.type||"photo"===f.type||"signature"===f.type)&&f._id&&c.push(f._id)}return a(null,c)}b.getForm(function(b,c){return b?($fh.forms.log.e("Error getting form for getFileFieldsId"+b),a(b)):a(b,c.getFileFieldsId())})},e.prototype.updateFileLocalURI=function(a,b,c){$fh.forms.log.d("updateFileLocalURI: "+b);var d=this;return a=a||{},a.fileName&&b?void d.findFilePlaceholderFieldId(a.fileName,function(e,f){if(e)return c(e);if(!f.fieldId)return $fh.forms.log.e("No file field matches the placeholder name "+a.fileName),c("No file field matches the placeholder name "+a.fileName);var g=d.getInputValueObjectById(f.fieldId).fieldValues[f.valueIndex];g.localURI=b,d.getInputValueObjectById(f.fieldId).fieldValues[f.valueIndex]=g,d.saveLocal(c)}):($fh.forms.log.e("Submission: updateFileLocalURI : No fileName for submissionId : "+JSON.stringify(a)),c("Submission: updateFileLocalURI : No fileName for submissionId : "+JSON.stringify(a)))},e.prototype.findFilePlaceholderFieldId=function(a,b){var c=this,d={};c.getFileFieldsId(function(e,f){for(var g=0;g<f.length;g++)for(var h=f[g],i=c.getInputValueObjectById(h),j=0;j<i.fieldValues.length;j++){var k=i.fieldValues[j];k&&null!==k.fileName&&k.fileName===a&&(d.fieldId=h,d.valueIndex=j)}return b(null,d)})},e.prototype.getInputValueArray=function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c],e=this.getInputValueObjectById(d),f=0;f<e.fieldValues.length;f++){var g=e.fieldValues[f];g&&(g.fieldId=d,b.push(g))}return b},e.prototype.clearLocal=function(a){var b=this;c.models.uploadManager.cancelSubmission(b,function(d,e){return d?($fh.forms.log.e(d),a(d)):void c.models.submissions.removeSubmission(b.getLocalId(),function(c){return c?($fh.forms.log.e(c),a(c)):void b.clearLocalSubmissionFiles(function(){g.prototype.clearLocal.call(b,function(b){return b?($fh.forms.log.e(b),a(b)):void a(null,null)})})})})},e.prototype.getRemoteSubmissionId=function(){return this.get("submissionId","")},e.prototype.setRemoteSubmissionId=function(a){a&&this.set("submissionId",a)},a}(c.models||{}),c.models=function(a){function b(a,b){d.call(this,{_type:"field"}),a&&(this.fromJSON(a),this.genLocalId()),b&&(this.form=b)}var d=c.models.Model;return c.utils.extend(b,d),b.prototype.isRequired=function(){return this.get("required")},b.prototype.getFieldValidation=function(){return this.getFieldOptions().validation||{}},b.prototype.getFieldDefinition=function(){return this.getFieldOptions().definition||{}},b.prototype.getMinRepeat=function(){var a=this.getFieldDefinition();return a.minRepeat||1},b.prototype.getMaxRepeat=function(){var a=this.getFieldDefinition();return a.maxRepeat||1},b.prototype.getFieldOptions=function(){return this.get("fieldOptions",{validation:{},definition:{}})},b.prototype.getPhotoOptions=function(){var a={targetWidth:null,targetHeight:null,quality:null,saveToPhotoAlbum:null,pictureSource:null,encodingType:null},b=this.getFieldDefinition();return a.targetWidth=b.photoWidth,a.targetHeight=b.photoHeight,a.quality=b.photoQuality,a.saveToPhotoAlbum=b.saveToPhotoAlbum,a.pictureSource=b.photoSource,a.encodingType=b.photoType,a},b.prototype.isRepeating=function(){return this.get("repeating",!1)},b.prototype.getType=function(){return this.get("type","text")},b.prototype.getFieldId=function(){return this.get("_id","")},b.prototype.getName=function(){return this.get("name","unknown")},b.prototype.getCode=function(){return this.get("fieldCode",null)},b.prototype.getHelpText=function(){return this.get("helpText","")},b.prototype.getDefaultValue=function(){var a=this.getFieldDefinition();return a?a.defaultValue:""},b.prototype.isAdminField=function(){return this.get("adminOnly")},b.prototype.processInput=function(a,b){var c=this.getType(),d="process_"+c,e=a.value;return"undefined"==typeof e||null===e?b(null,e):void(this[d]&&"function"==typeof this[d]?this[d](a,b):b(null,e))},b.prototype.convertSubmission=function(a,b){var c=this.getType(),d="convert_"+c;this[d]&&"function"==typeof this[d]?this[d](a,b):b(null,a)},b.prototype.validate=function(a,b,c){"function"==typeof b&&(c=b,b=0),this.form.getRuleEngine().validateFieldValue(this.getFieldId(),a,b,c)},b.prototype.getRules=function(){var a=this.getFieldId();return this.form.getRulesByFieldId(a)},b.prototype.setVisible=function(a){this.set("visible",a),this.emit(a?"visible":"hidden")},a.Field=b,a}(c.models||{}),c.models.Field=function(a){return a.prototype.process_barcode=function(a,b){var c=a.value||{};return"string"==typeof c.text&&"string"==typeof c.format?b(null,{text:c.text,format:c.format}):b("Invalid barcode parameters.")},a}(c.models.Field||{}),c.models.Field=function(a){return a.prototype.getCheckBoxOptions=function(){var a=this.getFieldDefinition();if(a.options)return a.options;throw"checkbox choice definition is not found in field definition"},a.prototype.process_checkboxes=function(a,b){var c=a.value;c&&c.selections&&c.selections instanceof Array?b(null,c):b("the input value for processing checkbox field should be like {selections: [val1,val2]}")},a.prototype.convert_checkboxes=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d].selections);b(null,c)},a}(c.models.Field||{}),c.models.Field=function(a){return a.prototype.process_file=function(a,b){function d(a,b){return a=a||"",b=b||"",a.length>0?a:b.indexOf(".png")>-1?"image/png":b.indexOf(".jpg")>-1?"image/jpeg":"application/octet-stream"}function e(a,b){if(a=a||"",a.length>0)return a;var c=b.lastIndexOf("/");return c>-1?b.slice(c):null}var f=a.value,g=void 0===a.isStore?!0:a.isStore,h=(new Date).getTime(),i=a.previousFile||{},j=null;if("undefined"==typeof f||null===f)return b("No input value to process_file",null);var k=f;f instanceof HTMLInputElement&&(k=f.files[0]||{}),"undefined"==typeof k.lastModifiedDate&&(h=c.utils.getTime().getTime()),k.lastModifiedDate instanceof Date&&(h=k.lastModifiedDate.getTime());var l=e(k.name||k.fileName,k.fullPath),m=d(k.type||k.fileType,l);if(null===l&&!i.fileName)return b("Expected picture to be PNG or JPEG but was null");if(i.hashName&&(l===i.hashName||k.hashName===i.hashName))return b(null,i);var n={fileName:l,fileSize:k.size,fileType:m,fileUpdateTime:h,hashName:"",imgHeader:"",contentType:"binary"};i=n;var o=l+(new Date).getTime()+Math.ceil(1e5*Math.random());c.utils.md5(o,function(a,d){j=d,a&&(j=o),j="filePlaceHolder"+j,0===l.length&&(i.fileName=j),i.hashName=j,g?c.stores.localStorage.saveFile(j,k,function(a,c){a?($fh.forms.log.e(a),b(a)):b(null,i)}):b(null,i)})},a}(c.models.Field||{}),c.models.Field=function(a){return a.prototype.process_location=function(a,b){var c=a.value,d=this.getFieldDefinition(),e={};switch(d.locationUnit){case"latlong":c.lat&&c["long"]?(e={lat:c.lat,"long":c["long"]},b(null,e)):b("the input values for latlong field is {lat: number, long: number}");break;case"eastnorth":c.zone&&c.eastings&&c.northings?(e={zone:c.zone,eastings:c.eastings,northings:c.northings},b(null,e)):b("the input values for northeast field is {zone: text, eastings: text, northings:text}");break;default:b("Invalid subtype type of location field, allowed types: latlong and eastnorth, was: "+d.locationUnit)}},a}(c.models.Field||{}),c.models.Field=function(a){return a.prototype.getMatrixRows=function(){var a=this.getFieldDefinition();if(a.rows)return a.rows;throw"matrix rows definition is not found in field definition"},a.prototype.getMatrixCols=function(){var a=this.getFieldDefinition();if(a.columns)return a.columns;throw"matrix columns definition is not found in field definition"},a}(c.models.Field||{}),c.models.Field=function(a){return a.prototype.getRadioOption=function(){var a=this.getFieldDefinition();if(a.options)return a.options;throw"Radio options definition is not found in field definition"},a}(c.models.Field||{}),c.models.Field=function(a){function b(a,b){var e=this,f=a.value,g=void 0===a.isStore?!0:a.isStore,h=a.previousFile||{};if("string"!=typeof f)return b("Expected base64 string image or file URI but parameter was not a string",null);if(f.length<1)return b("Expected base64 string or file uri but got string of lenght 0:  "+f,null);if(f.indexOf(";base64,")>-1){var i="",j=f.split(";base64,"),k=j[0].split(":")[1],l=k.split("/")[1],m=f.length;d(function(a,d){i=h.hashName?h.hashName:"filePlaceHolder"+d;var e={fileName:i+"."+l,hashName:i,contentType:"base64",fileSize:m,fileType:k,imgHeader:"data:"+k+";base64,",fileUpdateTime:(new Date).getTime()};g?c.stores.localStorage.updateTextFile(i,j[1],function(a,c){a?($fh.forms.log.e(a),b(a)):b(null,e)}):b(null,e)})}else c.utils.fileSystem.readAsFile(f,function(c,d){return c?b(c):(a.value=d,void e.process_file(a,b))})}function d(a){var b=(new Date).getTime()+""+Math.ceil(1e5*Math.random());c.utils.md5(b,a)}function e(a,b){if(0===a.length)b(null,a);else for(var c=a.length,d=0;d<a.length;d++){var e=a[d];f(e,function(){c--,0===c&&b(null,a)})}}function f(a,b){if(a){if(a.localURI)return b(null,a);var d=a.hashName;"base64"===a.contentType?c.stores.localStorage.readFileText(d,function(c,d){c&&$fh.forms.log.e(c),a.data=d,b(c,a)}):"binary"===a.contentType?c.stores.localStorage.readFile(d,function(c,e){c&&$fh.forms.log.e("Error reading file "+d,c),a.data=e&&e.fullPath?e.fullPath:"file-not-found",b(c,a)}):$fh.forms.log.e("Error load image with invalid meta"+a.contentType)}else b(null,a)}return a.prototype.process_signature=b,a.prototype.convert_signature=e,a.prototype.process_photo=b,a.prototype.convert_photo=e,a}(c.models.Field||{}),c.models=function(a){function b(a,b){if("undefined"==typeof a||"undefined"==typeof b)throw"Page initialise failed: new Page(pageDefinitionJSON, parentFormModel)";d.call(this,{_type:"page"}),this.fromJSON(a),this.form=b,this.initialise()}var d=c.models.Model;return c.utils.extend(b,d),b.prototype.initialise=function(){var a=this.getFieldDef();this.fieldsIds=[];for(var b=0;b<a.length;b++)this.fieldsIds.push(a[b]._id)},b.prototype.setVisible=function(a){this.set("visible",a),this.emit(a?"visible":"hidden")},b.prototype.getFieldDef=function(){return this.get("fields",[])},b.prototype.getFieldDef=function(){return this.get("fields",[])},b.prototype.getFieldModelList=function(){for(var a=[],b=0;b<this.fieldsIds.length;b++)a.push(this.form.getFieldModelById(this.fieldsIds[b]));return a},b.prototype.checkForSectionBreaks=function(){for(var a=0;a<this.fieldsIds.length;a++){var b=this.form.getFieldModelById(this.fieldsIds[a]);if(b&&"sectionBreak"===b.getType())return!0}return!1},b.prototype.getSections=function(){var a={},b=null,c=this.checkForSectionBreaks(),d=!1;if(!c)return null;var e=this.form.getFieldModelById(this.fieldsIds[0]);"sectionBreak"!==e.getType()&&(d=!0);for(var f=0;f<this.fieldsIds.length;f++){var g=this.form.getFieldModelById(this.fieldsIds[f]);d&&0===f&&(b="sectionBreak"+f,a[b]=a[b]?a[b]:{fields:[]},a[b].title="Section "+(f+1)),null!==b&&"sectionBreak"!==g.getType()&&a[b].fields.push(g),"sectionBreak"===g.getType()&&(b="sectionBreak"+f,a[b]=a[b]?a[b]:{fields:[]},a[b].title=g.get("name","Section "+(f+1)),a[b].fields.push(g))}return a},b.prototype.getFieldModelById=function(a){return this.form.getFieldModelById(a)},b.prototype.getPageId=function(){return this.get("_id","")},b.prototype.getName=function(){return this.get("name","")},b.prototype.getDescription=function(){return this.get("description","")},b.prototype.getFieldDef=function(){return this.get("fields",[])},b.prototype.getFieldModelList=function(){for(var a=[],b=0;b<this.fieldsIds.length;b++)a.push(this.form.getFieldModelById(this.fieldsIds[b]));return a},a.Page=b,a}(c.models||{}),c.models=function(a){function b(){var a=this;d.call(a,{_type:"uploadManager",_ludid:"uploadManager_queue"}),a.set("taskQueue",[]),a.sending=!1,a.timerInterval=200,a.sendingStart=c.utils.getTime()}var d=c.models.Model;return c.utils.extend(b,d),b.prototype.queueSubmission=function(a,b){$fh.forms.log.d("Queueing Submission for uploadManager");var d,e=null,f=this;f.checkOnlineStatus(function(){return $fh.forms.config.isOnline()?(a.getUploadTaskId()?d=a.getUploadTaskId():(e=c.models.uploadTask.newInstance(a),d=e.getLocalId()),f.push(d),f.timer||($fh.forms.log.d("Starting timer for uploadManager"),f.start()),e?e.saveLocal(function(a){a&&$fh.forms.log.e(a),f.saveLocal(function(a){a&&$fh.forms.log.e("Error saving upload manager: "+a),b(null,e)})}):f.saveLocal(function(a){a&&$fh.forms.log.e("Error saving upload manager: "+a),f.getTaskById(d,b)}),void 0):b("Working offline cannot submit form.")})},b.prototype.cancelSubmission=function(a,b){var c=a.getUploadTaskId(),d=this.get("taskQueue");if(c){var e=d.indexOf(c);e>-1&&d.splice(e,1),this.getTaskById(c,function(a,c){a?($fh.forms.log.e(a),b(a,c)):c?c.clearLocal(b):b(null,null)}),this.saveLocal(function(a){a&&$fh.forms.log.e(a)})}else b(null,null)},b.prototype.getTaskQueue=function(){return this.get("taskQueue",[])},b.prototype.start=function(){var a=this;a.stop(),a.timer=setInterval(function(){a.tick()},this.timerInterval)},b.prototype.stop=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},b.prototype.push=function(a){this.get("taskQueue").push(a),this.saveLocal(function(a){a&&$fh.forms.log.e("Error saving local Upload manager",a)})},b.prototype.shift=function(){var a=this.get("taskQueue").shift();return this.saveLocal(function(a){a&&$fh.forms.log.e(a)}),a},b.prototype.rollTask=function(){this.push(this.shift())},b.prototype.tick=function(){var a=this;if(a.sending){var b=c.utils.getTime(),d=b.getTime()-a.sendingStart.getTime();d>1e3*$fh.forms.config.get("timeout")&&($fh.forms.log.e("Uploading content timeout. it will try to reupload."),a.sending=!1,a.rollTask())}else a.hasTask()?(a.sending=!0,a.sendingStart=c.utils.getTime(),a.getCurrentTask(function(b,c){b||!c?($fh.forms.log.e(b),a.sending=!1):c.isCompleted()||c.isError()?(a.shift(),a.sending=!1,a.saveLocal(function(a){a&&$fh.forms.log.e("Error saving upload manager: ",a)})):a.checkOnlineStatus(function(){$fh.forms.config.isOnline()?c.uploadTick(function(b){b&&$fh.forms.log.e("Error on upload tick: ",b,c),a.sending=!1}):$fh.forms.log.d("Upload Manager: Tick: Not online.")})})):a.stop()},b.prototype.hasTask=function(){return this.get("taskQueue").length>0},b.prototype.getCurrentTask=function(a){var b=this.getTaskQueue()[0];b?this.getTaskById(b,a):a(null,null)},b.prototype.checkOnlineStatus=function(a){c.stores.dataAgent.checkOnlineStatus(a)},b.prototype.getTaskById=function(a,b){c.models.uploadTask.fromLocal(a,b)},a.uploadManager=new b,a}(c.models||{}),c.models=function(a){function b(a){d.call(this,{_type:"rule"}),this.fromJSON(a)}var d=c.models.Model;return c.utils.extend(b,d),b.prototype.getRelatedFieldId=function(){for(var a=this.getDefinition(),b=a.ruleConditionalStatements,c=[],d=0;d<b.length;d++){var e=b[d];c.push(e.sourceField)}return c},b.prototype.test=function(a){for(var b=this.getRelatedFieldId(),c=this.getLogic(),d="or"===c?!1:!0,e=0;e<b.length;e++){var f=b[e],g=a[f];if(g){var h=this.testField(f,g);if("or"===c){if(d=d||h,d===!0)return!0}else if(d=d&&h,d===!1)return!1}else{if("or"!==c)return!1;d=d||!1}}return d},b.prototype.testField=function(a,b){var d=this.getRuleConditionStatement(a),e=d.restriction,f=d.sourceValue;return c.models.checkRule(e,f,b)},b.prototype.getRuleConditionStatement=function(a){for(var b=this.getDefinition().ruleConditionalStatements,c=0;c<b.length;c++){var d=b[c];if(d.sourceField===a)return d}return null},b.prototype.getLogic=function(){var a=this.getDefinition();return a.ruleConditionalOperator.toLowerCase()},b.prototype.getDefinition=function(){return this.get("definition")},b.prototype.getAction=function(){var a=this.getDefinition(),b={action:a.type,targetId:"page"===this.get("type")?a.targetPage:a.targetField,targetType:this.get("type")};return b},a.Rule=b,a}(c.models||{}),c.models=function(a){function b(a){if(a){var b=new e;return b.init(a),f[b.getLocalId()]=b,b}return{}}function d(a,b){if(f[a])return b(null,f[a]);var c=new e;c.setLocalId(a),f[a]=c,c.loadLocal(b)}function e(){g.call(this,{_type:"uploadTask"})}a.uploadTask={newInstance:b,fromLocal:d};var f={},g=c.models.Model;return c.utils.extend(e,g),e.prototype.init=function(a){function b(){var b=a.getProps();d.set("jsonTask",b),d.set("formId",a.get("formId"))}function c(){d.set("submissionId",a.getRemoteSubmissionId()),d.set("jsonTask",{}),d.set("submissionTransferType","download")}var d=this,e=a.getLocalId();d.setLocalId(e+"_uploadTask"),d.set("submissionLocalId",e),d.set("fileTasks",[]),d.set("currentTask",null),d.set("completed",!1),d.set("retryAttempts",0),d.set("retryNeeded",!1),d.set("mbaasCompleted",!1),d.set("submissionTransferType","upload"),a.setUploadTaskId(d.getLocalId()),a.isDownloadSubmission()?c():b()},e.prototype.getTotalSize=function(){for(var a,b=this,c=JSON.stringify(b.get("jsonTask")).length,d=b.get("fileTasks"),e=0,f=0;f<d.length;f++)a=d[f],e+=a.fileSize;return c+e},e.prototype.getUploadedSize=function(){var a=this.getCurrentTask();if(null===a)return 0;for(var b,c=JSON.stringify(this.get("jsonTask")).length,d=this.get("fileTasks"),e=0,f=0;(b=d[f])&&a>f;f++)e+=b.fileSize;return c+e},e.prototype.getRemoteStore=function(){return c.stores.dataAgent.remoteStore},e.prototype.addFileTasks=function(a,b){var c=this;a.getFileInputValues(function(a,d){if(a)return $fh.forms.log.e("Error getting file Input values: "+a),b(a);for(var e=0;e<d.length;e++){var f=d[e];c.addFileTask(f)}b()})},e.prototype.addFileTask=function(a){this.get("fileTasks").push(a)},e.prototype.getCurrentTask=function(){return this.get("currentTask",null)},e.prototype.getRetryAttempts=function(){return this.get("retryAttempts")},e.prototype.increRetryAttempts=function(){this.set("retryAttempts",this.get("retryAttempts")+1)},e.prototype.resetRetryAttempts=function(){this.set("retryAttempts",0)},e.prototype.isStarted=function(){return null===this.getCurrentTask()?!1:!0},e.prototype.setSubmissionQueued=function(a){var b=this;b.submissionModel(function(c,d){return c?a(c):(b.get("submissionId")&&d.setRemoteSubmissionId(b.get("submissionId")),void d.queued(a))})},e.prototype.uploadForm=function(a){function b(b){$fh.forms.log.d("In processUploadDataResult");var d=g.get("jsonTask");if(b.error)return $fh.forms.log.e("Error submitting form "+b.error),a("Error submitting form "+b.error);var e=b.submissionId;d.lastUpdate=c.utils.getTime(),g.set("submissionId",e),g.setSubmissionQueued(function(b){return g.increProgress(),g.saveLocal(function(a){a&&$fh.forms.log.e("Error saving uploadTask to local storage"+a)}),g.emit("progress",g.getProgress()),a(null)})}function d(b,c){return $fh.forms.log.d("In processDownloadDataResult"),b?($fh.forms.log.e("Error downloading submission data"+b),a(b)):void g.submissionModel(function(b,d){if($fh.forms.log.d("Got SubmissionModel",b,d),b)return a(b);var e={};if("string"==typeof c)try{e=JSON.parse(c)}catch(f){return $fh.forms.log.e("processDownloadDataResult Invalid JSON Object Returned",c),a("Invalid JSON Object Returned")}else e=c;e.status&&delete e.status,d.fromJSON(e),g.set("jsonTask",c),d.saveLocal(function(b){$fh.forms.log.d("Saved SubmissionModel",b,d),b&&$fh.forms.log.e("Error saving updated submission from download submission: "+b),g.addFileTasks(d,function(b){return $fh.forms.log.d("addFileTasks called",b,d),b?a(b):(g.increProgress(),void g.saveLocal(function(b){return b&&$fh.forms.log.e("Error saving downloadTask to local storage"+b),g.emit("progress",g.getProgress()),a()}))})})})}function e(){$fh.forms.log.d("In uploadSubmissionJSON");var d=g.get("jsonTask");g.submissionModel(function(e,f){return e?a(e):void g.addFileTasks(f,function(e){if(e)return $fh.forms.log.e("Error adding file tasks for submission upload"),a(e);var f=new c.models.FormSubmission(d);g.getRemoteStore().create(f,function(c,d){if(c)return a(c);var e=d.updatedFormDefinition;e?g.refreshForm(e,function(a){$fh.forms.log.d("Form Updated, refreshed"),a&&$fh.forms.log.e(a),b(d)}):b(d)})})})}function f(){var a=new c.models.FormSubmissionDownload(g);g.getRemoteStore().read(a,d)}var g=this;g.isDownloadTask()?f():e()},e.prototype.handleCompletionError=function(a,b,c){$fh.forms.log.d("handleCompletionError Called");var d=a;d="pending"===b.status?"Submission Still Pending.":"error"===b.status?"Error completing submission":"Invalid return type from complete submission",c(d)},e.prototype.handleIncompleteSubmission=function(a){function b(){var b=e.getRemoteStore(),d=new c.models.FormSubmissionStatus(e);b.submissionStatus(d,function(b,c){var d="";if(b)a(b);else if("error"===c.status)d="Error submitting form.",a(d);else if("complete"===c.status)e.increProgress(),a();else if("pending"===c.status){var f=c.pendingFiles||[];f.length>0?e.resetUploadTask(f,function(){a()}):(e.increProgress(),a())}else d="Invalid submission status response.",a(d)})}function d(){a()}var e=this;e.isDownloadTask()?d():b()},e.prototype.resetUploadTask=function(a,b){var c,d=this.get("fileTasks"),e=[];for(c=0;c<d.length;c++)a.indexOf(d[c].hashName)<0&&e.push(d[c]);for(c=0;c<d.length;c++)a.indexOf(d[c].hashName)>-1&&e.push(d[c]);var f=d.length-a.length-1,g=0;f>0&&(g=f),this.set("currentTask",g),this.set("fileTasks",e),this.saveLocal(b)},e.prototype.uploadFile=function(a){function b(){$fh.forms.log.d("processUploadFile for submissionId: "),g="base64"===h.contentType?new c.models.Base64FileSubmission(h):new c.models.FileSubmission(h),g.setSubmissionId(i),g.loadFile(function(b){return b?($fh.forms.log.e("Error loading file for upload: "+b),a(b)):void e.getRemoteStore().create(g,function(b,d){if(b)a(b);else if("ok"===d.status||200===d.status||"200"===d.status)h.updateDate=c.utils.getTime(),e.increProgress(),e.saveLocal(function(a){a&&$fh.forms.log.e("Error saving upload task"+a)}),e.emit("progress",e.getProgress()),a(null);else{var f="File upload failed for file: "+h.fileName;a(f)}})})}function d(){$fh.forms.log.d("processDownloadFile called"),g=new c.models.FileSubmissionDownload(h),g.setSubmissionId(i),e.getRemoteStore().read(g,function(b,c){return b?($fh.forms.log.e("Error downloading a file from remote: "+b),a(b)):($fh.forms.log.d("processDownloadFile called. Local File Path: "+c),void e.submissionModel(function(b,d){return b?($fh.forms.log.e("Error Loading submission model for processDownloadFile "+b),a(b)):void d.updateFileLocalURI(h,c,function(b){return b?($fh.forms.log.e("Error updating file local url for fileTask "+JSON.stringify(h)),a(b)):(e.increProgress(),e.saveLocal(function(a){a&&$fh.forms.log.e("Error saving download task")}),e.emit("progress",e.getProgress()),a())})}))})}var e=this,f=e.getCurrentTask();null===f&&(f=0,e.set("currentTask",f));var g,h=e.get("fileTasks",[])[f],i=e.get("submissionId");return h?i?void(e.isDownloadTask()?d():b()):($fh.forms.log.e("No submission id found when trying to transfer a file."),a("No submission Id found")):($fh.forms.log.e("No file task found when trying to transfer a file."),a("cannot find file task"))},e.prototype.isDownloadTask=function(){return"download"===this.get("submissionTransferType")},e.prototype.setRetryNeeded=function(a){null!=this.get("submissionId",null)?this.set("retryNeeded",a):(this.set("retryNeeded",!1),this.set("currentTask",null))},e.prototype.retryNeeded=function(){return this.get("retryNeeded")},e.prototype.uploadTick=function(a){function b(b){b?($fh.forms.log.d("Err, retrying transfer: "+c.getLocalId()),c.increRetryAttempts(),c.getRetryAttempts()<=$fh.forms.config.get("max_retries")?(c.setRetryNeeded(!0),c.saveLocal(function(b){b&&$fh.forms.log.e("Error saving upload taskL "+b),a()})):(c.setRetryNeeded(!0),c.resetRetryAttempts(),c.error(b,function(){a(b)}))):(c.setRetryNeeded(!1),c.saveLocal(function(a){a&&$fh.forms.log.e("Error saving upload task to local memory"+a)}),c.submissionModel(function(b,c){if(b)a(b);else{var d=c.get("status");"inprogress"!==d&&"submitted"!==d&&"downloaded"!==d&&"queued"!==d?($fh.forms.log.e("Submission status is incorrect. Upload task should be started by submission object's upload method."+d),a("Submission status is incorrect. Upload task should be started by submission object's upload method.")):a()}}))}var c=this;this.isFormCompleted()?this.retryNeeded()?this.handleIncompleteSubmission(b):this.isFileCompleted()?this.isMBaaSCompleted()?this.isCompleted()?b(null,null):this.success(b):this.uploadComplete(b):this.uploadFile(b):this.uploadForm(b)},e.prototype.increProgress=function(){var a=this.getCurrentTask();null===a?a=0:a++,this.set("currentTask",a)},e.prototype.uploadComplete=function(a){function b(){$fh.forms.log.d("processDownloadComplete Called"),e.increProgress(),a(null)}function d(){$fh.forms.log.d("processUploadComplete Called");var b=e.getRemoteStore(),d=new c.models.FormSubmissionComplete(e);b.create(d,function(b,c){return c=c||{},"complete"!==c.status?e.handleCompletionError(b,c,a):(e.increProgress(),void a(null))})}$fh.forms.log.d("UploadComplete Called");var e=this,f=e.get("submissionId",null);return null===f?a("Failed to complete submission. Submission Id not found."):void(e.isDownloadTask()?b():d())},e.prototype.success=function(a){function b(a){$fh.forms.log.d("processUploadSuccess Called"),d.submissionModel(function(b,c){return b?a(b):(c.set("submissionId",e),void c.submitted(a))})}function c(a){$fh.forms.log.d("processDownloadSuccess Called"),d.submissionModel(function(b,c){return b?a(b):(c.populateFilesInSubmission(),void c.downloaded(a))})}$fh.forms.log.d("Transfer Sucessful. Success Called.");var d=this,e=d.get("submissionId",null);d.set("completed",!0),d.saveLocal(function(e){e&&$fh.forms.log.e("Error Clearing Upload Task"),d.isDownloadTask()?c(function(b){d.clearLocal(a)}):b(function(b){d.clearLocal(a)})})},e.prototype.error=function(a,b){var c=this;$fh.forms.log.e("Error uploading submission: ",a),c.set("error",a),c.saveLocal(function(d){d&&$fh.forms.log.e("Upload task save failed: "+d),c.submissionModel(function(d,e){d?b(d):(e.setUploadTaskId(null),e.error(a,function(a){a&&$fh.forms.log.e("Error updating submission model to error status ",a),c.clearLocal(function(a){a&&$fh.forms.log.e("Error clearing upload task local storage: ",a),b(a)})}))})})},e.prototype.isFormCompleted=function(){var a=this.getCurrentTask();return null===a?!1:!0},e.prototype.isFileCompleted=function(){var a=this.getCurrentTask();return null===a?!1:a<this.get("fileTasks",[]).length?!1:!0},e.prototype.isError=function(){var a=this.get("error",null);return a?!0:!1},e.prototype.isCompleted=function(){return this.get("completed",!1)},e.prototype.isMBaaSCompleted=function(){var a=this;if(a.isFileCompleted()){var b=a.getCurrentTask();return b>a.get("fileTasks",[]).length?(a.set("mbaasCompleted",!0),a.saveLocal(function(a){a&&$fh.forms.log.e("Error saving upload task: ",a)}),!0):!1}return!1},e.prototype.getProgress=function(){var a=this,b={formJSON:!1,currentFileIndex:0,totalFiles:a.get("fileTasks").length,totalSize:a.getTotalSize(),uploaded:a.getUploadedSize(),retryAttempts:a.getRetryAttempts(),submissionTransferType:a.get("submissionTransferType")},c=a.getCurrentTask();return null===c?b:(b.formJSON=!0,b.currentFileIndex=c,b)},e.prototype.refreshForm=function(a,b){var d=this.get("formId");new c.models.Form({formId:d,rawMode:!0,rawData:a},function(c,d){c&&$fh.forms.log.e(c),$fh.forms.log.l("successfully updated form the form with id "+a._id),b()})},e.prototype.submissionModel=function(a){c.models.submission.fromLocal(this.get("submissionLocalId"),function(b,c){b&&$fh.forms.log.e("Error getting submission model from local memory "+b),a(b,c)})},a}(c.models||{}),c.models=function(a){function b(){d.call(this,{_type:"theme",_ludid:"theme_object"})}var d=c.models.Model;return b.prototype.getCSS=function(){
return this.get("css","")},c.utils.extend(b,d),a.theme=new b,a}(c.models||{}),c.models=function(a){function b(){d.call(this,{_type:"log",_ludid:"log"}),this.set("logs",[]),this.isWriting=!1,this.moreToWrite=!1}var d=c.models.Model;return c.utils.extend(b,d),b.prototype.info=function(a,b){if($fh.forms.config.get("logger")===!0){var c="",d=$fh.forms.config.get("log_level"),e=$fh.forms.config.get("log_levels"),f=this;if("string"==typeof a?(c=a,a=e.indexOf(a.toLowerCase())):a=0,d=isNaN(parseInt(d,10))?d:parseInt(d,10),a=isNaN(parseInt(a,10))?a:parseInt(a,10),a>d)return;var g=Array.prototype.splice.call(arguments,0),h=f.get("logs");g.shift();for(var i="";g.length>0;)i+=JSON.stringify(g.shift())+" ";if(h.push(f.wrap(i,c)),h.length>$fh.forms.config.get("log_line_limit")&&h.shift(),f.isWriting)f.moreToWrite=!0;else{var j=function(){f.moreToWrite&&(f.moreToWrite=!1,f.write(j))};f.write(j)}}},b.prototype.wrap=function(a,b){var c=new Date,d=c.toISOString();"object"==typeof a&&(a=JSON.stringify(a));var e=d+" "+b.toUpperCase()+" "+a;return e},b.prototype.write=function(a){var b=this;b.isWriting=!0,b.saveLocal(function(){b.isWriting=!1,a()})},b.prototype.e=function(){var a=Array.prototype.splice.call(arguments,0);a.unshift("error"),this.info.apply(this,a)},b.prototype.w=function(){var a=Array.prototype.splice.call(arguments,0);a.unshift("warning"),this.info.apply(this,a)},b.prototype.l=function(){var a=Array.prototype.splice.call(arguments,0);a.unshift("log"),this.info.apply(this,a)},b.prototype.d=function(){var a=Array.prototype.splice.call(arguments,0);a.unshift("debug"),this.info.apply(this,a)},b.prototype.getLogs=function(){return this.get("logs")},b.prototype.clearLogs=function(a){this.set("logs",[]),this.saveLocal(function(){a&&a()})},b.prototype.sendLogs=function(a){var b=$fh.forms.config.get("log_email"),d=c.config.getProps(),e=this.getLogs(),f={type:"email",to:b,subject:"App Forms App Logs",body:"Configuration:\n"+JSON.stringify(d)+"\n\nApp Logs:\n"+e.join("\n")};c.utils.send(f,a)},a.log=new b,c.log=a.log,a}(c.models||{}),c.api=function(a){function b(a,b){"function"==typeof a&&(b=a,a={}),a=a?a:{},b=b?b:l;var d=a.fromRemote;void 0===d&&(d=!1),c.models.forms.refresh(d,b)}function d(a,b){"function"==typeof a&&(b=a,a={}),a=a?a:{},b=b?b:l,new c.models.Form(a,b)}function e(a,b){"function"==typeof a&&(b=a,a={}),a=a?a:{},b=b?b:l;var d=c.models.theme;a.fromRemote||(a.fromRemote=!1),d.refresh(a.fromRemote,function(c,e){return c?b(c):null===e?b(new Error("No theme defined for this app")):a.css===!0?b(null,d.getCSS()):b(null,d)})}function f(a,b){"function"==typeof a&&(b=a,a={}),a=a?a:{},b=b?b:l;c.models.submissions;null===i?c.models.submissions.loadLocal(function(a){a?($fh.forms.log.e(a),b(a)):(i=c.models.submissions,b(null,i))}):b(null,i)}function g(a,b){return a?void a.submit(function(c){return c?b(c):void a.upload(b)}):b("Invalid submission object.")}function h(a,b){function d(a){a="string"==typeof a&&24===a.length?null:a,$fh.forms.log.d("finishSubmissionDownload ",a,e);var c=e.getRemoteSubmissionId(),d=j[c];if(!d)return e.clearEvents(),b(a,e);for(var f=d.pop();"function"==typeof f;)f(a,e),f=d.pop();e.clearEvents&&e.clearEvents()}a=a?a:{};var e=null;if("function"!=typeof b)return null;if($fh.forms.log.d("downloadSubmission called",a),!a.submissionId)return $fh.forms.log.e("No submissionId passed to download a submission"),b("No submissionId passed to download a submission");$fh.forms.log.d("downloadSubmission SubmissionId exists"+a.submissionId);var f=c.models.submissions.findMetaByRemoteId(a.submissionId);null===f?($fh.forms.log.d("downloadSubmission submission does not exist, downloading",a),e=new c.models.submission.newInstance(null,{submissionId:a.submissionId}),e.on("error",d),e.on("downloaded",d),"function"==typeof a.updateFunction&&e.on("progress",a.updateFunction),"function"==typeof b&&(j[a.submissionId]?j[a.submissionId].push(b):(j[a.submissionId]=[],j[a.submissionId].push(b))),e.download(function(a){return a?($fh.forms.log.e("Error queueing submission for download "+a),b(a)):void 0})):($fh.forms.log.d("downloadSubmission submission exists",a),"downloaded"!==f.status&&"submitted"!==f.status?"function"==typeof b&&(j[a.submissionId]?j[a.submissionId].push(b):(j[a.submissionId]=[],j[a.submissionId].push(b))):c.models.submissions.getSubmissionByMeta(f,b))}a.getForms=b,a.getForm=d,a.getTheme=e,a.submitForm=g,a.getSubmissions=f,a.downloadSubmission=h,a.init=c.init,a.log=c.models.log;var i=null,j={},k=c.models.config,l=function(a){a=a?a:"",$fh.forms.log.w("Default Function Called "+a)},m={editAllowed:function(){var a=k.get("defaultConfigValues",{});return a.config_admin_user===!0},get:function(a){if(a){var b=k.get("userConfigValues",{}),c=k.get("defaultConfigValues",{});return b[a]?b[a]:c[a]}},getDeviceId:function(){return k.get("deviceId","Not Set")},set:function(a,b){var c=this;if("string"==typeof a&&"undefined"!=typeof b&&null!==b&&(c.editAllowed()||"max_sent_saved"===a)){var d=k.get("userConfigValues",{});d[a]=b,k.set("userConfigValues",d)}},getConfig:function(){var a=this,b=k.get("defaultConfigValues",{}),c=k.get("userConfigValues",{}),d={};if(a.editAllowed()){for(var e in b)d[e]=c[e]?c[e]:b[e];return d}return b},saveConfig:function(a){k.saveLocal(function(b,c){b?$fh.forms.log.e("Error saving a form config: ",b):$fh.forms.log.l("Form config saved sucessfully."),"function"==typeof a&&a()})},offline:function(){k.setOffline()},online:function(){k.setOnline()},mbaasOnline:function(a){"function"==typeof a&&k.on("online",a)},mbaasOffline:function(a){"function"==typeof a&&k.on("offline",a)},isOnline:function(){return k.isOnline()},isStudioMode:function(){return k.isStudioMode()},refresh:function(a){k.refresh(!0,a)}};return a.config=m,a}(c.api||{}),"undefined"==typeof $fh&&($fh={}),void 0===$fh.forms&&($fh.forms=c.api),c&&(c.RulesEngine=b)}(window||module.exports);